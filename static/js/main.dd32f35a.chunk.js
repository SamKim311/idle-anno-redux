(this["webpackJsonpidle-anno-redux"]=this["webpackJsonpidle-anno-redux"]||[]).push([[0],{62:function(e,t,r){e.exports=r(84)},73:function(e,t,r){},75:function(e,t,r){},76:function(e,t,r){},77:function(e,t,r){},78:function(e,t,r){},79:function(e,t,r){},80:function(e,t,r){},81:function(e,t,r){},84:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),o=r(10),i=r.n(o),c=r(2),s=r(25),u=r(55),l={INIT:"INIT",TICK:"TICK",SAVE_GAME:"SAVE_GAME",LOAD_GAME:"LOAD_GAME",RESET_SAVE:"RESET_SAVE",CHANGE_NAME:"CHANGE_NAME"};function d(){return{type:l.SAVE_GAME}}var p=r(7);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=r(3),f={BUILD_WAREHOUSE:"BUILD_WAREHOUSE",UPDGRADE_WAREHOUSE:"UPGRADE_WAREHOUSE",UPGRADE_STOREHOUSE:"UPGRADE_STOREHOUSE"};var O={CONSTRUCT_BUILDING:"CONSTRUCT_BUILDING",DESTROY_BUILDING:"DESTROY_BUILDING"};var h={AMENITY:"AMENITY",PRODUCER:"PRODUCER",HOUSE:"HOUSE",WAREHOUSE:"WAREHOUSE",NAVAL:"NAVAL"},v="SHIPYARD",y={AWAITING_RESOURCES:"AWAITING_RESOURCES",WORKING:"WORKING",OUTBOX_FULL:"OUTBOX_FULL",DISABLED:"DISABLED"},w={marketplace:{name:"Marketplace",abbreviation:"M",description:"Provides a place for villagers to meet",category:h.AMENITY,produces:{community:2.5},upkeep:10},chapel:{name:"Chapel",abbreviation:"Ch",description:"A basic building for villagers to worship",category:h.AMENITY,produces:{faith:3},upkeep:15},tavern:{name:"Tavern",abbreviation:"Tv",description:"Provides citizens a place to drink",category:h.AMENITY,produces:{entertainment:9},upkeep:30},church:{name:"Church",abbreviation:"Ch",description:"Provides a larger location to worship",category:h.AMENITY,produces:{faith:12},upkeep:40},prison:{name:"Prison",abbreviation:"Pr",description:"Jails bad folks. Provides a sense of security",category:h.AMENITY,produces:{security:16}},fishinghut:{name:"Fisherman's Hut",abbreviation:"F",description:"Gathers fish",category:h.PRODUCER,consumes:{},produces:{fish:1},produceTime:30,upkeep:15,disabledUpkeep:5},lumberjackhut:{name:"Lumberjack's Hut",abbreviation:"L",description:"Gathers wood",category:h.PRODUCER,consumes:{},produces:{wood:1},produceTime:40,upkeep:5,disabledUpkeep:0},orchard:{name:"Orchard",abbreviation:"O",description:"Grows apples to be turned into cider",category:h.PRODUCER,consumes:{},produces:{apple:1},produceTime:100,upkeep:5,disabledUpkeep:0},ciderfarm:{name:"Cidery",abbreviation:"C",description:"Processes apples into cider",category:h.PRODUCER,consumes:{apple:1},produces:{cider:1},produceTime:40,upkeep:15,disabledUpkeep:5},hempfarm:{name:"Hemp Plantation",abbreviation:"H",description:"Grows hemp",category:h.PRODUCER,consumes:{},produces:{hemp:1},produceTime:60,upkeep:20,disabledUpkeep:10},weavers:{name:"Weaver's Hut",abbreviation:"W",description:"Uses hemp to create clothing",category:h.PRODUCER,consumes:{hemp:1},produces:{linen:1},produceTime:30,upkeep:25,disabledUpkeep:12},stonemason:{name:"Stonemason",abbreviation:"Sm",description:"Turns raw stone into stone bricks",category:h.PRODUCER,consumes:{},produces:{stone:1},produceTime:30,upkeep:20,disabledUpkeep:10},oremine:{name:"Ore mine",abbreviation:"Om",description:"Mines raw ore from the ground",category:h.PRODUCER,consumes:{},produces:{ore:1},produceTime:30,upkeep:20,disabledUpkeep:10},charcoalhut:{name:"Charcoal Burner's Hut",abbreviation:"Cc",description:"Burns wood down into charcoal",category:h.PRODUCER,consumes:{},produces:{charcoal:1},produceTime:30,upkeep:10,disabledUpkeep:0},smelter:{name:"Iron Smelter",abbreviation:"I",description:"Converts raw ore to iron ingots",category:h.PRODUCER,consumes:{ore:1,charcoal:1},produces:{iron:1},produceTime:30,upkeep:20,disabledUpkeep:10},toolmaker:{name:"Toolmaker's Workshop",abbreviation:"TW",description:"Creates tools out of iron",category:h.PRODUCER,consumes:{iron:.5},produces:{tool:1},produceTime:30,upkeep:30,disabledUpkeep:15},ropeyard:{name:"Ropeyard",abbreviation:"Rp",description:"Creates rope from hemp",category:h.PRODUCER,consumes:{hemp:.5},produces:{rope:1},produceTime:30,upkeep:40,disabledUpkeep:20},wheatfield:{name:"Wheat Field",abbreviation:"W",description:"Grows wheat",category:h.PRODUCER,consumes:{},produces:{wheat:1},produceTime:30,upkeep:5,disabledUpkeep:0},mill:{name:"Flour Mill",abbreviation:"FM",description:"Grinds wheat into flour",category:h.PRODUCER,consumes:{wheat:1},produces:{flour:1},produceTime:15,upkeep:30,disabledUpkeep:15},bakery:{name:"Bakery",abbreviation:"Bk",description:"Bakes flour into bread",category:h.PRODUCER,consumes:{flour:1},produces:{bread:1},produceTime:15,upkeep:30,disabledUpkeep:15},weaponsmith:{name:"Weaponsmith",abbreviation:"Ws",description:"Forges weapons",category:h.PRODUCER,consumes:{iron:1},produces:{weapon:1},produceTime:30,upkeep:30,disabledUpkeep:15},hopsfield:{name:"Hops Farm",abbreviation:"HF",description:"Grows Hops",category:h.PRODUCER,consumes:{},produces:{hop:1},produceTime:30,upkeep:10,disabledUpkeep:5},brewery:{name:"Brewery",abbreviation:"Bw",description:"Brews Ale",category:h.PRODUCER,consumes:{hop:1.333,wheat:1.333},produces:{ale:1},produceTime:40,upkeep:30,disabledUpkeep:15},potashpit:{name:"Potash Pit",abbreviation:"Pp",description:"Produces Potash",category:h.PRODUCER,consumes:{},produces:{potash:1},produceTime:30,upkeep:30,disabledUpkeep:15},glasssmelter:{name:"Glass Smelter",abbreviation:"GS",description:"Melts quartz down into glass",category:h.PRODUCER,consumes:{potash:1,quartz:.5},produces:{glass:1},produceTime:60,upkeep:30,disabledUpkeep:15},saltmine:{name:"Salt Mine",abbreviation:"SM",description:"Extracts brine from underground deposits",category:h.PRODUCER,consumes:{},produces:{brine:1},produceTime:15,upkeep:20,disabledUpkeep:10},saltworks:{name:"Saltworks",abbreviation:"SW",description:"Refines brine into salt",category:h.PRODUCER,consumes:{brine:1,charcoal:.5},produces:{salt:1},produceTime:15,upkeep:25,disabledUpkeep:15},pigfarm:{name:"Pig Farm",abbreviation:"PF",description:"Raises pigs for slaughter. Produces hides",category:h.PRODUCER,consumes:{},produces:{hide:1},produceTime:30,upkeep:15,disabledUpkeep:5},tannery:{name:"Tannery",abbreviation:"Tn",description:"Tans hides into leather",category:h.PRODUCER,consumes:{hide:1,salt:.5},produces:{leather:1},produceTime:15,upkeep:20,disabledUpkeep:10},papermill:{name:"Paper Mill",abbreviation:"PM",description:"Produces Paper",category:h.PRODUCER,consumes:{wood:1},produces:{paper:1},produceTime:20,upkeep:50,disabledUpkeep:25},printingpress:{name:"Printing Press",abbreviation:"PP",description:"Prints books",category:h.PRODUCER,consumes:{paper:.5,ink:1},produces:{book:1},produceTime:20,upkeep:50,disabledUpkeep:25},alms:{name:"Alms House",abbreviation:"Ah",description:"Provides shelter for 500 beggars",category:h.HOUSE,upkeep:0,populationCategory:"beggar",populationCap:500},peasanthouse:{name:"Peasant Shack",description:"Basic home for villagers. Houses 8",category:h.HOUSE,upkeep:0,populationCategory:"peasant",populationCap:8,ascendsTo:"citizenhouse"},citizenhouse:{name:"Citizen House",description:"Home for citizens",category:h.HOUSE,upkeep:0,populationCategory:"citizen",populationCap:15,ascendsTo:"patricianhouse",cost:{wood:1,tool:1}},patricianhouse:{name:"Patrician House",description:"Home for patricians",category:h.HOUSE,upkeep:0,populationCategory:"patrician",populationCap:25,ascendsTo:"noblehouse",cost:{wood:1,tool:1,stone:4}},noblehouse:{name:"Noble House",description:"Home for nobles",category:h.HOUSE,upkeep:0,populationCategory:"noble",populationCap:40,cost:{wood:1,tool:1,stone:3,glass:4}},smallwarehouse:{name:"Small Warehouse",description:"Basic warehouse for your island",category:h.WAREHOUSE,upkeep:10,couriers:3,capacity:40,upgradesTo:"mediumwarehouse",upgradeCost:{gold:150,wood:2,tool:3,stone:4}},mediumwarehouse:{name:"Medium Warehouse",description:"Expanded warehouse",category:h.WAREHOUSE,upkeep:15,couriers:1,capacity:10,upgradesTo:"largewarehouse",upgradeCost:{gold:350,wood:2,tool:1,stone:3,glass:2}},largewarehouse:{name:"Large Warehouse",description:"Large Warehouse",category:h.WAREHOUSE,upkeep:20,couriers:1,capacity:10},smallstockpile:{name:"Small Stockpile",abbreviation:"SS",description:"Small depot. Provides 1 courier",category:h.WAREHOUSE,upkeep:10,couriers:1,capacity:0,upgradesTo:"mediumstockpile",upgradeCost:{gold:200,wood:3,tool:1,stone:3}},mediumstockpile:{name:"Medium Stockpile",abbreviation:"MS",description:"Medium depot. Provides 2 couriers, and 5 storage",category:h.WAREHOUSE,upkeep:20,couriers:2,capacity:5,upgradesTo:"largestockpile",upgradeCost:{gold:300,wood:3,tool:1,stone:3,glass:2}},largestockpile:{name:"Large Stockpile",abbreviation:"LS",description:"Large depot. Provides 3 couriers, and 10 storage",category:h.WAREHOUSE,upkeep:30,couriers:3,capacity:5},smallstorehouse:{name:"Small Storehouse",abbreviation:"So",description:"Increases the warehouse capacity",category:h.WAREHOUSE,upkeep:15,couriers:0,capacity:15},smallshipyard:{name:"Small Shipyard",description:"Allows construction of small ships",category:h.NAVAL,subCategory:v,upkeep:10,shipsBuilt:["smalltrader","smallwarship"]},largeshipyard:{name:"Large Shipyard",description:"Allows construction of large vessels",category:h.NAVAL,subCategory:v,upkeep:20,shipsBuilt:["largetrader","largewarship"]},repaircrane:{name:"Repair Crane",description:"Repairs ships that are docked here",category:h.NAVAL,upkeep:20}},E={BUILD_HOUSE:"BUILD_HOUSE",ASCEND_HOUSE:"ASCEND_HOUSE"};var j={BUY_GOODS:"BUY_GOODS",SELL_GOODS:"SELL_GOODS",DISMISS_TRADER:"DISMISS_TRADER"};var P={SETUP:"SETUP",ONLOAD:"ONLOAD",OFFLOAD:"OFFLOAD",CANCEL:"CANCEL",CONFIRM:"CONFIRM"};var k={gold:{name:"Gold",baseTradePrice:1},tool:{name:"Tool",baseTradePrice:15},fish:{name:"Fish",baseTradePrice:3},wood:{name:"Wood",baseTradePrice:1},apple:{name:"Apple",baseTradePrice:.2},cider:{name:"Cider",baseTradePrice:3},spice:{name:"Spice",baseTradePrice:6},hemp:{name:"Hemp",baseTradePrice:4},linen:{name:"Clothing",baseTradePrice:27},stone:{name:"Stone Brick",baseTradePrice:8},ore:{name:"Iron Ore",baseTradePrice:4},charcoal:{name:"Charcoal",baseTradePrice:8},iron:{name:"Iron",baseTradePrice:16},rope:{name:"Rope",baseTradePrice:18},wheat:{name:"Wheat",baseTradePrice:1},flour:{name:"Flour",baseTradePrice:24},bread:{name:"Bread",baseTradePrice:34},weapon:{name:"Weapons",baseTradePrice:24},hop:{name:"Hops",baseTradePrice:2},ale:{name:"Ale",baseTradePrice:14},potash:{name:"Potash",baseTradePrice:10},quartz:{name:"Quartz",baseTradePrice:4},glass:{name:"Glass",baseTradePrice:16},brine:{name:"Brine",baseTradePrice:1},salt:{name:"Salt",baseTradePrice:4},hide:{name:"Hide",baseTradePrice:33},leather:{name:"Leather",baseTradePrice:87},paper:{name:"Paper",baseTradePrice:12},book:{name:"Books",baseTradePrice:30},ink:{name:"Ink",baseTradePrice:9}};function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I={reserved:0,pending:0},T={owned:0,unlocked:!1};function C(e,t){for(var r=Object.assign({},e),a=0,n=Object.entries(t);a<n.length;a++){var o=n[a],i=Object(g.a)(o,2),c=i[0],s=i[1],u=Object.assign({},r[c]);u.owned-=s,r[c]=u}return r}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var A=r(26),N=r.n(A),L={DISABLE_BUILDING:"DISABLE_BUILDING",ENABLE_BUILDING:"ENABLE_BUILDING"};function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x={status:y.AWAITING_RESOURCES,progress:0,efficiency:1,efficiencyTimer:0,efficiencySupplied:!1,inbox:{},outbox:{}},M=.01,B=2,G=1,F=100,W=5;function z(e){var t=w[e.buildingId];e.inbox={};for(var r=0,a=Object.keys(t.consumes);r<a.length;r++){var n=a[r];e.inbox[n]=0}e.outbox={};for(var o=0,i=Object.keys(t.produces);o<i.length;o++){var c=i[o];e.outbox[c]=0}}function q(e,t){var r=Object.assign({},e),a=w[r.buildingId];if(!e.enabled)return r.status=y.DISABLED,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(!function(e){for(var t=w[e.buildingId],r=0,a=Object.entries(t.consumes);r<a.length;r++){var n=a[r],o=Object(g.a)(n,2),i=o[0],c=o[1];if(e.inbox[i]<c)return!1}return!0}(r))return r.status=y.AWAITING_RESOURCES,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(!function(e){for(var t=w[e.buildingId],r=0,a=Object.entries(t.produces);r<a.length;r++){var n=a[r],o=Object(g.a)(n,2),i=o[0],c=o[1];if(e.outbox[i]+c>W)return!1}return!0}(r))return r.status=y.OUTBOX_FULL,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(r.status=y.WORKING,r.efficiencySupplied||(r.efficiencySupplied=!0,r.efficiencyTimer=0),(r=K(r,t)).progress+=t*r.efficiency*M,r.progress>a.produceTime){r.progress-=a.produceTime;for(var n=Object.assign({},r.inbox),o=Object.assign({},r.outbox),i=0,c=Object.entries(a.consumes);i<c.length;i++){var s=c[i],u=Object(g.a)(s,2),l=u[0],d=u[1];n[l]-=d}for(var p=0,b=Object.entries(a.produces);p<b.length;p++){var m=b[p],f=Object(g.a)(m,2),O=f[0],h=f[1];o[O]+=h}r.inbox=n,r.outbox=o}return r}function K(e,t){return e.efficiencyTimer+=t,e.efficiencyTimer>B&&(e.efficiencyTimer-=B,e.efficiencySupplied?e.efficiency=Math.min(F,e.efficiency+1):e.efficiency=Math.max(G,e.efficiency-1)),e}var Y=r(32);function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q="IDLE",X="PICKING_UP",$="EN_ROUTE",Z="DROPPING_OFF",ee={status:Q,progress:0,timeThreshold:0,jobDescription:{},payload:{},markedForDeath:!1},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload,a=e.couriers;if(!a)return e;switch(t.type){case l.INIT:var n=w[e.warehouse.type],o=a.couriers.slice(0);re(o,n.couriers);var i=Object.assign({},a);return i.couriers=o,Object.assign({},e,{couriers:i});case f.UPGRADE_STOREHOUSE:var c=w[r.toUpgrade.buildingId],s=w[c.upgradesTo],u=s.couriers-c.couriers,d=Object(Y.a)(e.couriers.couriers);re(d,u);var p=J({},e.couriers,{couriers:d});return J({},e,{couriers:p});case f.UPDGRADE_WAREHOUSE:var b=w[r.toUpgrade].upgradesTo,m=w[b],g=Object(Y.a)(e.couriers.couriers);re(g,m.couriers);var v=J({},e.couriers,{couriers:g});return J({},e,{couriers:v});case f.BUILD_WAREHOUSE:var y=w[r.toConstruct.id],E=y.couriers,j=Object.assign({},e),P=Object.assign({},j.couriers);j.couriers=P;var k=P.couriers.slice(0);return re(k,E),P.couriers=k,j;case O.DESTROY_BUILDING:var S=w[r.toDestroy.buildingId];if(S.category!==h.WAREHOUSE)return e;for(var D=Object(Y.a)(e.couriers.couriers),I=J({},e.couriers,{couriers:D}),T=J({},e,{couriers:I}),C=S.couriers,U=0,R=0;R<D.length;R++){var A=D[R];if(A.status===Q&&!A.markmarkedForDeath&&(D.splice(R,1),++U===C))return T}for(var N=D.length-1;N>=0;N--){var L=D[N];if(!L.markmarkedForDeath&&(L.markedForDeath=!0,++U===C))return T}return T;case l.TICK:var _=Object.assign({},e),H=Object.assign({},_.couriers),x=Object.assign({},_.warehouse),M=x.totalCapacity,B=Object.assign({},x.resources);x.resources=B;var G=Object.assign({},_.buildings),F=Object.assign({},G.owned);G.owned=F,_.warehouse=x,_.buildings=G,_.couriers=H;var z=oe(a,x,F),q=a.jobQueue.slice(0).concat(z.jobList),K=Object.assign({},a.jobQueueMap,z.jobRef),V=H.couriers.map((function(e){if(e.status===Q){var t=Object.assign({},e),r=ie(q,F),a=q[r];if(q=q.slice(r+1),!a)return e;var n=a.from,o=a.to,i=a.carrying,c=null,s=null,u=0;if(c="warehouse"!==n?G.owned[n]:x,s="warehouse"!==o?G.owned[o]:x,"warehouse"===n){var l=W-s.inbox[i],d=Math.floor(B[i].owned-B[i].reserved);u=Math.min(l,d);var p=Object.assign({},B[i]);p.reserved+=u,B[i]=p}else{var b=c.outbox[i],m=Math.floor(M-B[i].owned-B[i].pending);u=Math.min(b,m);var g=Object.assign({},B[i]);g.pending+=u,B[i]=g}return a.amount=u,t.status=X,t.timeThreshold=8,t.jobDescription=a,t}return e}));H.jobQueue=q,H.jobQueueMap=K,V.forEach((function(e){if(e.status!==Q&&(e.progress+=r.tickIntervalSeconds,e.progress>=e.timeThreshold)){e.progress-=e.timeThreshold;var t=e.jobDescription,a=t.from,n=t.to,o=t.carrying,i=t.amount,c=null,s=null;switch("warehouse"!==a?F.hasOwnProperty(a)&&(c=Object.assign({},F[a]),F[a]=c):c=x,"warehouse"!==n?F.hasOwnProperty(n)&&(s=Object.assign({},F[n]),F[n]=s):s=x,e.status){case X:var u=Object.assign({},e.payload);if(e.payload=u,"warehouse"===a){var l=Object.assign({},B[o]);B[o]=l,l.owned-=i,l.reserved-=i,u[o]=i}else{if(!c){e.payload={},e.status=Q,e.jobDescription={},e.progress=0,e.timeThreshold=0,delete K[e.jobDescription.id];break}var d=Object.assign({},c.outbox);c.outbox=d,d[o]-=i,u[o]=i,delete K[e.jobDescription.id]}e.status=$,e.timeThreshold=20;break;case $:e.status=Z,e.timeThreshold=8;break;case Z:var p=Object.assign({},e.payload);if("warehouse"===n){var b=Object.assign({},B[o]);B[o]=b,b.owned+=p[o],b.pending-=i}else{if(s){var m=Object.assign({},s.inbox);s.inbox=m,m[o]+=i}else{var g=Object.assign({},B[o]);B[o]=g,g.owned+=p[o]}delete K[e.jobDescription.id]}e.payload={},e.status=Q,e.jobDescription={},e.progress=0,e.timeThreshold=0}}}));var ee=V.filter((function(e){return e.status!==Q||!e.markedForDeath}));return H.couriers=ee,_.couriers=H,_;default:return e}};function re(e,t){for(var r=0;r<t;r++){var a=Object.assign({},ee,{id:N()()});e.push(a)}}var ae="_SUPPLY",ne="_PICKUP";function oe(e,t,r){for(var a=e.jobQueueMap,n=t.totalCapacity,o=t.resources,i={jobList:[],jobRef:{}},c=0,s=Object.values(r);c<s.length;c++){var u=s[c];if(w[u.buildingId].category===h.PRODUCER)for(var l=0,d=Object.entries(u.inbox);l<d.length;l++){var p=d[l],b=Object(g.a)(p,2),m=b[0],f=b[1],O=u.id+"_"+m+"_"+ae;if(f<W&&!a[O]){var v=o[m];if(Math.floor(v.owned-v.reserved)>0){var y={id:O,from:"warehouse",to:u.id,carrying:m};i.jobList.push(y),i.jobRef[O]=y}}}}var E=Object.values(r).reduce((function(e,t){if(w[t.buildingId].category!==h.PRODUCER)return e;for(var r=0,i=Object.entries(t.outbox);r<i.length;r++){var c=i[r],s=Object(g.a)(c,2),u=s[0],l=s[1],d=t.id+ne;if(l>0&&!a[d]){var p=o[u];if(Math.floor(n-p.owned-p.pending)>0){var b={id:d,from:t.id,to:"warehouse",carrying:u};e.jobList.push(b),e.jobRef[d]=b}}}return e}),{jobList:[],jobRef:{}});return{jobList:i.jobList.concat(E.jobList),jobRef:Object.assign({},i.jobRef,E.jobRef)}}function ie(e,t){for(var r=0;r<e.length;r++){var a=e[r],n=a.from,o=a.to;if(("warehouse"===n||t.hasOwnProperty(n))&&("warehouse"===o||t.hasOwnProperty(o)))return r}}function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue={popProgress:0,currentPop:1},le={peasanthouse:.8,citizenhouse:.6,patrician:.4,noblehouse:0},de={peasanthouse:["peasanthouse","citizenhouse","patricianhouse","noblehouse"],citizenhouse:["citizenhouse","patricianhouse","noblehouse"],patricianhouse:["patricianhouse","noblehouse"],noblehouse:["noblehouse"]};function pe(e,t,r){var a=de[r].reduce((function(t,r){return t+e[r].owned}),0);t.totalAscensionRights=Math.floor(le[r]*a);var n=w[r].ascendsTo,o=de[n].reduce((function(t,r){return t+e[r].owned}),0);t.remainingAscensionRights=t.totalAscensionRights-o}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ge={owned:0,maxPopulation:0,happiness:0,canAscend:!1,consumeInfo:""},fe={owned:0,maxPopulation:0,happiness:0,unhoused:0,beggarTimer:0};function Oe(e){return Math.floor(.1*e.citizen.maxPopulation+.2*e.patrician.maxPopulation+.3*e.noble.maxPopulation)}var he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:for(var a=r.tickIntervalSeconds,n=Object.assign({},e),o=e.buildings,i={},c=0,s=Object.values(o.owned);c<s.length;c++){var u=s[c],d=w[u.buildingId];if(d.category===h.AMENITY)for(var p=0,b=Object.entries(d.produces);p<b.length;p++){var m=b[p],f=Object(g.a)(m,2),O=f[0],v=f[1];i[O]||(i[O]=0),i[O]+=v*a*(1/60)}}return n.amenities=i,n;default:return e}},ve={beggar:{name:"Beggar",taxRate:0,consumes:{fish:{quantity:.7,weight:0},cider:{quantity:.3,weight:0}}},peasant:{name:"Peasant",taxRate:.96,consumes:{community:{quantity:1,weight:25},fish:{quantity:1,weight:25},cider:{quantity:.44,weight:25},faith:{quantity:1,weight:25}}},citizen:{name:"Citizen",taxRate:1.14,consumes:{fish:{quantity:.4,weight:8},spice:{quantity:.4,weight:12},cider:{quantity:.44,weight:16},linen:{quantity:.42,weight:16},community:{quantity:1,weight:16},faith:{quantity:1,weight:16},entertainment:{quantity:1,weight:16}}},patrician:{name:"Patrician",taxRate:1.26,consumes:{fish:{quantity:.22,weight:2.8},spice:{quantity:.22,weight:4.9},bread:{quantity:.55,weight:6.3},cider:{quantity:.23,weight:4},ale:{quantity:.24,weight:9},linen:{quantity:.19,weight:4.5},leather:{quantity:.28,weight:8.5},community:{quantity:1,weight:12},faith:{quantity:1,weight:12},entertainment:{quantity:1,weight:12},book:{quantity:.16,weight:12},security:{quantity:1,weight:12}}},noble:{name:"Noble",taxRate:1.38,consumes:{}}},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var a=r.tickIntervalSeconds,n=Object.assign({},e),o=Object.assign({},n.warehouse),i=Object.assign({},o.resources);o.resources=i;var c=n.amenities,s=Object.assign({},n.population);n.warehouse=o,n.population=s;for(var u=0,d=Object.entries(e.population);u<d.length;u++){var p=d[u],b=Object(g.a)(p,2),m=b[0],f=b[1],O=Object.assign({},f);O.consumeInfo=null;var h=0;if(0!==f.owned)for(var v=0,y=Object.entries(ve[m].consumes);v<y.length;v++){var w=y[v],E=Object(g.a)(w,2),j=E[0],P=E[1],k=P.quantity*O.owned*a*(1/60)*.01,S=1;if(c[j])c[j]<k&&(S=c[j]/k,O.consumeInfo||(O.consumeInfo="Need "+j)),c[j]-=k,c[j]<0&&(c[j]=0);else if(i[j]){var D=Object.assign({},i[j]);i[j]=D,D.owned<k&&(S=D.owned/k,O.consumeInfo||(O.consumeInfo="Need "+j)),D.owned-=k,D.owned<0&&(D.owned=0)}else S=0,O.consumeInfo||(O.consumeInfo="Need "+j);h+=P.weight*S}var I=(h-O.happiness)/100;Math.abs(I)<.001&&(I=.001),O.happiness+=I,s[m]=O}return n;default:return e}},we=r(56),Ee=r.n(we);function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ke=20,Se=200,De=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var a=r.tickIntervalSeconds,n=Object.assign({},e),o=Object.assign({},n.housing),i=Object.assign({},n.population);n.housing=o,n.population=i;var c={},s=o.abodes.map((function(e){var t=Object.assign({},e),r=i[w[t.houseId].populationCategory].happiness,n=0;r>=40&&t.currentPop<t.populationCap&&(n=1),r<=20&&t.currentPop>0&&(n=-1),t.popProgress+=a*n,(t.popProgress>10||t.popProgress<-10)&&(t.popProgress-=10*n,t.currentPop+=n),t.currentPop<1&&(t.currentPop=1);var o=w[t.houseId].populationCategory;return c[o]||(c[o]=0),c[o]+=t.currentPop,t}));o.abodes=s;for(var u=0,d=Object.entries(c);u<d.length;u++){var p=d[u],b=Object(g.a)(p,2),m=b[0],f=b[1],O=Object.assign({},i[m]);O.owned=f,i[m]=O}var h=Pe({},i.beggar);if(h.owned<h.maxPopulation&&(h.beggarTimer+=a,h.beggarTimer>1200)){h.beggarTimer-=1200;var v=Ie(h.maxPopulation-h.owned);h.owned+=v}return i.beggar=h,n;default:return e}};function Ie(e){var t=Math.max(e,ke),r=Math.min(t,Se);return Ee()({min:t,max:r,integer:!0})}var Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var a=r.tickIntervalSeconds,n=Object.assign({},e),o=Object.assign({},n.warehouse),i=Object.assign({},o.resources),c=Object.assign({},i.gold);n.warehouse=o,o.resources=i,i.gold=c;var s={maintenanceCost:0,taxRevenue:0},u=w[o.type].upkeep*a*(1/60),d=Object.values(e.buildings.owned).reduce((function(e,t){return e+(t.enabled?w[t.buildingId].upkeep:w[t.buildingId].disabledUpkeep)*a*(1/60)}),u),p=Object.values(e.population).reduce((function(e,t){var r=.01*t.happiness;return r<.01&&(r=.01),e+ve[t.id].taxRate*t.owned*a*(1/60)*r}),0);return s.maintenanceCost=d,s.taxRevenue=p,n.financeInfo=s,c.owned=c.owned+p-d,n;default:return e}},Ce=[["peasant",60],["peasant",90],["citizen",1],["citizen",240],["citizen",355],["patrician",1],["patrician",510],["patrician",690],["patrician",940],["patrician",1190],["noble",950],["noble",2200],["noble",3500],["noble",7500]],Ue=[{title:"Small Settlement",buildings:["marketplace","fishinghut","lumberjackhut"],population:"peasant",resources:["gold","wood","tool","fish"]},{buildings:["orchard","ciderfarm"],resources:["apple","cider"]},{title:"Settlement",buildings:["chapel"]},{population:"citizen",resources:["hemp","linen","stone","spice"],buildings:["hempfarm","weavers","stonemason"],housing:["citizenhouse"]},{resources:["ore","charcoal","iron","rope"],buildings:["oremine","charcoalhut","smelter","toolmaker","ropeyard","smallshipyard"]},{title:"Village",buildings:["smallstorehouse","repaircrane","tavern","alms"]},{population:"patrician",resources:["wheat","flour","bread","weapon"],buildings:["wheatfield","mill","bakery","weaponsmith","largeshipyard"],housing:["patricianhouse"]},{title:"Small Town",resources:["hop","ale","potash","quartz","glass"],buildings:["hopsfield","brewery","potashpit","glasssmelter","church"]},{resources:["brine","salt","hide","leather"],buildings:["saltmine","saltworks","pigfarm","tannery"]},{resources:["paper","book","ink"],buildings:["papermill","printingpress"]},{title:"City",buildings:["prison"]},{title:"Major City"},{title:"Commercial Center"},{title:"Metropolis"},{title:"Cosmopolitan City"}];function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.TICK:var r=Object(g.a)(Ce[e.island.level-1],2),a=r[0],n=r[1],o=e.population[a].owned;if(o>=n){var i=Object.assign({},e),c=Object.assign({},i.island);i.island=c,c.level++;var s=Ue[c.level-1];if(s.title&&(c.title=s.title),s.buildings){var u=Object.assign({},i.construction);i.construction=u,s.buildings.forEach((function(e){var t=Object.assign({},u[e]);t.unlocked=!0,u[e]=t}))}if(s.resources){var d=Object.assign({},i.warehouse),p=Object.assign({},d.resources);i.warehouse=d,d.resources=p,s.resources.forEach((function(e){var t=Object.assign({},p[e]);p[e]=t,t.unlocked=!0}))}if(s.population){var b=Object.assign({},i.population);i.population=b;var m=Object.assign({},b[s.population]);m.unlocked=!0,b[s.population]=m}if(s.housing){var f=Ae({},i.housing.types),O=Ae({},i.housing,{types:f});i.housing=O,s.housing.forEach((function(e){var t=Ae({},f[e],{unlocked:!0});f[e]=t}))}return i}return e;default:return e}},Le={SET_TIME_FACTOR:"SET_TIME_FACTOR"};function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case Le.SET_TIME_FACTOR:return He({},e,{cheat:{timeFactor:r.timeFactor}});default:return e}},Me={lord:{name:"Lord Farquaad",rates:{wood:{buy:.5,sell:1.2},tool:{buy:.5,sell:1.2},stone:{buy:.5,sell:1.2},spice:{buy:1,sell:0}},baseCapacity:30},prince:{name:"Prince Ali",rates:{wood:{buy:1,sell:1},tool:{buy:1,sell:1.2},spice:{buy:0,sell:1.25}},baseCapacity:40}};function Be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Fe=360,We=180,ze={traderId:0,timer:0,timeToLeave:Fe,wares:{},newGame:!0,dismissCost:100};function qe(e){if(0!==e.traderId){var t=Ge({},e);return t.traderId=0,t.wares={},t.time=0,t.timeToLeave=We,t}var r=Object.keys(Me),a=r[Math.floor(Math.random()*r.length)];e.newGame&&(e.newGame=!1,a="lord");for(var n=Me[a],o={},i=n.baseCapacity,c=Ge({},e,{traderId:a,wares:o,maxCapacity:i,timeToLeave:Fe}),s=0,u=Object.entries(n.rates);s<u.length;s++){var l=u[s],d=Object(g.a)(l,2),p=d[0],b=d[1],m=k[p].baseTradePrice,f=b.buy*m,O=b.sell*m;o[p]={buyPrice:f,sellPrice:O,held:0},O>0&&(o[p].held=Math.floor(.75*i))}return c}var Ke={EMBARK:"EMBARK"};var Ye={flagship:{typeName:"Flagship",capacity:160,speed:1,loadFactor:.2,hp:600,attack:6,maintenance:0,cost:{gold:3500}},smalltrader:{typeName:"Small Trading Ship",capacity:120,speed:.86,loadFactor:.15,hp:400,attack:0,maintenance:15,points:1,cost:{gold:1500,wood:15,rope:20}},smallwarship:{typeName:"Small Warship",capacity:40,speed:1.07,loadFactor:.3,hp:500,attack:6,maintenance:30,points:1,cost:{gold:2e3,wood:30,rope:30,weapon:20}},largetrader:{typeName:"Large Trading Vessel",capacity:240,speed:.97,loadFactor:.1,hp:1e3,attack:0,maintenance:50,points:2,cost:{gold:4e3,wood:60,rope:60}},largewarship:{typeName:"Large Warship",capacity:80,speed:.97,loadFactor:.25,hp:1200,attack:14,maintenance:60,points:2,cost:{gold:4500,wood:70,rope:70,cannon:20}},corsair:{typeName:"Pirate Corsair",speed:.86,hp:500,attack:7,points:1},smallpiratewarship:{typeName:"Small Pirate Warship",speed:.97,hp:800,attack:8,points:2},largepiratewarship:{typeName:"Large Pirate Warship",speed:1.07,hp:1e3,attack:10,points:3}},Ve={home:{duloc:300,agrabah:500},duloc:{home:300,agrabah:200},agrabah:{home:500,duloc:200}},Je={home:{name:"Home Base"},duloc:{name:"Duloc",rates:{wood:[.5,1.25],tool:[.5,1.25],stone:[.5,1.25],glass:[.5,1.25],spice:[1,0],fish:[0,1.25],bread:[0,1.25],meat:[0,1.25],cider:[0,1.25],beer:[0,1.25],wine:[0,1.25],linen:[0,1.25],leather:[0,1.25],furcoat:[0,1.25],silkcoat:[0,1.25],book:[0,1.25],glasses:[0,1.25],candlestick:[0,1.25],salt:[.5,1],hemp:[0,1],brine:[0,1],ore:[.5,1],iron:[.5,1],flour:[0,1],coal:[.5,1],hide:[0,1],wheat:[0,1],hop:[0,1],potash:[.5,1],paper:[0,1],fur:[0,1],barrel:[0,1],copper:[0,1],brass:[0,1],grape:[0,1],cattle:[0,1],beeswax:[0,1],candle:[0,1],goldore:[0,1],indigo:[.5,0],goldbar:[0,1],silk:[.5,0],quartz:[.5,0],rope:[.5,1.25],weapon:[.5,0],warmachine:[.5,0],cannon:[.5,0]}},agrabah:{name:"Agrabah",rates:{wood:[1,1],tool:[1,1.25],stone:[1,1],glass:[1,1],spice:[0,1.25],fish:[1,0],bread:[1,0],meat:[1,0],cider:[0,0],beer:[0,0],wine:[0,0],linen:[1,0],leather:[1,0],furcoat:[1,0],silkcoat:[1,0],book:[1,0],glasses:[1,0],candlestick:[1,0],salt:[.5,1],hemp:[.5,0],brine:[.5,0],ore:[.5,1],iron:[.5,1],flour:[.5,0],coal:[.5,1],hide:[.5,0],wheat:[.5,0],hop:[0,0],potash:[.5,1],paper:[.5,0],fur:[.5,0],barrel:[.5,0],copper:[.5,0],brass:[.5,0],grape:[0,1],cattle:[.5,0],beeswax:[.5,0],candle:[.5,0],goldore:[.5,0],indigo:[0,1],goldbar:[.5,0],silk:[0,1],quartz:[.5,1],rope:[1,1],weapon:[.5,0],warmachine:[.5,0],cannon:[.5,0]}}};function Qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $e={cargo:{}},Ze={currentLocation:"home",currentDestination:null,destinationTimer:0,travelProgress:0,ships:[]};function et(e,t){var r=null;return e.forEach((function(e){var a=Ye[t[e].typeName].speed;(!r||r>a)&&(r=a)})),r}function tt(e){return Object.values(e).reduce((function(e,t){return e+t}),0)}function rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var nt={toLoad:{},toUnload:{},warehouseMaximum:0,inventory:{},cargoMaximum:0,cargo:{},cargoUsed:0,dockId:null,balance:0};function ot(e){var t={};return Object.entries(e.inventory).forEach((function(e){var r=Object(g.a)(e,2),a=r[0],n=r[1];t[a]=at({},n)})),at({},e,{toLoad:at({},e.toLoad),toUnload:at({},e.toUnload),cargo:at({},e.cargo),inventory:t})}function it(e){return Object.values(e).reduce((function(e,t){return e+Ye[t.typeName].capacity}),0)}function ct(e){return Object.values(e).reduce((function(e,t){return Object.entries(t.cargo).forEach((function(t){var r=Object(g.a)(t,2),a=r[0],n=r[1];e.hasOwnProperty(a)?e[a]+=n:e[a]=n})),e}),{})}function st(e){return 30+10*(e-1)}var ut=.8;function lt(e,t){return Object.entries(e.rates).reduce((function(e,r){var a=Object(g.a)(r,2),n=a[0],o=a[1];if(o[1]>0){if(k.hasOwnProperty(n)){var i=k[n].baseTradePrice*o[1];e[n]={onHand:t*o[1]*ut,sellPrice:i}}}else k.hasOwnProperty(n)&&(e[n]={onHand:0,sellPrice:0});return e}),{})}function dt(e){return Object.entries(e).reduce((function(e,t){var r=Object(g.a)(t,2),a=r[0],n=r[1];return"gold"!==n.id&&(e[a]={onHand:n.owned}),e}),{})}function pt(e,t,r,a){if("home"===a)return 0;var n=Object.entries(e).reduce((function(e,t){var a=Object(g.a)(t,2),n=a[0],o=a[1];return e-r[n].sellPrice*o}),0),o=Je[a].rates;return n=Object.entries(t).reduce((function(e,t){var r=Object(g.a)(t,2),a=r[0],n=r[1],i=k[a];return e+o[a][0]*n*i.baseTradePrice}),n)}var bt={island:{level:1,title:"Small Settlement",name:"Townsville"},construction:{peasanthouse:{id:"peasanthouse",owned:0,cost:{wood:2},unlocked:!0},marketplace:{id:"marketplace",owned:0,cost:{gold:400,wood:5,tool:3},unlocked:!0},fishinghut:{id:"fishinghut",owned:0,cost:{gold:100,wood:3,tool:2},unlocked:!0},lumberjackhut:{id:"lumberjackhut",owned:0,cost:{gold:50,tool:2},unlocked:!0},smallstockpile:{id:"smallstockpile",owned:0,cost:{gold:200,wood:2,tool:3},unlocked:!0},orchard:{id:"orchard",owned:0,cost:{gold:25},unlocked:!1},ciderfarm:{id:"ciderfarm",owned:0,cost:{gold:100,wood:5,tool:1},unlocked:!1},chapel:{id:"chapel",owned:0,cost:{gold:800,wood:12,tool:5},unlocked:!1},hempfarm:{id:"hempfarm",owned:0,cost:{gold:400,wood:5,tool:2},unlocked:!1},weavers:{id:"weavers",owned:0,cost:{gold:400,wood:5,tool:3}},stonemason:{id:"stonemason",owned:0,cost:{gold:400,wood:2,tool:2}},oremine:{id:"oremine",owned:0,cost:{gold:900,wood:12,tool:2,stone:2}},charcoalhut:{id:"charcoalhut",owned:0,cost:{gold:250,wood:3,tool:2,stone:2}},smelter:{id:"smelter",owned:0,cost:{gold:600,wood:10,tool:5,stone:2}},toolmaker:{id:"toolmaker",owned:0,cost:{gold:500,wood:8,tool:5,stone:2}},ropeyard:{id:"ropeyard",owned:0,cost:{gold:700,wood:12,tool:5}},smallshipyard:{id:"smallshipyard",owned:0,cost:{gold:680,wood:10,tool:5,stone:4}},smallstorehouse:{id:"smallstorehouse",owned:0,cost:{gold:1020,wood:4,tool:4,stone:1}},repaircrane:{id:"repaircrane",owned:0,cost:{gold:1020,wood:5,tool:5,stone:9}},tavern:{id:"tavern",owned:0,cost:{gold:1e3,tool:5,stone:10}},alms:{id:"alms",owned:0,cost:{gold:200,wood:5,tool:5}},wheatfield:{id:"wheatfield",owned:0,cost:{gold:200,wood:3,tool:2}},mill:{id:"mill",owned:0,cost:{gold:800,wood:8,tool:4,stone:4}},bakery:{id:"bakery",owned:0,cost:{gold:700,wood:5,tool:5,stone:5}},weaponsmith:{id:"weaponsmith",owned:0,cost:{gold:1500,wood:3,tool:5,stone:10}},largeshipyard:{id:"largeshipyard",owned:0,cost:{gold:2120,wood:20,tool:25,stone:46}},hopsfield:{id:"hopsfield",owned:0,cost:{gold:200,wood:5,tool:2,stone:4}},brewery:{id:"brewery",owned:0,cost:{gold:600,wood:5,tool:4,stone:6}},potashpit:{id:"potashpit",owned:0,cost:{gold:500,wood:6,tool:4,stone:8}},glasssmelter:{id:"glasssmelter",owned:0,cost:{gold:1200,wood:10,tool:5,stone:12}},church:{id:"church",owned:0,cost:{gold:5e3,wood:30,tool:10,stone:40,glass:25}},saltmine:{id:"saltmine",owned:0,cost:{gold:800,wood:11,tool:4,stone:5}},saltworks:{id:"saltworks",owned:0,cost:{gold:900,wood:3,tool:5,stone:6}},pigfarm:{id:"pigfarm",owned:0,cost:{gold:400,wood:4,tool:4,stone:3}},tannery:{id:"tannery",owned:0,cost:{gold:700,wood:7,tool:3,stone:8}},papermill:{id:"papermill",owned:0,cost:{gold:1500,wood:5,tool:5,stone:12}},printingpress:{id:"printingpress",owned:0,cost:{gold:1800,wood:5,tool:5,stone:12,glass:10}},prison:{id:"prison",owned:0,cost:{gold:7e3,wood:20,tool:30,stone:60,glass:24}}},buildings:{owned:{}},warehouse:{type:"smallwarehouse",totalCapacity:40,resources:{gold:{id:"gold",owned:5e3,unlocked:!0},tool:{id:"tool",owned:40,unlocked:!0},fish:{id:"fish",owned:2,unlocked:!0},wood:{id:"wood",owned:40,unlocked:!0}}},couriers:{couriers:[],jobQueue:[],jobQueueMap:{}},housing:{types:{peasanthouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!0},citizenhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},patricianhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},noblehouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1}},abodes:[]},population:{beggar:{id:"beggar",unlocked:!0},peasant:{id:"peasant",unlocked:!0},citizen:{id:"citizen",unlocked:!1},patrician:{id:"patrician",unlocked:!1},noble:{id:"noble",unlocked:!1}}},mt=Object(s.c)({cheat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},island:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.CHANGE_NAME:return m({},e,{name:r.name});default:return e}},warehouse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:var a=Object.assign({},e),n=D({},a.resources);Object.keys(k).forEach((function(e){n.hasOwnProperty(e)||(n[e]=D({},T,{id:e}))}));var o=Object.entries(n).reduce((function(e,t){var r=Object(g.a)(t,2),a=r[0],n=r[1],o=Object.assign({},n,I);return e[a]=o,e}),n);return a.resources=o,a;case E.BUILD_HOUSE:case E.ASCEND_HOUSE:case O.CONSTRUCT_BUILDING:var i=Object.assign({},e),c=r.toConstruct.cost,s=C(i.resources,c);return i.resources=s,i;case f.BUILD_WAREHOUSE:var u=Object.assign({},e),d=r.toConstruct.cost,b=C(u.resources,d);u.resources=b;var m=w[r.toConstruct.id];return u.totalCapacity+=m.capacity,u;case f.UPDGRADE_WAREHOUSE:var h=Object.assign({},e),v=w[e.type],y=w[v.upgradesTo];if(!y)return e;var S=v.upgradeCost,U=C(h.resources,S);return h.resources=U,h.totalCapacity+=y.capacity,h.type=w[e.type].upgradesTo,h;case f.UPGRADE_STOREHOUSE:var R=Object.assign({},e),A=w[r.toUpgrade.buildingId],N=w[A.upgradesTo];if(!N)return e;var L=A.upgradeCost,_=C(R.resources,L);return R.resources=_,R.totalCapacity+=N.capacity,R;case j.DISMISS_TRADER:var H=r.cost,x=C(e.resources,H);return D({},e,{resources:x});case j.BUY_GOODS:var M=r.product,B=r.amount,G=r.atPrice,F=D({},e.resources.gold);F.owned-=B*G;var W=D({},e.resources[M]);W.owned+=B;var z=D({},e.resources,Object(p.a)({gold:F},M,W));return D({},e,{resources:z});case j.SELL_GOODS:var q=r.product,K=r.amount,Y=r.atPrice,V=D({},e.resources.gold);V.owned+=K*Y;var J=D({},e.resources[q]);J.owned-=K;var Q=D({},e.resources,Object(p.a)({gold:V},q,J));return D({},e,{resources:Q});case P.CONFIRM:var X=r.cost,$=D({},e.resources),Z=D({},$.gold);if($.gold=Z,Z.owned+=X,"home"===r.dockId){var ee=r.toLoad;Object.entries(ee).forEach((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];if($[r]){var n=D({},$[r]);n.owned-=a,$[r]=n}else console.error(r+" not found in the warehouse")}));var te=r.toUnload;Object.entries(te).forEach((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];if($[r]){var n=D({},$[r]);n.owned+=a,$[r]=n}else console.error(r+" not found in the warehouse")}))}return D({},e,{resources:$});default:return e}},construction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case f.BUILD_WAREHOUSE:case E.BUILD_HOUSE:case O.CONSTRUCT_BUILDING:var a=r.toConstruct.id,n=e[a],o=Object.assign({},n,{owned:n.owned+1});return Object.assign({},e,Object(p.a)({},a,o));case O.DESTROY_BUILDING:var i=r.toDestroy.buildingId,c=R({},e[i]);return c.owned--,R({},e,Object(p.a)({},i,c));default:return e}},buildings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:if(!e.owned)return e;var a=Object.assign({},e),n=Object.assign({},a.owned);a.owned=n;var o=r.tickIntervalSeconds;return Object.values(e.owned).forEach((function(e){var t=null;t=w[e.buildingId].category===h.PRODUCER?q(e,o):e,n[t.id]=t})),a;case f.BUILD_WAREHOUSE:case O.CONSTRUCT_BUILDING:var i=w[r.toConstruct.id],c=Object.assign({},{id:N()(),buildingId:r.toConstruct.id,enabled:!0});i.category===h.PRODUCER&&z(c=Object.assign(c,x));var s=Object.assign({},e.owned);return s[c.id]=c,Object.assign({},e,{owned:s});case f.UPGRADE_STOREHOUSE:var u=H({},e.owned[r.toUpgrade.id]);u.buildingId=w[r.toUpgrade.buildingId].upgradesTo;var d=H({},e.owned,Object(p.a)({},r.toUpgrade.id,u));return H({},e,{owned:d});case O.DESTROY_BUILDING:var b=r.toDestroy,m=H({},e.owned);return delete m[b.id],H({},e,{owned:m});case L.DISABLE_BUILDING:var g=r.id,v=H({},e.owned[g],{enabled:!1}),y=H({},e.owned,Object(p.a)({},g,v));return H({},e,{owned:y});case L.ENABLE_BUILDING:var E=r.id,j=H({},e.owned[E],{enabled:!0}),P=H({},e.owned,Object(p.a)({},E,j));return H({},e,{owned:P});default:return e}},couriers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},housing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case E.BUILD_HOUSE:var a=Object.assign({},e),n=Object.assign({},a.types),o=a.abodes.slice(0);a.types=n,a.abodes=o;var i=r.toConstruct.id,c=Object.assign({},n[i]);n[i]=c;var s=w[i],u=se({},ue,{houseId:i,populationCap:s.populationCap});return c.owned+=1,o.push(u),pe(n,c,i),a;case E.ASCEND_HOUSE:var l,d=r.fromHouse,b=w[d].ascendsTo,m=se({},e.types[d]),g=se({},e.types[b]),f=se({},e.types,(l={},Object(p.a)(l,d,m),Object(p.a)(l,b,g),l)),O=Object(Y.a)(e.abodes),h=se({},e,{types:f,abodes:O}),v=w[b],y=O.findIndex((function(e){return e.houseId===d}));return O.splice(y,1),O.push(se({},v,{},ue,{houseId:b})),m.owned-=1,g.owned+=1,pe(f,m,d),pe(f,g,b),h;default:return e}},population:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:for(var a=Object.assign({},e),n=0,o=Object.entries(a);n<o.length;n++){var i=o[n],c=Object(g.a)(i,2),s=c[0],u=c[1];if("beggar"===s)a[s]=me({},fe,{},u);else{var d=Object.assign({},u,ge);a[s]=d}}return a;case E.BUILD_HOUSE:var b=w[r.toConstruct.id],m=Object.assign({},e),f=Object.assign({},m[b.populationCategory]);return m[f.id]=f,f.maxPopulation+=b.populationCap,m;case l.TICK:for(var O=Object.assign({},e),h=0,v=Object.entries(O);h<v.length;h++){var y=v[h],j=Object(g.a)(y,2),P=j[0],k=j[1];k.happiness>97&&k.owned===k.maxPopulation?O[P]=me({},k,{canAscend:!0}):O[P]=me({},k,{canAscend:!1})}return O;case E.ASCEND_HOUSE:var S,D=w[r.fromHouse],I=w[D.ascendsTo],T=me({},e[D.populationCategory]),C=me({},e[I.populationCategory]);T.owned-=D.populationCap,C.owned+=D.populationCap,T.maxPopulation-=D.populationCap,C.maxPopulation+=I.populationCap;var U=me({},e,(S={},Object(p.a)(S,D.populationCategory,T),Object(p.a)(S,I.populationCategory,C),S)),R=Oe(U);return U.beggar=me({},U.beggar,{maxPopulation:R}),U;default:return e}},trader:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ze,t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case j.BUY_GOODS:var a=r.product,n=r.amount,o=Ge({},e.wares),i=Ge({},e,{wares:o});return o[a].held-=n,i;case j.SELL_GOODS:var c=r.product,s=r.amount,u=Ge({},e.wares),d=Ge({},e,{wares:u});return u[c].held+=s,d;case l.TICK:var p=r.tickIntervalSeconds,b=Ge({},e);return b.timer+=p,b.timer>b.timeToLeave?(b.timer-=b.timeToLeave,qe(b)):b;case j.DISMISS_TRADER:var m=qe(e);return m;default:return e}},navy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:var a=Xe({},$e,{id:N()(),typeName:"flagship",currentHp:Ye.flagship.hp,name:"Flagship"}),n=Object(p.a)({},a.id,a),o=N()(),i=Object(p.a)({},o,Xe({},Ze,{id:o,name:"Fleet 1",ships:[a.id]})),c={};return{ships:n,fleets:i,dockBuildings:c};case Ke.EMBARK:if(!r.destination||r.destination===e.currentLocation)return e;var s=Xe({},e.fleets[r.fleetId]);if(!e.fleets[r.fleetId]||s.currentDestination)return e;var u=Ve[s.currentLocation][r.destination];s.currentDestination=r.destination,s.destinationTimer=u;var d=Xe({},e.fleets,Object(p.a)({},r.fleetId,s));return Xe({},e,{fleets:d});case l.TICK:var b=r.tickIntervalSeconds,m={};return Object.entries(e.fleets).forEach((function(t){var r=Object(g.a)(t,2),a=r[0],n=r[1];if(n.currentDestination){var o=Xe({},n),i=et(o.ships,e.ships);o.travelProgress+=b*i,o.travelProgress>=o.destinationTimer&&(o.travelProgress=0,o.destinationTimer=0,o.currentLocation=o.currentDestination,o.currentDestination=null),m[a]=o}else m[a]=n})),Xe({},e,{fleets:m});case P.CONFIRM:var f=Xe({},e.fleets[r.fleetId]),O=Xe({},e.ships),h=r.toUnload;Object.entries(h).forEach((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];f.ships.forEach((function(e){var t=Xe({},O[e]);if(a>0&&t.cargo.hasOwnProperty(r)){O[e]=t;var n=Xe({},t.cargo);t.cargo=n,n[r]>a?(n[r]-=a,a=0):(a-=n[r],delete n[r])}}))}));var v=r.toLoad;return Object.entries(v).forEach((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];f.ships.forEach((function(e){var t=Xe({},O[e]),n=Xe({},t.cargo),o=tt(n),i=Ye[t.typeName].capacity;if(o<i&&a>0){var c=Math.min(a,i-o);n.hasOwnProperty(r)||(n[r]=0),n[r]+=c,a-=c,t.cargo=n,O[e]=t}}))})),Xe({},e,{fleets:Xe({},e.fleets,Object(p.a)({},r.fleetId,f)),ships:O})}return e},foreignTrade:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt,t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case P.SETUP:var a=ot(e),n=it(r.ships),o=ct(r.ships),i=Object.values(o).reduce((function(e,t){return e+t}),0);if(r.dockId===e.dockId){var c=e.inventory;if("home"===r.dockId){var s=r.warehouse;c=dt(s.resources)}return at({},e,{inventory:c,cargoMaximum:n,cargo:o,cargoUsed:i,backupState:a})}var u=Je[r.dockId],l=0,d={};if("home"===r.dockId){var p=r.warehouse;l=p.totalCapacity,d=dt(p.resources)}else d=lt(u,l=st(r.playerLevel));return{toLoad:{},toUnload:{},warehouseMaximum:l,inventory:d,cargoMaximum:n,cargo:o,cargoUsed:i,dockId:r.dockId,backupState:a,balance:0};case P.ONLOAD:var b=r.resourceId;if(!b)return e;var m=r.amount;"max"===m&&(m=e.inventory[b].onHand);var g=e.cargoMaximum-e.cargoUsed,f=e.inventory[b].onHand;if(m=Math.floor(Math.min(m,g,f)),isNaN(m)||m<1)return e;var O=at({},e.toUnload),h=0;O.hasOwnProperty(b)?(O[b]-=m,O[b]<0&&(h+=O[b],O[b]=0)):h=m;var v=at({},e.toLoad);v.hasOwnProperty(b)?v[b]+=h:v[b]=h;var y=at({},e.cargo);y.hasOwnProperty(b)?y[b]+=m:y[b]=m;var w=at({},e.inventory),E=at({},w[b]);E.onHand-=m,w[b]=E;var j=e.cargoUsed+m,k=pt(v,O,w,e.dockId);return at({},e,{cargoUsed:j,toLoad:v,toUnload:O,cargo:y,inventory:w,balance:k});case P.OFFLOAD:var S=r.resourceId;if(!S)return e;var D=r.amount;"max"===D&&(D=e.cargo[S]);var I=e.warehouseMaximum-e.inventory[S].onHand;if(D=Math.floor(Math.min(D,I,e.cargo[S])),isNaN(D)||D<1)return e;var T=at({},e.toLoad),C=0;T.hasOwnProperty(S)?(T[S]-=D,T[S]<0&&(C+=-T[S],T[S]=0)):C=D;var U=at({},e.cargo);U[S]-=D;var R=at({},e.toUnload);R.hasOwnProperty(S)?R[S]+=C:R[S]=C;var A=at({},e.inventory),N=at({},A[S]);N.onHand+=D,A[S]=N;var L=e.cargoUsed-D,_=pt(T,R,A,e.dockId);return at({},e,{cargoUsed:L,toLoad:T,toUnload:R,cargo:U,inventory:A,balance:_});case P.CANCEL:return at({},e.backupState,{backupState:{}});case P.CONFIRM:return at({},e,{toLoad:{},toUnload:{},balance:0});default:return e}}});var gt=function e(t,r){if(r.type===l.SAVE_GAME)return localStorage.setItem("save",btoa(JSON.stringify(t))),t;if(r.type===l.RESET_SAVE){var a=bt;return a=e(a,{type:l.INIT})}if(r.type===l.LOAD_GAME)return r.payload.saveState;if(r.type===l.TICK){var n=t.cheat.timeFactor;n||(n=1),r.payload.tickIntervalSeconds*=n}var o=xe(t,r),i=mt(o,r),c=te(i,r),s=he(c,r),u=ye(s,r),d=De(u,r),p=Te(d,r);return Ne(p,r)};r(73),r(74);var ft=r(57),Ot=r(58),ht=function(){function e(t,r){Object(ft.a)(this,e),this.targetFunction=t,this.targetInterval=r,this.running=!1}return Object(Ot.a)(e,[{key:"start",value:function(){var e=this;if(!this.running){var t=Date.now();this.running=!0;setTimeout(function r(){if(e.running){var a=Date.now(),n=a-t;e.targetFunction(n),t=a,setTimeout(r.bind(e),e.targetInterval)}}.bind(this),this.targetInterval)}}},{key:"stop",value:function(){this.running=!1}}]),e}(),vt=r(61),yt=r(21),wt=function(){var e=Object(c.d)((function(e){return e.island.name})),t=Object(c.d)((function(e){return e.island.title})),r=Object(c.c)();return n.a.createElement("div",{className:"title"},n.a.createElement("h4",null,"The ",t," of ",e),n.a.createElement("button",{onClick:function(){var e=prompt("Enter name");e&&r(function(e){return{type:l.CHANGE_NAME,payload:{name:e}}}(e.substring(0,100)))}},"Change Name"))},Et=function(){var e=Object(c.c)(),t=Object(a.useState)(1),r=Object(g.a)(t,2),o=r[0],i=r[1];return n.a.createElement("div",{className:"time-factor"},n.a.createElement("form",{onSubmit:function(t){e(function(e){return{type:Le.SET_TIME_FACTOR,payload:{timeFactor:e}}}(o)),t.preventDefault()}},n.a.createElement("input",{type:"number",name:"timeFactor",onChange:function(e){return i(e.target.value)},required:!0}),n.a.createElement("input",{type:"submit",value:"Set time factor"})))};function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var kt=function(e){return Object.entries(e).reduce((function(e,t){var r=Object(g.a)(t,2),a=r[0],n=r[1];return n.unlocked&&(e[a]=n),e}),{})},St=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cost",a=0,n=Object.entries(e[r]);a<n.length;a++){var o=n[a],i=Object(g.a)(o,2),c=i[0],s=i[1];if(!t[c])return Pt({},e,{canAfford:!1});if(t[c].owned<s)return Object.assign({},e,{canAfford:!1})}return Object.assign({},e,{canAfford:!0})},Dt=r(9),It=r(43),Tt=r(46),Ct=function(e){var t=e.cost,r=Object.entries(t).map((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];return n.a.createElement("div",{className:"construction-ingredient",key:r},k[r].name,": ",a)})),a=e.header?e.header:"Cost",o=n.a.createElement(Tt.a,{id:"Price"},n.a.createElement(Tt.a.Title,{as:"h3"},a),n.a.createElement(Tt.a.Content,null,r));return n.a.createElement(It.a,{placement:"top",delay:{show:500,hide:250},overlay:o},e.children)},Ut=(r(75),function(){var e=Object(c.d)((function(e){return e.warehouse.type})),t=Object(c.d)((function(e){return kt(e.warehouse.resources)}),c.b),r=Object(c.d)((function(e){return e.warehouse.totalCapacity})),a=w[e],o=Object(c.c)(),i=null;if(a.upgradesTo){var s=St({cost:a.upgradeCost},t).canAfford;i=n.a.createElement(Ct,{cost:a.upgradeCost,header:"Upgrade for"},n.a.createElement("div",null,n.a.createElement(Dt.a,{variant:"primary",size:"sm",onClick:function(){var t;o((t=e,{type:f.UPDGRADE_WAREHOUSE,payload:{toUpgrade:t}}))},disabled:!s},"Upgrade")))}return n.a.createElement("div",{className:"resource-panel"},n.a.createElement("h4",null,a.name),i,n.a.createElement("div",{className:"resource-list"},Object.keys(t).map((function(e,a){var o=k[e].name;return"gold"!==e?n.a.createElement("div",{key:e},o,": ",t[e].owned.toFixed(1)," / ",r):n.a.createElement("div",{key:e},o,": ",t[e].owned.toFixed(1))}))))}),Rt=(r(76),function(){var e=Object(c.d)((function(e){return e.couriers}),c.b);Object(c.d)((function(e){return e.buildings}),c.b);var t=e.couriers.map((function(e){return n.a.createElement("div",{className:"courier",key:e.id},n.a.createElement("div",null,e.status),n.a.createElement("div",null,e.progress.toFixed(1)),n.a.createElement("div",null,JSON.stringify(e.payload)))}));return n.a.createElement("div",{className:"courier-monitor"},t)}),At=r(20),Nt=(r(77),function(){var e=Object(c.d)((function(e){return e.warehouse.resources})),t=Object(c.d)((function(t){return function(e,t){return Object.entries(e).reduce((function(e,r){var a=Object(g.a)(r,2),n=a[0],o=a[1];return e[n]=St(o,t),e}),{})}(kt(t.construction),e)}),c.b),r=Object(c.c)(),a=Object.entries(t).map((function(e){var t=Object(g.a)(e,2),a=t[0],o=t[1],i=w[a],c=null;return c=i.category===h.HOUSE?function(){return r((e=o,{type:E.BUILD_HOUSE,payload:{toConstruct:e}}));var e}:i.category===h.WAREHOUSE?function(){return r((e=o,{type:f.BUILD_WAREHOUSE,payload:{toConstruct:e}}));var e}:function(){return r((e=o,{type:O.CONSTRUCT_BUILDING,payload:{toConstruct:e}}));var e},n.a.createElement("div",{className:"construction",key:a},n.a.createElement("div",{className:"construction-header"},n.a.createElement("p",null,i.name," ",i.abbreviation&&"("+i.abbreviation+")")),n.a.createElement("div",null,"Built: ",o.owned),n.a.createElement(Ct,{cost:o.cost,header:i.description},n.a.createElement("div",null,n.a.createElement(Dt.a,{variant:"primary",size:"sm",className:"purchase",onClick:c,disabled:!o.canAfford},"Buy"))))}));return n.a.createElement(At.a,{className:"construction-panel"},a)}),Lt=r(60),_t=r(17),Ht=function(e){var t=Object(c.d)((function(e){return e.warehouse.resources}),c.b),r=Object(c.c)(),a=e.building,o=w[a.buildingId];o.upgradesTo&&(o=St(o,t,"upgradeCost"));var i=function(e){r(function(e){return{type:O.DESTROY_BUILDING,payload:{toDestroy:e}}}(e))},s=function(e){var t;e.enabled?r((t=e.id,{type:L.DISABLE_BUILDING,payload:{id:t}})):r(function(e){return{type:L.ENABLE_BUILDING,payload:{id:e}}}(e.id))},u=function(e){var t;r((t=e,{type:f.UPGRADE_STOREHOUSE,payload:{toUpgrade:t}}))};return n.a.createElement(_t.a,{show:e.show,onHide:e.onClose},n.a.createElement(_t.a.Header,{closeButton:!0},n.a.createElement(_t.a.Title,null,o.name)),n.a.createElement(_t.a.Body,null,n.a.createElement("p",null,o.description),o.category===h.PRODUCER&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,a.status),n.a.createElement("div",null,"Efficiency: ",a.efficiency),n.a.createElement("div",{className:"inbox"},"Inbox: ",JSON.stringify(a.inbox)),n.a.createElement("div",{className:"outbox"},"Outbox: ",JSON.stringify(a.outbox)))),n.a.createElement(_t.a.Footer,null,o.category===h.PRODUCER&&n.a.createElement(Dt.a,{variant:"warning",size:"sm",onClick:function(){return s(a)}},a.enabled?"Disable":"Enable"),o.upgradesTo&&n.a.createElement(Ct,{cost:o.upgradeCost},n.a.createElement("div",null,n.a.createElement(Dt.a,{variant:"primary",size:"sm",disabled:!o.canAfford,onClick:function(){return u(a)}},"Upgrade"))),n.a.createElement(Dt.a,{variant:"danger",size:"sm",onClick:function(){return i(a)}},"Destroy")))},xt=function(e){var t=Object(a.useState)(!1),r=Object(g.a)(t,2),o=r[0],i=r[1],c=e.building,s=w[c.buildingId].name,u=null;if(w[c.buildingId].category!==h.PRODUCER)u="working";else switch(c.status){case y.DISABLED:u="disabled",s+=" (Disabled)";break;case y.AWAITING_RESOURCES:u="awaiting",s+=" - Awaiting resources!";break;case y.OUTBOX_FULL:u="outbox-full",s+=" - Outbox full!";break;case y.WORKING:u="working"}return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ht,{show:o,onClose:function(){return i(!1)},building:c}),n.a.createElement(It.a,{placement:"top",delay:{show:250,hide:250},overlay:function(e){return n.a.createElement(Lt.a,Object.assign({},e,{id:s}),s)}},n.a.createElement("div",{className:"building-icon "+u,onClick:function(){return i(!0)}},w[c.buildingId].abbreviation)))},Mt=(r(78),function(){var e=Object(c.d)((function(e){return e.buildings.owned}),c.b),t=Object.values(e).map((function(e){return n.a.createElement(xt,{building:e,key:e.id})}));return n.a.createElement(At.a,null,n.a.createElement("div",{className:"building-panel"},t))}),Bt=(r(79),function(){var e=Object(c.d)((function(e){return kt(e.population)}),c.b),t=Object.values(e).map((function(e){var t=ve[e.id].name,r=e.happiness?e.happiness.toFixed():0,a=null;return"beggar"===e.id&&(a=1200-e.beggarTimer),n.a.createElement("div",{className:"population",key:e.id},t,": ",e.owned," / ",e.maxPopulation," Happiness: ",r," ",e.consumeInfo," --- ",a)}));return n.a.createElement("div",{className:"population-panel"},t)}),Gt=(r(80),function(){var e=Object(c.d)((function(e){return e.warehouse.resources}),c.b),t=Object(c.c)(),r=Object(c.d)((function(e){return kt(e.housing.types)}),c.b),a=Object(c.d)((function(e){return e.population}),c.b),o=Object.keys(r).map((function(o){var i=w[o],c=w[i.ascendsTo];c&&(c=St(c,e));var s=a[i.populationCategory],u=r[o].remainingAscensionRights>0&&s.canAscend&&c.canAfford,l=u?r[o].remainingAscensionRights:0;return n.a.createElement("div",{className:"housing",key:o},n.a.createElement("div",{className:"housing-data"},i.name,": ",r[o].owned),c&&n.a.createElement(Ct,{cost:c.cost,header:l+" ascensions available"},n.a.createElement("div",null,n.a.createElement(Dt.a,{variant:"primary",size:"sm",onClick:function(){t(function(e,t){var r=w[t];return{type:E.ASCEND_HOUSE,payload:{toConstruct:r,fromHouse:e}}}(o,i.ascendsTo))},disabled:!u},"Ascend"))))}));return n.a.createElement("div",{className:"housing-panel"},o)}),Ft=function(){var e=Object(c.c)();return n.a.createElement("div",{className:"save-load"},n.a.createElement("button",{onClick:function(){e(d());var t=localStorage.getItem("save");navigator.clipboard.writeText(t).then((function(){alert("Saved to clipboard")}))}},"Save"),n.a.createElement("button",{onClick:function(){var t,r=JSON.parse(atob(prompt("Enter load data")));r?e((t=r,{type:l.LOAD_GAME,payload:{saveState:t}})):alert("Invalid save state")}},"Load"),n.a.createElement("button",{onClick:function(){window.confirm("Are you sure you want to clear your save?")&&e({type:l.RESET_SAVE})}},"RESET"))},Wt=(r(81),function(){var e=Object(c.d)((function(e){return e.trader}),c.b),t=Object(c.d)((function(e){return e.warehouse}),c.b),r=Object(c.c)();if(0===e.traderId)return n.a.createElement("div",{className:"trade-panel"},n.a.createElement("h4",null,"Your port is empty"),"Timer: ",(e.timeToLeave-e.timer).toFixed());var a=kt(t.resources),o=a.gold.owned,i=Object.entries(e.wares).map((function(i){var c=Object(g.a)(i,2),s=c[0],u=c[1],l=a[s];if(!l)return null;var d=o>=u.sellPrice&&u.held>0&&l.owned+l.pending-l.reserved<t.totalCapacity,p=u.held<e.maxCapacity&&l.owned>0;return n.a.createElement("div",{className:"trade-good",key:s},k[s].name," available: ",u.held,n.a.createElement("button",{onClick:function(){return r((e=s,t=1,a=u.sellPrice,{type:j.BUY_GOODS,payload:{product:e,amount:t,atPrice:a}}));var e,t,a},disabled:!d},"Buy for ",u.sellPrice," Gold"),n.a.createElement("button",{onClick:function(){return r((e=s,t=1,a=u.buyPrice,{type:j.SELL_GOODS,payload:{product:e,amount:t,atPrice:a}}));var e,t,a},disabled:!p},"Sell for ",u.buyPrice," Gold"))}));return n.a.createElement("div",{className:"trade-panel"},n.a.createElement("h4",null,Me[e.traderId].name," has visited your island!"),"Timer: ",(e.timeToLeave-e.timer).toFixed(),n.a.createElement("button",{onClick:function(){var t;r((t=e.dismissCost,{type:j.DISMISS_TRADER,payload:{cost:{gold:t}}}))}},"Dismiss for ",e.dismissCost," Gold"),i)}),zt=function(){var e=Object(c.d)((function(e){return e.island.level})),t=Ce[e-1];if(!t)return n.a.createElement("div",null);var r=ve[t[0]].name,a=t[1];return n.a.createElement("div",{className:"milestone"},n.a.createElement("p",null,"New unlocks at ",a," ",r,"s"))},qt=r(16),Kt=r(11),Yt=r(31),Vt=function(e){var t=Object(a.useState)(""),r=Object(g.a)(t,2),o=r[0],i=r[1],s=Object(a.useState)(""),u=Object(g.a)(s,2),l=u[0],d=u[1],p=Object(c.d)((function(e){return e.foreignTrade})),b=Object(c.d)((function(e){return kt(e.warehouse.resources)})),m=Object(c.d)((function(e){return e.warehouse.resources.gold.owned})),f=Object(c.c)(),O=e.fleet,h=Je[O.currentLocation],v=Object.entries(p.inventory).map((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];if(b[r]&&a.onHand>0)return n.a.createElement("option",{key:r,value:r},k[r].name," -- ",a.onHand.toFixed())})),y=Object.entries(p.cargo).map((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];if(b[r])return n.a.createElement("option",{key:r,value:r},k[r].name," -- ",a.toFixed())}));0===y.length&&y.push(n.a.createElement("option",{value:"",disabled:!0},"Cargo is empty"));var w=p.cargoMaximum-p.cargoUsed,E=function(e,t){f(function(e,t){return{type:P.ONLOAD,payload:{resourceId:e,amount:t}}}(e,t))},j=function(e,t){f(function(e,t){return{type:P.OFFLOAD,payload:{resourceId:e,amount:t}}}(e,t))},S=function(){f({type:P.CANCEL}),e.onClose()},D=m>=p.balance;return n.a.createElement(_t.a,{show:e.show,onHide:S,size:"lg"},n.a.createElement(_t.a.Header,null,n.a.createElement(_t.a.Title,null,h.name," -- ",m.toFixed()," Gold")),n.a.createElement(_t.a.Body,null,n.a.createElement(At.a,null,n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,n.a.createElement("label",null,"Fleet cargo: ",p.cargoUsed,"/",p.cargoMaximum," ",n.a.createElement("br",null),n.a.createElement("select",{value:l,onChange:function(e){return d(e.target.value)},size:"10"},y))),n.a.createElement(Kt.a,null,n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return E(o,1)},disabled:w<1},"<-- 1")),n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return j(l,1)}},"1 --\x3e"))),n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return E(o,10)},disabled:w<10},"<-- 10")),n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return j(l,10)}},"10 --\x3e"))),n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return E(o,"max")},disabled:w<1},"<-- Max")),n.a.createElement(Kt.a,null,n.a.createElement(Dt.a,{variant:"info",size:"sm",onClick:function(){return j(l,"max")}},"Max --\x3e")))),n.a.createElement(Kt.a,null,n.a.createElement("label",null,"Dock maximum: ",p.warehouseMaximum," ",n.a.createElement("br",null),n.a.createElement("select",{value:o,onChange:function(e){return i(e.target.value)},size:"10"},v)))))),n.a.createElement(_t.a.Footer,null,n.a.createElement(Dt.a,{variant:"secondary",onClick:S},"Cancel"),n.a.createElement(Dt.a,{variant:"primary",onClick:function(){var t,r,a,n,o;f((t=O.id,r=p.dockId,a=p.toLoad,n=p.toUnload,o=p.balance,{type:P.CONFIRM,payload:{fleetId:t,dockId:r,toLoad:a,toUnload:n,cost:o}})),e.onClose()},disabled:!D},"home"===p.dockId?"Confirm":p.balance>0?"Sell for "+p.balance:"Buy for "+-p.balance)))},Jt=function(e){var t=Object(a.useState)(""),r=Object(g.a)(t,2),o=r[0],i=r[1],s=Object(a.useState)(!1),u=Object(g.a)(s,2),l=u[0],d=u[1],p=Object(c.d)((function(t){return t.navy.fleets[e.fleetId]}),c.b),b=Object(c.d)((function(e){return e.navy.ships}),c.b),m=Object(c.d)((function(e){return e.island.level})),f=Object(c.d)((function(e){return e.island.name})),O=Object(c.d)((function(e){return e.warehouse}),c.b),h=Object(c.c)();if(!p)return n.a.createElement(n.a.Fragment,null);var v=p.currentDestination?"home"===p.currentDestination?f:Je[p.currentDestination].name:null,y=p.currentDestination?"sea towards "+v:"home"===p.currentLocation?f:Je[p.currentLocation].name,w=p.destinationTimer?p.destinationTimer-p.travelProgress:null,E=Object.entries(Je).map((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1];if(r!==p.currentLocation){var o="home"===r?f:a.name;return n.a.createElement("option",{value:r,key:r},o)}return null})),j=null;p.currentDestination||(j=n.a.createElement(Dt.a,{variant:"info",onClick:function(){h(function(e,t,r,a){return{type:P.SETUP,payload:{playerLevel:e,dockId:t,ships:r,warehouse:a}}}(m,p.currentLocation,b,O)),d(!0)}},"Dock"));var k=p.currentDestination?n.a.createElement("div",null,"cancel destination"):n.a.createElement("form",{onSubmit:function(t){var r,a;t.preventDefault(),h((r=e.fleetId,a=o,{type:Ke.EMBARK,payload:{fleetId:r,destination:a}}))}},n.a.createElement("label",null,"Pick your destination",n.a.createElement("select",{value:o,onChange:function(e){return i(e.target.value)}},n.a.createElement("option",{value:"none"},"--"),E),n.a.createElement("input",{type:"submit",value:"Embark"})));return n.a.createElement(n.a.Fragment,null,n.a.createElement(Vt,{fleet:p,show:l,onClose:function(){d(!1)}}),n.a.createElement(At.a,{fluid:!0},n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,n.a.createElement("h4",null,p.name))),n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,"Ships in this fleet:")),n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,"This fleet is currently at ",y," ",n.a.createElement("br",null),w?"Time remaining: "+function(e){return Math.floor(e/60)+":"+(e%60).toFixed()}(w):""," ",n.a.createElement("br",null),j)),n.a.createElement(qt.a,null,n.a.createElement(Kt.a,null,k))))},Qt=function(){var e=Object(c.d)((function(e){return e.navy.fleets}),c.b),t=Object(a.useState)(null),r=Object(g.a)(t,2),o=r[0],i=r[1],s=Object.entries(e).map((function(e){var t=Object(g.a)(e,2),r=t[0],a=t[1],o=a.ships.length;return n.a.createElement(Yt.a.Item,{key:r},n.a.createElement(Yt.a.Link,{eventKey:r},n.a.createElement("h5",null,a.name),o," Ships"))}));return n.a.createElement(At.a,{id:"fleet-view",fluid:!0},n.a.createElement(yt.a.Container,{id:"fleet-selector",activeKey:o,onSelect:function(e){return i(e)}},n.a.createElement(qt.a,null,n.a.createElement(Kt.a,{sm:2},n.a.createElement(Yt.a,{variant:"pills",className:"flex-column"},s)),n.a.createElement(Kt.a,{sm:10},n.a.createElement(yt.a.Content,null,n.a.createElement(yt.a.Pane,{eventKey:o},n.a.createElement(Jt,{fleetId:o})))))))},Xt=.001;var $t=function(){var e=Object(a.useState)(new ht((function(e){i((t=e*Xt,{type:l.TICK,payload:{tickIntervalSeconds:t}}));var t}),100)),t=Object(g.a)(e,1)[0],r=Object(a.useState)(new ht((function(){i(d()),console.log("Saved")}),3e4)),o=Object(g.a)(r,1)[0],i=Object(c.c)();return Object(a.useEffect)((function(){t.start(),o.start()}),[]),n.a.createElement("div",{className:"game"},n.a.createElement(wt,null),n.a.createElement(zt,null),n.a.createElement(vt.a,{defaultActiveKey:"buildings"},n.a.createElement(yt.a,{eventKey:"buildings",title:"Buildings"},n.a.createElement(Nt,null),n.a.createElement(Mt,null)),n.a.createElement(yt.a,{eventKey:"resources",title:"Resources"},n.a.createElement(Ut,null),n.a.createElement(Rt,null)),n.a.createElement(yt.a,{eventKey:"population",title:"Houses"},n.a.createElement(Bt,null),n.a.createElement(Gt,null)),n.a.createElement(yt.a,{eventKey:"port",title:"Port"},n.a.createElement(Wt,null),n.a.createElement(Qt,null)),n.a.createElement(yt.a,{eventKey:"settings",title:"Settings"},n.a.createElement(Ft,null),n.a.createElement(Et,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(c.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bt,t=localStorage.getItem("save"),r=!1;return t&&(e=JSON.parse(atob(t)),r=!0),r||(e=gt(null,{type:"RESET_SAVE"})),Object(s.d)(gt,e,Object(s.a)(u.a)&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}()},n.a.createElement($t,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[62,1,2]]]);
//# sourceMappingURL=main.dd32f35a.chunk.js.map