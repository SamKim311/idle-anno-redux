(this["webpackJsonpidle-anno-redux"]=this["webpackJsonpidle-anno-redux"]||[]).push([[0],{18:function(e,t,n){e.exports=n(37)},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(7),i=n.n(a),s=n(1),c=n(5),u=n(15),l={INIT:"INIT",TICK:"TICK",LOAD_GAME:"LOAD_GAME"};var d=n(2),p={BUILD_WAREHOUSE:"BUILD_WAREHOUSE"};var b={CONSTRUCT_BUILDING:"CONSTRUCT_BUILDING",DESTROY_BUILDING:"DESTROY_BUILDING"};var O={AMENITY:"AMENITY",PRODUCER:"PRODUCER",HOUSE:"HOUSE",WAREHOUSE:"WAREHOUSE"},g={marketplace:{name:"Marketplace",description:"Provides a place for villagers to meet",category:O.AMENITY,produces:{community:2.5},upkeep:10},chapel:{name:"Chapel",description:"A basic building for villagers to worship",category:O.AMENITY,produces:{faith:2},upkeep:15},fishinghut:{name:"Fisherman's Hut",description:"Gathers fish",category:O.PRODUCER,consumes:{},produces:{fish:1},produceTime:30,upkeep:15},lumberjackhut:{name:"Lumberjack's Hut",description:"Gathers wood",category:O.PRODUCER,consumes:{},produces:{wood:1},produceTime:40,upkeep:5},orchard:{name:"Orchard",description:"Grows apples to be turned into cider",category:O.PRODUCER,consumes:{},produces:{apple:1},produceTime:80,upkeep:0},ciderfarm:{name:"Cider Farm",description:"Processes apples into cider",category:O.PRODUCER,consumes:{apple:1},produces:{cider:1},produceTime:40,upkeep:15},hempfarm:{name:"Hemp Plantation",description:"Grows hemp",category:O.PRODUCER,consumes:{},produces:{hemp:1},produceTime:60,upkeep:20},weavers:{name:"Weaver's Hut",description:"Uses hemp to create clothing",category:O.PRODUCER,consumes:{hemp:1},produces:{linen:1},produceTime:30,upkeep:25},quarry:{name:"Stone Quarry",description:"Gathers raw stone",category:O.PRODUCER,consumes:{},produces:{stone:1},produceTime:30,upkeep:20},stonemason:{name:"Stonemason",description:"Turns raw stone into useable bricks",category:O.PRODUCER,consumes:{stone:1},produces:{stonebrick:1},produceTime:30,upkeep:20},peasanthouse:{name:"Peasant Shack",description:"Basic home for villagers. Houses 8",category:O.HOUSE,upkeep:0,populationCategory:"peasant",populationCap:8,ascendsTo:"citizenhouse"},citizenhouse:{name:"Citizen House",description:"Home for citizens",category:O.HOUSE,upkeep:0,populationCategory:"citizen",populationCap:15,ascendsTo:"patricianhouse",cost:{wood:1,tool:1}},smallwarehouse:{name:"Small Warehouse",description:"Basic warehouse for your island",category:O.WAREHOUSE,upkeep:10,couriers:3,capacity:40},smallstockpile:{name:"Small Stockpile",description:"Small depot. Provides 1 courier",category:O.WAREHOUSE,upkeep:10,couriers:1,capacity:0}},f={BUILD_HOUSE:"BUILD_HOUSE",ASCEND_HOUSE:"ASCEND_HOUSE"};var v={reserved:0,pending:0};function h(e,t){for(var n=Object.assign({},e),r=0,o=Object.entries(t);r<o.length;r++){var a=o[r],i=Object(d.a)(a,2),s=i[0],c=i[1],u=Object.assign({},n[s]);u.owned-=c,n[s]=u}return n}var m=n(3);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=n(8),E=n.n(w);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S={AWAITING_RESOURCES:"AWAITING_RESOURCES",WORKING:"WORKING",OUTBOX_FULL:"OUTBOX_FULL",DISABLED:"DISABLED"},P={status:S.AWAITING_RESOURCES,progress:0,efficiency:0,inbox:{},outbox:{}},D=5;function C(e){e.inbox={};for(var t=0,n=Object.keys(e.consumes);t<n.length;t++){var r=n[t];e.inbox[r]=0}e.outbox={};for(var o=0,a=Object.keys(e.produces);o<a.length;o++){var i=a[o];e.outbox[i]=0}}function T(e,t){var n=Object.assign({},e);if(!function(e){for(var t=0,n=Object.entries(e.consumes);t<n.length;t++){var r=n[t],o=Object(d.a)(r,2),a=o[0],i=o[1];if(e.inbox[a]<i)return!1}return!0}(n))return n.status=S.AWAITING_RESOURCES,n;if(!function(e){for(var t=0,n=Object.entries(e.produces);t<n.length;t++){var r=n[t],o=Object(d.a)(r,2),a=o[0],i=o[1];if(e.outbox[a]+i>D)return!1}return!0}(n))return n.status=S.OUTBOX_FULL,n;if(n.status=S.WORKING,n.progress+=t,n.progress>n.produceTime){n.progress-=n.produceTime;for(var r=Object.assign({},n.inbox),o=Object.assign({},n.outbox),a=0,i=Object.entries(n.consumes);a<i.length;a++){var s=i[a],c=Object(d.a)(s,2),u=c[0],l=c[1];r[u]-=l}for(var p=0,b=Object.entries(n.produces);p<b.length;p++){var O=b[p],g=Object(d.a)(O,2),f=g[0],v=g[1];o[f]+=v}n.inbox=r,n.outbox=o}return n}var R=n(9);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _="IDLE",A="PICKING_UP",L="EN_ROUTE",x="DROPPING_OFF",H={status:_,progress:0,timeThreshold:0,jobDescription:{},payload:{},markedForDeath:!1},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload,r=e.couriers;if(!r)return e;switch(t.type){case l.INIT:var o=g[e.warehouse.type],a=r.couriers.slice(0);F(a,o.couriers);var i=Object.assign({},r);return i.couriers=a,Object.assign({},e,{couriers:i});case p.BUILD_WAREHOUSE:var s=g[n.toConstruct.id],c=s.couriers,u=Object.assign({},e),d=Object.assign({},u.couriers);u.couriers=d;var f=d.couriers.slice(0);return F(f,c),d.couriers=f,u;case b.DESTROY_BUILDING:var v=n.toDestroy;if(v.category!==O.WAREHOUSE)return e;for(var h=Object(R.a)(e.couriers.couriers),m=N({},e.couriers,{couriers:h}),j=N({},e,{couriers:m}),y=0;y<h.length;y++){var w=h[y];if(w.status===_&&!w.markmarkedForDeath)return h.splice(y,1),j}for(var E=h.length-1;E>=0;E--){var I=h[E];if(!I.markmarkedForDeath)return I.markedForDeath=!0,j}return j;case l.TICK:var k=Object.assign({},e),S=Object.assign({},k.couriers),P=Object.assign({},k.warehouse),C=P.totalCapacity,T=Object.assign({},P.resources);P.resources=T;var U=Object.assign({},k.buildings),H=Object.assign({},U.owned);U.owned=H,k.warehouse=P,k.buildings=U,k.couriers=S;var B=W(r,P,H),G=r.jobQueue.slice(0).concat(B.jobList),M=Object.assign({},r.jobQueueMap,B.jobRef),K=S.couriers.map((function(e){if(e.status===_){var t=Object.assign({},e),n=z(G,H),r=G[n];if(G=G.slice(n+1),!r)return e;var o=r.from,a=r.to,i=r.carrying,s=null,c=null,u=0;if(s="warehouse"!==o?U.owned[o]:P,c="warehouse"!==a?U.owned[a]:P,"warehouse"===o){var l=D-c.inbox[i],d=Math.floor(T[i].owned-T[i].reserved);u=Math.min(l,d);var p=Object.assign({},T[i]);p.reserved+=u,T[i]=p}else{var b=s.outbox[i],O=Math.floor(C-T[i].owned-T[i].pending);u=Math.min(b,O);var g=Object.assign({},T[i]);g.pending+=u,T[i]=g}return r.amount=u,t.status=A,t.timeThreshold=8,t.jobDescription=r,t}return e}));S.jobQueue=G,S.jobQueueMap=M;K.map((function(e){if(e.status===_)return e;if(e.progress+=n.tickIntervalSeconds,e.progress>=e.timeThreshold){e.progress-=e.timeThreshold;var t=e.jobDescription,r=t.from,o=t.to,a=t.carrying,i=t.amount,s=null,c=null;switch("warehouse"!==r?H.hasOwnProperty(r)&&(s=Object.assign({},H[r]),H[r]=s):s=P,"warehouse"!==o?H.hasOwnProperty(o)&&(c=Object.assign({},H[o]),H[o]=c):c=P,e.status){case A:var u=Object.assign({},e.payload);if(e.payload=u,"warehouse"===r){var l=Object.assign({},T[a]);T[a]=l,l.owned-=i,l.reserved-=i,u[a]=i}else{if(!s){e.payload={},e.status=_,e.jobDescription={},e.progress=0,e.timeThreshold=0,delete M[e.jobDescription.id];break}var d=Object.assign({},s.outbox);s.outbox=d,d[a]-=i,u[a]=i,delete M[e.jobDescription.id]}e.status=L,e.timeThreshold=20;break;case L:e.status=x,e.timeThreshold=8;break;case x:var p=Object.assign({},e.payload);if("warehouse"===o){var b=Object.assign({},T[a]);T[a]=b,b.owned+=p[a],b.pending-=i}else{if(c){var O=Object.assign({},c.inbox);c.inbox=O,O[a]+=i}else{var g=Object.assign({},T[a]);T[a]=g,g.owned+=p[a]}delete M[e.jobDescription.id]}e.payload={},e.status=_,e.jobDescription={},e.progress=0,e.timeThreshold=0}}return e}));var q=K.filter((function(e){return e.status!==_||!e.markedForDeath}));return S.couriers=q,k.couriers=S,k;default:return e}};function F(e,t){for(var n=0;n<t;n++){var r=Object.assign({},H,{id:E()()});e.push(r)}}var G="_SUPPLY",M="_PICKUP";function W(e,t,n){for(var r=e.jobQueueMap,o=t.totalCapacity,a=t.resources,i={jobList:[],jobRef:{}},s=0,c=Object.values(n);s<c.length;s++){var u=c[s];if(u.category===O.PRODUCER)for(var l=0,p=Object.entries(u.inbox);l<p.length;l++){var b=p[l],g=Object(d.a)(b,2),f=g[0],v=g[1],h=u.id+"_"+f+"_"+G;if(v<D&&!r[h]){var m=a[f];if(Math.floor(m.owned-m.reserved)>0){var j={id:h,from:"warehouse",to:u.id,carrying:f};i.jobList.push(j),i.jobRef[h]=j}}}}var y=Object.values(n).reduce((function(e,t){if(t.category!==O.PRODUCER)return e;for(var n=0,i=Object.entries(t.outbox);n<i.length;n++){var s=i[n],c=Object(d.a)(s,2),u=c[0],l=c[1],p=t.id+M;if(l>0&&!r[p]){var b=a[u];if(Math.floor(o-b.owned-b.pending)>0){var g={id:p,from:t.id,to:"warehouse",carrying:u};e.jobList.push(g),e.jobRef[p]=g}}}return e}),{jobList:[],jobRef:{}});return{jobList:i.jobList.concat(y.jobList),jobRef:Object.assign({},i.jobRef,y.jobRef)}}function z(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=r.from,a=r.to;if(("warehouse"===o||t.hasOwnProperty(o))&&("warehouse"===a||t.hasOwnProperty(a)))return n}}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y={popProgress:0,currentPop:1},J={peasanthouse:.8,citizenhouse:.6},Q={peasanthouse:["peasanthouse","citizenhouse"],citizenhouse:["citizenhouse"],patricianhouse:[]};function X(e,t,n){var r=Q[n].reduce((function(t,n){return t+e[n].owned}),0);t.totalAscensionRights=Math.floor(J[n]*r);var o=g[n].ascendsTo,a=Q[o].reduce((function(t,n){return t+e[n].owned}),0);t.remainingAscensionRights=t.totalAscensionRights-a}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z={owned:0,maxPopulation:0,happiness:0,canAscend:!1,consumeInfo:""},ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.TICK:for(var r=n.tickIntervalSeconds,o=Object.assign({},e),a=e.buildings,i={},s=0,c=Object.values(a.owned);s<c.length;s++){var u=c[s];if(u.category===O.AMENITY)for(var p=0,b=Object.entries(u.produces);p<b.length;p++){var g=b[p],f=Object(d.a)(g,2),v=f[0],h=f[1];i[v]||(i[v]=0),i[v]+=h*r*(1/60)}}return o.amenities=i,o;default:return e}},te={peasant:{name:"Peasant",taxRate:.8,consumes:{community:{quantity:1,weight:25},fish:{quantity:1,weight:25},cider:{quantity:.44,weight:25},faith:{quantity:1,weight:25}}},citizen:{name:"Citizen",taxRate:.95,consumes:{fish:{quantity:.4,weight:8},spice:{quantity:.4,weight:12},cider:{quantity:.44,weight:20},linen:{quantity:.42,weight:20},community:{quantity:1,weight:20},faith:{quantity:1,weight:20}}}},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.TICK:var r=n.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.warehouse),i=Object.assign({},a.resources);a.resources=i;var s=o.amenities,c=Object.assign({},o.population);o.warehouse=a,o.population=c;for(var u=0,p=Object.entries(e.population);u<p.length;u++){var b=p[u],O=Object(d.a)(b,2),g=O[0],f=O[1],v=Object.assign({},f);v.consumeInfo=null;var h=0;if(0!==f.owned)for(var m=0,j=Object.entries(te[g].consumes);m<j.length;m++){var y=j[m],w=Object(d.a)(y,2),E=w[0],I=w[1],k=I.quantity*v.owned*r*(1/60)*.01,S=1;if(s[E])s[E]<k&&(S=s[E]/k,v.consumeInfo||(v.consumeInfo="Need "+E)),s[E]-=k,s[E]<0&&(s[E]=0);else if(i[E]){var P=Object.assign({},i[E]);i[E]=P,P.owned<k&&(S=P.owned/k,v.consumeInfo||(v.consumeInfo="Need "+E)),P.owned-=k,P.owned<0&&(P.owned=0)}else S=0,v.consumeInfo||(v.consumeInfo="Need "+E);h+=I.weight*S}var D=(h-v.happiness)/100;Math.abs(D)<.001&&(D=.001),v.happiness+=D,c[g]=v}return o;default:return e}},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.TICK:var r=n.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.housing),i=Object.assign({},o.population);o.housing=a,o.population=i;var s={},c=a.abodes.map((function(e){var t=Object.assign({},e),n=i[t.populationCategory].happiness,o=0;return n>=40&&t.currentPop<t.populationCap&&(o=1),n<=20&&t.currentPop>0&&(o=-1),t.popProgress+=r*o,(t.popProgress>10||t.popProgress<-10)&&(t.popProgress-=10*o,t.currentPop+=o),t.currentPop<1&&(t.currentPop=1),s[t.populationCategory]||(s[t.populationCategory]=0),s[t.populationCategory]+=t.currentPop,t}));a.abodes=c;for(var u=0,p=Object.entries(s);u<p.length;u++){var b=p[u],O=Object(d.a)(b,2),g=O[0],f=O[1],v=Object.assign({},i[g]);v.owned=f,i[g]=v}return o;default:return e}},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.TICK:var r=n.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.warehouse),i=Object.assign({},a.resources),s=Object.assign({},i.gold);o.warehouse=a,a.resources=i,i.gold=s;var c={maintenanceCost:0,taxRevenue:0},u=g[a.type].upkeep*r*(1/60),d=Object.values(e.construction).reduce((function(e,t){return e+g[t.id].upkeep*t.owned*r*(1/60)}),u),p=Object.values(e.population).reduce((function(e,t){var n=.01*t.happiness;return n<.01&&(n=.01),e+te[t.id].taxRate*t.owned*r*(1/60)*n}),0);return c.maintenanceCost=d,c.taxRevenue=p,o.financeInfo=c,s.owned=s.owned+p-d,o;default:return e}},ae=[["peasant",60],["peasant",90],["citizen",1],["citizen",355],["patrician",510],["patrician",1190],["nobleman",950],["nobleman",2200],["nobleman",3500],["nobleman",7500]],ie=[{title:"Small Settlement",buildings:["marketplace","fishinghut","lumberjackhut"],population:"peasant",resources:["gold","wood","tool","fish"]},{buildings:["orchard","ciderfarm"],resources:["apple","cider"]},{title:"Settlement",buildings:["chapel"]},{population:"citizen",resources:["hemp","linen","stone","stonebrick","spice"],buildings:["hempfarm","weavers","quarry","stonemason"],housing:["citizenhouse"]}];function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.TICK:var n=Object(d.a)(ae[e.island.level-1],2),r=n[0],o=n[1],a=e.population[r].owned;if(a>=o){var i=Object.assign({},e),s=Object.assign({},i.island);i.island=s,s.level++;var c=ie[s.level-1];if(c.title&&(s.title=c.title),c.buildings){var u=Object.assign({},i.construction);i.construction=u,c.buildings.forEach((function(e){var t=Object.assign({},u[e]);t.unlocked=!0,u[e]=t}))}if(c.resources){var p=Object.assign({},i.warehouse),b=Object.assign({},p.resources);i.warehouse=p,p.resources=b,c.resources.forEach((function(e){var t=Object.assign({},b[e]);b[e]=t,t.unlocked=!0}))}if(c.population){var O=Object.assign({},i.population);i.population=O;var g=Object.assign({},O[c.population]);g.unlocked=!0,O[c.population]=g}if(c.housing){var f=ce({},i.housing.types),v=ce({},i.housing,{types:f});i.housing=v,c.housing.forEach((function(e){var t=ce({},f[e],{unlocked:!0});f[e]=t}))}return i}return e;default:return e}},le={SET_TIME_FACTOR:"SET_TIME_FACTOR"};function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case le.SET_TIME_FACTOR:return pe({},e,{cheat:{timeFactor:n.timeFactor}});default:return e}},Oe=Object(c.c)({cheat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},island:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&arguments[1];return e},warehouse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.INIT:var r=Object.assign({},e),o=Object.entries(r.resources).reduce((function(e,t){var n=Object(d.a)(t,2),r=n[0],o=n[1],a=Object.assign({},o,v);return e[r]=a,e}),{});return r.resources=o,r;case f.BUILD_HOUSE:case f.ASCEND_HOUSE:case b.CONSTRUCT_BUILDING:var a=Object.assign({},e),i=n.toConstruct.cost,s=h(a.resources,i);return a.resources=s,a;case p.BUILD_WAREHOUSE:var c=Object.assign({},e),u=n.toConstruct.cost,O=h(c.resources,u);c.resources=O;var m=g[n.toConstruct.id];return c.totalCapacity+=m.capacity,c;default:return e}},construction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case p.BUILD_WAREHOUSE:case f.BUILD_HOUSE:case b.CONSTRUCT_BUILDING:var r=n.toConstruct.id,o=e[r],a=Object.assign({},o,{owned:o.owned+1});return Object.assign({},e,Object(m.a)({},r,a));case b.DESTROY_BUILDING:var i=n.toDestroy.buildingId,s=y({},e[i]);return s.owned--,y({},e,Object(m.a)({},i,s));default:return e}},buildings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.TICK:if(!e.owned)return e;var r=Object.assign({},e),o=Object.assign({},r.owned);r.owned=o;var a=n.tickIntervalSeconds;return Object.values(e.owned).forEach((function(e){var t=null;t=e.category===O.PRODUCER?T(e,a):e,o[t.id]=t})),r;case p.BUILD_WAREHOUSE:case b.CONSTRUCT_BUILDING:var i=g[n.toConstruct.id],s=Object.assign({},i,{id:E()(),buildingId:n.toConstruct.id});i.category===O.PRODUCER&&C(s=Object.assign(s,P));var c=Object.assign({},e.owned);return c[s.id]=s,Object.assign({},e,{owned:c});case b.DESTROY_BUILDING:var u=n.toDestroy,d=k({},e.owned);return delete d[u.id],k({},e,{owned:d});default:return e}},couriers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},housing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case f.BUILD_HOUSE:var r=Object.assign({},e),o=Object.assign({},r.types),a=r.abodes.slice(0);r.types=o,r.abodes=a;var i=n.toConstruct.id,s=Object.assign({},o[i]);o[i]=s;var c=Object.assign({},g[i],Y,{houseId:i});return s.owned+=1,a.push(c),X(o,s,i),r;case f.ASCEND_HOUSE:var u,l=n.fromHouse,d=g[l].ascendsTo,p=q({},e.types[l]),b=q({},e.types[d]),O=q({},e.types,(u={},Object(m.a)(u,l,p),Object(m.a)(u,d,b),u)),v=Object(R.a)(e.abodes),h=q({},e,{types:O,abodes:v}),j=g[d],y=v.findIndex((function(e){return e.houseId===l}));return v.splice(y,1),v.push(q({},j,{},Y,{houseId:d})),p.owned-=1,b.owned+=1,X(O,p,l),X(O,b,d),h;default:return e}},population:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case l.INIT:for(var r=Object.assign({},e),o=0,a=Object.entries(r);o<a.length;o++){var i=a[o],s=Object(d.a)(i,2),c=s[0],u=s[1],p=Object.assign({},u,Z);r[c]=p}return r;case f.BUILD_HOUSE:var b=g[n.toConstruct.id],O=Object.assign({},e),v=Object.assign({},O[b.populationCategory]);return O[v.id]=v,v.maxPopulation+=b.populationCap,O;case l.TICK:for(var h=Object.assign({},e),j=0,y=Object.entries(h);j<y.length;j++){var w=y[j],E=Object(d.a)(w,2),I=E[0],k=E[1];k.happiness>97&&k.owned===k.maxPopulation?h[I]=$({},k,{canAscend:!0}):h[I]=$({},k,{canAscend:!1})}return h;case f.ASCEND_HOUSE:var S,P=g[n.fromHouse],D=g[P.ascendsTo],C=$({},e[P.populationCategory]),T=$({},e[D.populationCategory]);return C.owned-=P.populationCap,T.owned+=P.populationCap,C.maxPopulation-=P.populationCap,T.maxPopulation+=D.populationCap,$({},e,(S={},Object(m.a)(S,P.populationCategory,C),Object(m.a)(S,D.populationCategory,T),S));default:return e}}});var ge=function(e,t){if(t.type===l.LOAD_GAME)return t.payload.saveState;if(t.type===l.TICK){var n=e.cheat.timeFactor;n||(n=1),t.payload.tickIntervalSeconds*=n}var r=be(e,t),o=Oe(r,t),a=B(o,t);if(t.type===l.TICK){var i=ee(a,t),s=ne(i,t),c=re(s,t),u=oe(c,t);return ue(u,t)}return a},fe={island:{level:1,title:"Small Settlement",name:"New Island"},construction:{peasanthouse:{id:"peasanthouse",owned:0,cost:{wood:2},unlocked:!0},marketplace:{id:"marketplace",owned:0,cost:{gold:400,wood:5,tool:3},unlocked:!0},fishinghut:{id:"fishinghut",owned:0,cost:{gold:100,wood:3,tool:2},unlocked:!0},lumberjackhut:{id:"lumberjackhut",owned:0,cost:{gold:50,tool:2},unlocked:!0},smallstockpile:{id:"smallstockpile",owned:0,cost:{gold:200,wood:2,tool:3},unlocked:!0},orchard:{id:"orchard",owned:0,cost:{gold:25},unlocked:!1},ciderfarm:{id:"ciderfarm",owned:0,cost:{gold:100,wood:5,tool:1},unlocked:!1},chapel:{id:"chapel",owned:0,cost:{gold:1500,wood:12,tool:5},unlocked:!1},hempfarm:{id:"hempfarm",owned:0,cost:{gold:400,wood:5,tool:2},unlocked:!1},weavers:{id:"weavers",owned:0,cost:{gold:400,wood:5,tool:3}},quarry:{id:"quarry",owned:0,cost:{gold:400,wood:2,tool:2}},stonemason:{id:"stonemason",owned:0,cost:{gold:400,wood:2,tool:2}}},buildings:{owned:{}},warehouse:{type:"smallwarehouse",totalCapacity:40,resources:{gold:{id:"gold",owned:5e3,unlocked:!0},tool:{id:"tool",owned:40,unlocked:!0},fish:{id:"fish",owned:2,unlocked:!0},wood:{id:"wood",owned:40,unlocked:!0},apple:{id:"apple",owned:0,unlocked:!1},cider:{id:"cider",owned:0,unlocked:!1},hemp:{id:"hemp",owned:0,unlocked:!1},spice:{id:"spice",owned:0,unlocked:!1},linen:{id:"linen",owned:0,unlocked:!1},stone:{id:"stone",owned:0,unlocked:!1},stonebrick:{id:"stonebrick",owned:0,unlocked:!1}}},couriers:{couriers:[],jobQueue:[],jobQueueMap:{}},housing:{types:{peasanthouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!0},citizenhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},patricianhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},noblehouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1}},abodes:[]},population:{peasant:{id:"peasant",unlocked:!0},citizen:{id:"citizen",unlocked:!1}}};n(30);var ve=n(16),he=n(17),me=function(){function e(t,n){Object(ve.a)(this,e),this.targetFunction=t,this.targetInterval=n,this.running=!1}return Object(he.a)(e,[{key:"start",value:function(){var e=this;if(!this.running){var t=Date.now();this.running=!0;setTimeout(function n(){if(e.running){var r=Date.now(),o=r-t;e.targetFunction(o),t=r,setTimeout(n.bind(e),e.targetInterval)}}.bind(this),this.targetInterval)}}},{key:"stop",value:function(){this.running=!1}}]),e}(),je=function(){var e=Object(s.d)(),t=Object(r.useState)(1),n=Object(d.a)(t,2),a=n[0],i=n[1];return o.a.createElement("div",{className:"time-factor"},o.a.createElement("form",{onSubmit:function(t){e(function(e){return{type:le.SET_TIME_FACTOR,payload:{timeFactor:e}}}(a)),t.preventDefault()}},o.a.createElement("input",{type:"number",name:"timeFactor",onChange:function(e){return i(e.target.value)},required:!0}),o.a.createElement("input",{type:"submit",value:"Set time factor"})))},ye=function(e){return Object.entries(e).reduce((function(e,t){var n=Object(d.a)(t,2),r=n[0],o=n[1];return o.unlocked&&(e[r]=o),e}),{})},we=function(e,t){return Object.entries(e).reduce((function(e,n){var r=Object(d.a)(n,2),o=r[0],a=r[1];return e[o]=function(e,t){for(var n=0,r=Object.entries(e.cost);n<r.length;n++){var o=r[n],a=Object(d.a)(o,2),i=a[0],s=a[1];if(t[i].owned<s)return Object.assign({},e,{canAfford:!1})}return Object.assign({},e,{canAfford:!0})}(a,t),e}),{})},Ee={gold:{name:"Gold",baseTradePrice:1},tool:{name:"Tool",baseTradePrice:15},fish:{name:"Fish",baseTradePrice:3},wood:{name:"Wood",baseTradePrice:1},apple:{name:"Apple",baseTradePrice:.2},cider:{name:"Cider",baseTradePrice:3},hemp:{name:"Hemp",baseTradePrice:4},linen:{name:"Clothing",baseTradePrice:27},stone:{name:"Stone",baseTradePrice:6},stonebrick:{name:"Stone Brick",baseTradePrice:8},spice:{name:"Spice",baseTradePrice:6}},Ie=(n(31),Object(s.b)((function(e){return{resources:ye(e.warehouse.resources),max:e.warehouse.totalCapacity}}))((function(e){var t=e.resources,n=e.max;return o.a.createElement("div",{className:"resource-panel"},Object.keys(t).map((function(e,r){var a=Ee[e].name;return"gold"!==e?o.a.createElement("div",{key:e},a,": ",t[e].owned.toFixed(1)," / ",n):o.a.createElement("div",{key:e},a,": ",t[e].owned.toFixed(1))})))}))),ke=(n(32),function(){var e=Object(s.e)((function(e){return e.couriers}),s.c);Object(s.e)((function(e){return e.buildings}),s.c);var t=e.couriers.map((function(e){return o.a.createElement("div",{className:"courier",key:e.id},o.a.createElement("div",null,e.status),o.a.createElement("div",null,e.progress.toFixed(1)),o.a.createElement("div",null,JSON.stringify(e.payload)))}));return o.a.createElement("div",{className:"courier-monitor"},t)}),Se=(n(33),function(){var e=Object(s.e)((function(e){return e.warehouse.resources})),t=Object(s.e)((function(t){return we(ye(t.construction),e)}),s.c),n=Object(s.d)(),r=Object.entries(t).map((function(e){var t=Object(d.a)(e,2),r=t[0],a=t[1],i=g[r],s=Object.keys(a.cost).map((function(e){return o.a.createElement("div",{className:"construction-ingredient",key:e},Ee[e].name,": ",a.cost[e])})),c=null;return c=i.category===O.HOUSE?function(){return n((e=a,{type:f.BUILD_HOUSE,payload:{toConstruct:e}}));var e}:i.category===O.WAREHOUSE?function(){return n((e=a,{type:p.BUILD_WAREHOUSE,payload:{toConstruct:e}}));var e}:function(){return n((e=a,{type:b.CONSTRUCT_BUILDING,payload:{toConstruct:e}}));var e},o.a.createElement("div",{className:"construction",key:r},o.a.createElement("div",{className:"construction-header"},o.a.createElement("h4",null,i.name)),o.a.createElement("div",null,"Owned: ",a.owned),o.a.createElement("div",{className:"ingredientList"},s),o.a.createElement("button",{className:"purchase",onClick:c,disabled:!a.canAfford},"Buy"))}));return o.a.createElement("div",{className:"construction-panel"},r)}),Pe=(n(34),function(e){var t=e.building;return o.a.createElement("div",{className:"building"},o.a.createElement("div",{className:"building-header"},o.a.createElement("h4",null,t.name)),o.a.createElement("div",{className:"status"},t.status),o.a.createElement("div",null,t.progress.toFixed(1)," / ",t.produceTime),o.a.createElement("div",{className:"inbox"},"Inbox: ",JSON.stringify(t.inbox)),o.a.createElement("div",{className:"outbox"},"Outbox: ",JSON.stringify(t.outbox)),o.a.createElement("button",{onClick:function(){return e.destroyFunc(t)}},"Destroy"))}),De=function(){var e=Object(s.e)((function(e){return e.buildings}),s.c),t=Object(s.d)(),n=e.owned,r=function(e){t(function(e){return{type:b.DESTROY_BUILDING,payload:{toDestroy:e}}}(e))},a=Object.values(n).map((function(e){return e.category===O.PRODUCER?o.a.createElement(Pe,{building:e,key:e.id,destroyFunc:r}):o.a.createElement("div",{className:"building",key:e.id},o.a.createElement("div",{className:"building-header"},o.a.createElement("h4",null,e.name)),o.a.createElement("button",{onClick:function(){return r(e)}},"Destroy"))}));return o.a.createElement("div",{className:"building-panel"},a)},Ce=(n(35),function(){var e=Object(s.e)((function(e){return ye(e.population)}),s.c),t=Object.values(e).map((function(e){var t=te[e.id].name,n=e.happiness?e.happiness.toFixed():0;return o.a.createElement("div",{className:"population",key:e.id},t,": ",e.owned," / ",e.maxPopulation," Happiness: ",n," ",e.consumeInfo)}));return o.a.createElement("div",{className:"population-panel"},t)}),Te=(n(36),function(){var e=Object(s.d)(),t=Object(s.e)((function(e){return ye(e.housing.types)}),s.c),n=Object(s.e)((function(e){return e.population}),s.c),r=Object.keys(t).map((function(r){var a=n[g[r].populationCategory],i=t[r].remainingAscensionRights>0&&a.canAscend,s=i?t[r].remainingAscensionRights:0;return o.a.createElement("div",{className:"housing",key:r},o.a.createElement("div",{className:"housing-data"},g[r].name,": ",t[r].owned),o.a.createElement("div",null,o.a.createElement("button",{onClick:function(){e(function(e,t){var n=g[t];return{type:f.ASCEND_HOUSE,payload:{toConstruct:n,fromHouse:e}}}(r,g[r].ascendsTo))},disabled:!i},"Ascend"),s))}));return o.a.createElement("div",{className:"housing-panel"},r)}),Re=function(){var e=Object(s.e)((function(e){return e})),t=Object(s.d)();return o.a.createElement("div",{className:"save-load"},o.a.createElement("button",{onClick:function(){var t=btoa(JSON.stringify(e));navigator.clipboard.writeText(t).then((function(){alert("Saved to clipboard")}))}},"Save"),o.a.createElement("button",{onClick:function(){var e,n=JSON.parse(atob(prompt("Enter load data")));n?t((e=n,{type:l.LOAD_GAME,payload:{saveState:e}})):alert("Invalid save state")}},"Load"))},Ue=.001;var Ne=function(){var e=Object(r.useState)(new me((function(e){n((t=e*Ue,{type:l.TICK,payload:{tickIntervalSeconds:t}}));var t}),100)),t=Object(d.a)(e,1)[0],n=Object(s.d)();return Object(r.useEffect)((function(){n({type:l.INIT}),t.start()}),[]),o.a.createElement("div",{className:"game"},o.a.createElement(Re,null),o.a.createElement(je,null),o.a.createElement(Ie,null),o.a.createElement(Ce,null),o.a.createElement(Te,null),o.a.createElement(ke,null),o.a.createElement(Se,null),o.a.createElement(De,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(s.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe;return localStorage.getItem("save")&&(e=JSON.parse(atob(prompt("Enter load data")))),e||(e=fe),Object(c.d)(ge,e,Object(c.a)(u.a)&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}()},o.a.createElement(Ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[18,1,2]]]);
//# sourceMappingURL=main.581f37cf.chunk.js.map