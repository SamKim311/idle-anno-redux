(this["webpackJsonpidle-anno-redux"]=this["webpackJsonpidle-anno-redux"]||[]).push([[0],{18:function(e,t,r){e.exports=r(38)},30:function(e,t,r){},31:function(e,t,r){},32:function(e,t,r){},33:function(e,t,r){},34:function(e,t,r){},35:function(e,t,r){},36:function(e,t,r){},37:function(e,t,r){},38:function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),a=r(7),c=r.n(a),i=r(1),s=r(5),u=r(15),l={INIT:"INIT",TICK:"TICK",LOAD_GAME:"LOAD_GAME"};var d=r(3),p=r(2),b={BUILD_WAREHOUSE:"BUILD_WAREHOUSE"};var O={CONSTRUCT_BUILDING:"CONSTRUCT_BUILDING",DESTROY_BUILDING:"DESTROY_BUILDING"};var f={AMENITY:"AMENITY",PRODUCER:"PRODUCER",HOUSE:"HOUSE",WAREHOUSE:"WAREHOUSE"},g={marketplace:{name:"Marketplace",description:"Provides a place for villagers to meet",category:f.AMENITY,produces:{community:2.5},upkeep:10},chapel:{name:"Chapel",description:"A basic building for villagers to worship",category:f.AMENITY,produces:{faith:2},upkeep:15},fishinghut:{name:"Fisherman's Hut",description:"Gathers fish",category:f.PRODUCER,consumes:{},produces:{fish:1},produceTime:30,upkeep:15},lumberjackhut:{name:"Lumberjack's Hut",description:"Gathers wood",category:f.PRODUCER,consumes:{},produces:{wood:1},produceTime:40,upkeep:5},orchard:{name:"Orchard",description:"Grows apples to be turned into cider",category:f.PRODUCER,consumes:{},produces:{apple:1},produceTime:80,upkeep:0},ciderfarm:{name:"Cider Farm",description:"Processes apples into cider",category:f.PRODUCER,consumes:{apple:1},produces:{cider:1},produceTime:40,upkeep:15},hempfarm:{name:"Hemp Plantation",description:"Grows hemp",category:f.PRODUCER,consumes:{},produces:{hemp:1},produceTime:60,upkeep:20},weavers:{name:"Weaver's Hut",description:"Uses hemp to create clothing",category:f.PRODUCER,consumes:{hemp:1},produces:{linen:1},produceTime:30,upkeep:25},quarry:{name:"Stone Quarry",description:"Gathers raw stone",category:f.PRODUCER,consumes:{},produces:{stone:1},produceTime:30,upkeep:20},stonemason:{name:"Stonemason",description:"Turns raw stone into useable bricks",category:f.PRODUCER,consumes:{stone:1},produces:{stonebrick:1},produceTime:30,upkeep:20},peasanthouse:{name:"Peasant Shack",description:"Basic home for villagers. Houses 8",category:f.HOUSE,upkeep:0,populationCategory:"peasant",populationCap:8,ascendsTo:"citizenhouse"},citizenhouse:{name:"Citizen House",description:"Home for citizens",category:f.HOUSE,upkeep:0,populationCategory:"citizen",populationCap:15,ascendsTo:"patricianhouse",cost:{wood:1,tool:1}},smallwarehouse:{name:"Small Warehouse",description:"Basic warehouse for your island",category:f.WAREHOUSE,upkeep:10,couriers:3,capacity:40},smallstockpile:{name:"Small Stockpile",description:"Small depot. Provides 1 courier",category:f.WAREHOUSE,upkeep:10,couriers:1,capacity:0}},v={BUILD_HOUSE:"BUILD_HOUSE",ASCEND_HOUSE:"ASCEND_HOUSE"};var m={BUY_GOODS:"BUY_GOODS",SELL_GOODS:"SELL_GOODS"};function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y={reserved:0,pending:0};function w(e,t){for(var r=Object.assign({},e),n=0,o=Object.entries(t);n<o.length;n++){var a=o[n],c=Object(p.a)(a,2),i=c[0],s=c[1],u=Object.assign({},r[i]);u.owned-=s,r[i]=u}return r}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var S=r(8),D=r.n(S);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C={AWAITING_RESOURCES:"AWAITING_RESOURCES",WORKING:"WORKING",OUTBOX_FULL:"OUTBOX_FULL",DISABLED:"DISABLED"},T={status:C.AWAITING_RESOURCES,progress:0,efficiency:0,inbox:{},outbox:{}},R=5;function U(e){e.inbox={};for(var t=0,r=Object.keys(e.consumes);t<r.length;t++){var n=r[t];e.inbox[n]=0}e.outbox={};for(var o=0,a=Object.keys(e.produces);o<a.length;o++){var c=a[o];e.outbox[c]=0}}function N(e,t){var r=Object.assign({},e);if(!function(e){for(var t=0,r=Object.entries(e.consumes);t<r.length;t++){var n=r[t],o=Object(p.a)(n,2),a=o[0],c=o[1];if(e.inbox[a]<c)return!1}return!0}(r))return r.status=C.AWAITING_RESOURCES,r;if(!function(e){for(var t=0,r=Object.entries(e.produces);t<r.length;t++){var n=r[t],o=Object(p.a)(n,2),a=o[0],c=o[1];if(e.outbox[a]+c>R)return!1}return!0}(r))return r.status=C.OUTBOX_FULL,r;if(r.status=C.WORKING,r.progress+=t,r.progress>r.produceTime){r.progress-=r.produceTime;for(var n=Object.assign({},r.inbox),o=Object.assign({},r.outbox),a=0,c=Object.entries(r.consumes);a<c.length;a++){var i=c[a],s=Object(p.a)(i,2),u=s[0],l=s[1];n[u]-=l}for(var d=0,b=Object.entries(r.produces);d<b.length;d++){var O=b[d],f=Object(p.a)(O,2),g=f[0],v=f[1];o[g]+=v}r.inbox=n,r.outbox=o}return r}var _=r(9);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x="IDLE",B="PICKING_UP",G="EN_ROUTE",H="DROPPING_OFF",F={status:x,progress:0,timeThreshold:0,jobDescription:{},payload:{},markedForDeath:!1},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload,n=e.couriers;if(!n)return e;switch(t.type){case l.INIT:var o=g[e.warehouse.type],a=n.couriers.slice(0);W(a,o.couriers);var c=Object.assign({},n);return c.couriers=a,Object.assign({},e,{couriers:c});case b.BUILD_WAREHOUSE:var i=g[r.toConstruct.id],s=i.couriers,u=Object.assign({},e),d=Object.assign({},u.couriers);u.couriers=d;var p=d.couriers.slice(0);return W(p,s),d.couriers=p,u;case O.DESTROY_BUILDING:var v=r.toDestroy;if(v.category!==f.WAREHOUSE)return e;for(var m=Object(_.a)(e.couriers.couriers),h=L({},e.couriers,{couriers:m}),j=L({},e,{couriers:h}),y=0;y<m.length;y++){var w=m[y];if(w.status===x&&!w.markmarkedForDeath)return m.splice(y,1),j}for(var E=m.length-1;E>=0;E--){var P=m[E];if(!P.markmarkedForDeath)return P.markedForDeath=!0,j}return j;case l.TICK:var S=Object.assign({},e),D=Object.assign({},S.couriers),I=Object.assign({},S.warehouse),k=I.totalCapacity,C=Object.assign({},I.resources);I.resources=C;var T=Object.assign({},S.buildings),U=Object.assign({},T.owned);T.owned=U,S.warehouse=I,S.buildings=T,S.couriers=D;var N=Y(n,I,U),A=n.jobQueue.slice(0).concat(N.jobList),F=Object.assign({},n.jobQueueMap,N.jobRef),M=D.couriers.map((function(e){if(e.status===x){var t=Object.assign({},e),r=q(A,U),n=A[r];if(A=A.slice(r+1),!n)return e;var o=n.from,a=n.to,c=n.carrying,i=null,s=null,u=0;if(i="warehouse"!==o?T.owned[o]:I,s="warehouse"!==a?T.owned[a]:I,"warehouse"===o){var l=R-s.inbox[c],d=Math.floor(C[c].owned-C[c].reserved);u=Math.min(l,d);var p=Object.assign({},C[c]);p.reserved+=u,C[c]=p}else{var b=i.outbox[c],O=Math.floor(k-C[c].owned-C[c].pending);u=Math.min(b,O);var f=Object.assign({},C[c]);f.pending+=u,C[c]=f}return n.amount=u,t.status=B,t.timeThreshold=8,t.jobDescription=n,t}return e}));D.jobQueue=A,D.jobQueueMap=F;M.map((function(e){if(e.status===x)return e;if(e.progress+=r.tickIntervalSeconds,e.progress>=e.timeThreshold){e.progress-=e.timeThreshold;var t=e.jobDescription,n=t.from,o=t.to,a=t.carrying,c=t.amount,i=null,s=null;switch("warehouse"!==n?U.hasOwnProperty(n)&&(i=Object.assign({},U[n]),U[n]=i):i=I,"warehouse"!==o?U.hasOwnProperty(o)&&(s=Object.assign({},U[o]),U[o]=s):s=I,e.status){case B:var u=Object.assign({},e.payload);if(e.payload=u,"warehouse"===n){var l=Object.assign({},C[a]);C[a]=l,l.owned-=c,l.reserved-=c,u[a]=c}else{if(!i){e.payload={},e.status=x,e.jobDescription={},e.progress=0,e.timeThreshold=0,delete F[e.jobDescription.id];break}var d=Object.assign({},i.outbox);i.outbox=d,d[a]-=c,u[a]=c,delete F[e.jobDescription.id]}e.status=G,e.timeThreshold=20;break;case G:e.status=H,e.timeThreshold=8;break;case H:var p=Object.assign({},e.payload);if("warehouse"===o){var b=Object.assign({},C[a]);C[a]=b,b.owned+=p[a],b.pending-=c}else{if(s){var O=Object.assign({},s.inbox);s.inbox=O,O[a]+=c}else{var f=Object.assign({},C[a]);C[a]=f,f.owned+=p[a]}delete F[e.jobDescription.id]}e.payload={},e.status=x,e.jobDescription={},e.progress=0,e.timeThreshold=0}}return e}));var K=M.filter((function(e){return e.status!==x||!e.markedForDeath}));return D.couriers=K,S.couriers=D,S;default:return e}};function W(e,t){for(var r=0;r<t;r++){var n=Object.assign({},F,{id:D()()});e.push(n)}}var K="_SUPPLY",z="_PICKUP";function Y(e,t,r){for(var n=e.jobQueueMap,o=t.totalCapacity,a=t.resources,c={jobList:[],jobRef:{}},i=0,s=Object.values(r);i<s.length;i++){var u=s[i];if(u.category===f.PRODUCER)for(var l=0,d=Object.entries(u.inbox);l<d.length;l++){var b=d[l],O=Object(p.a)(b,2),g=O[0],v=O[1],m=u.id+"_"+g+"_"+K;if(v<R&&!n[m]){var h=a[g];if(Math.floor(h.owned-h.reserved)>0){var j={id:m,from:"warehouse",to:u.id,carrying:g};c.jobList.push(j),c.jobRef[m]=j}}}}var y=Object.values(r).reduce((function(e,t){if(t.category!==f.PRODUCER)return e;for(var r=0,c=Object.entries(t.outbox);r<c.length;r++){var i=c[r],s=Object(p.a)(i,2),u=s[0],l=s[1],d=t.id+z;if(l>0&&!n[d]){var b=a[u];if(Math.floor(o-b.owned-b.pending)>0){var O={id:d,from:t.id,to:"warehouse",carrying:u};e.jobList.push(O),e.jobRef[d]=O}}}return e}),{jobList:[],jobRef:{}});return{jobList:c.jobList.concat(y.jobList),jobRef:Object.assign({},c.jobRef,y.jobRef)}}function q(e,t){for(var r=0;r<e.length;r++){var n=e[r],o=n.from,a=n.to;if(("warehouse"===o||t.hasOwnProperty(o))&&("warehouse"===a||t.hasOwnProperty(a)))return r}}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X={popProgress:0,currentPop:1},V={peasanthouse:.8,citizenhouse:.6},$={peasanthouse:["peasanthouse","citizenhouse"],citizenhouse:["citizenhouse"],patricianhouse:[]};function Z(e,t,r){var n=$[r].reduce((function(t,r){return t+e[r].owned}),0);t.totalAscensionRights=Math.floor(V[r]*n);var o=g[r].ascendsTo,a=$[o].reduce((function(t,r){return t+e[r].owned}),0);t.remainingAscensionRights=t.totalAscensionRights-a}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var re={owned:0,maxPopulation:0,happiness:0,canAscend:!1,consumeInfo:""},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:for(var n=r.tickIntervalSeconds,o=Object.assign({},e),a=e.buildings,c={},i=0,s=Object.values(a.owned);i<s.length;i++){var u=s[i];if(u.category===f.AMENITY)for(var d=0,b=Object.entries(u.produces);d<b.length;d++){var O=b[d],g=Object(p.a)(O,2),v=g[0],m=g[1];c[v]||(c[v]=0),c[v]+=m*n*(1/60)}}return o.amenities=c,o;default:return e}},oe={peasant:{name:"Peasant",taxRate:.8,consumes:{community:{quantity:1,weight:25},fish:{quantity:1,weight:25},cider:{quantity:.44,weight:25},faith:{quantity:1,weight:25}}},citizen:{name:"Citizen",taxRate:.95,consumes:{fish:{quantity:.4,weight:8},spice:{quantity:.4,weight:12},cider:{quantity:.44,weight:20},linen:{quantity:.42,weight:20},community:{quantity:1,weight:20},faith:{quantity:1,weight:20}}}},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.warehouse),c=Object.assign({},a.resources);a.resources=c;var i=o.amenities,s=Object.assign({},o.population);o.warehouse=a,o.population=s;for(var u=0,d=Object.entries(e.population);u<d.length;u++){var b=d[u],O=Object(p.a)(b,2),f=O[0],g=O[1],v=Object.assign({},g);v.consumeInfo=null;var m=0;if(0!==g.owned)for(var h=0,j=Object.entries(oe[f].consumes);h<j.length;h++){var y=j[h],w=Object(p.a)(y,2),E=w[0],P=w[1],S=P.quantity*v.owned*n*(1/60)*.01,D=1;if(i[E])i[E]<S&&(D=i[E]/S,v.consumeInfo||(v.consumeInfo="Need "+E)),i[E]-=S,i[E]<0&&(i[E]=0);else if(c[E]){var I=Object.assign({},c[E]);c[E]=I,I.owned<S&&(D=I.owned/S,v.consumeInfo||(v.consumeInfo="Need "+E)),I.owned-=S,I.owned<0&&(I.owned=0)}else D=0,v.consumeInfo||(v.consumeInfo="Need "+E);m+=P.weight*D}var k=(m-v.happiness)/100;Math.abs(k)<.001&&(k=.001),v.happiness+=k,s[f]=v}return o;default:return e}},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.housing),c=Object.assign({},o.population);o.housing=a,o.population=c;var i={},s=a.abodes.map((function(e){var t=Object.assign({},e),r=c[t.populationCategory].happiness,o=0;return r>=40&&t.currentPop<t.populationCap&&(o=1),r<=20&&t.currentPop>0&&(o=-1),t.popProgress+=n*o,(t.popProgress>10||t.popProgress<-10)&&(t.popProgress-=10*o,t.currentPop+=o),t.currentPop<1&&(t.currentPop=1),i[t.populationCategory]||(i[t.populationCategory]=0),i[t.populationCategory]+=t.currentPop,t}));a.abodes=s;for(var u=0,d=Object.entries(i);u<d.length;u++){var b=d[u],O=Object(p.a)(b,2),f=O[0],g=O[1],v=Object.assign({},c[f]);v.owned=g,c[f]=v}return o;default:return e}},ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,o=Object.assign({},e),a=Object.assign({},o.warehouse),c=Object.assign({},a.resources),i=Object.assign({},c.gold);o.warehouse=a,a.resources=c,c.gold=i;var s={maintenanceCost:0,taxRevenue:0},u=g[a.type].upkeep*n*(1/60),d=Object.values(e.construction).reduce((function(e,t){return e+g[t.id].upkeep*t.owned*n*(1/60)}),u),p=Object.values(e.population).reduce((function(e,t){var r=.01*t.happiness;return r<.01&&(r=.01),e+oe[t.id].taxRate*t.owned*n*(1/60)*r}),0);return s.maintenanceCost=d,s.taxRevenue=p,o.financeInfo=s,i.owned=i.owned+p-d,o;default:return e}},se=[["peasant",60],["peasant",90],["citizen",1],["citizen",355],["patrician",510],["patrician",1190],["nobleman",950],["nobleman",2200],["nobleman",3500],["nobleman",7500]],ue=[{title:"Small Settlement",buildings:["marketplace","fishinghut","lumberjackhut"],population:"peasant",resources:["gold","wood","tool","fish"]},{buildings:["orchard","ciderfarm"],resources:["apple","cider"]},{title:"Settlement",buildings:["chapel"]},{population:"citizen",resources:["hemp","linen","stone","stonebrick","spice"],buildings:["hempfarm","weavers","quarry","stonemason"],housing:["citizenhouse"]}];function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.TICK:var r=Object(p.a)(se[e.island.level-1],2),n=r[0],o=r[1],a=e.population[n].owned;if(a>=o){var c=Object.assign({},e),i=Object.assign({},c.island);c.island=i,i.level++;var s=ue[i.level-1];if(s.title&&(i.title=s.title),s.buildings){var u=Object.assign({},c.construction);c.construction=u,s.buildings.forEach((function(e){var t=Object.assign({},u[e]);t.unlocked=!0,u[e]=t}))}if(s.resources){var d=Object.assign({},c.warehouse),b=Object.assign({},d.resources);c.warehouse=d,d.resources=b,s.resources.forEach((function(e){var t=Object.assign({},b[e]);b[e]=t,t.unlocked=!0}))}if(s.population){var O=Object.assign({},c.population);c.population=O;var f=Object.assign({},O[s.population]);f.unlocked=!0,O[s.population]=f}if(s.housing){var g=de({},c.housing.types),v=de({},c.housing,{types:g});c.housing=v,s.housing.forEach((function(e){var t=de({},g[e],{unlocked:!0});g[e]=t}))}return c}return e;default:return e}},be={SET_TIME_FACTOR:"SET_TIME_FACTOR"};function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case be.SET_TIME_FACTOR:return fe({},e,{cheat:{timeFactor:r.timeFactor}});default:return e}},ve={lord:{name:"Lord Dude",rates:{wood:{buy:.5,sell:1},tool:{buy:.5,sell:1}},baseCapacity:40}},me={gold:{name:"Gold",baseTradePrice:1},tool:{name:"Tool",baseTradePrice:15},fish:{name:"Fish",baseTradePrice:3},wood:{name:"Wood",baseTradePrice:1},apple:{name:"Apple",baseTradePrice:.2},cider:{name:"Cider",baseTradePrice:3},hemp:{name:"Hemp",baseTradePrice:4},linen:{name:"Clothing",baseTradePrice:27},stone:{name:"Stone",baseTradePrice:6},stonebrick:{name:"Stone Brick",baseTradePrice:8},spice:{name:"Spice",baseTradePrice:6}};function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ye=240,we={traderId:0,timer:0,timeToLeave:300,wares:{}};function Ee(e){for(var t=Object.keys(ve),r=t[Math.floor(Math.random()*t.length)],n=ve[r],o={},a=n.baseCapacity,c=je({},e,{traderId:r,wares:o,maxCapacity:a,timeToLeave:ye}),i=0,s=Object.entries(n.rates);i<s.length;i++){var u=s[i],l=Object(p.a)(u,2),d=l[0],b=l[1],O=me[d].baseTradePrice,f=b.buy*O,g=b.sell*O;o[d]={buyPrice:f,sellPrice:g,held:0},g>0&&(o[d].held=a)}return c}var Pe=Object(s.c)({cheat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},island:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&arguments[1];return e},warehouse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:var n=Object.assign({},e),o=Object.entries(n.resources).reduce((function(e,t){var r=Object(p.a)(t,2),n=r[0],o=r[1],a=Object.assign({},o,y);return e[n]=a,e}),{});return n.resources=o,n;case v.BUILD_HOUSE:case v.ASCEND_HOUSE:case O.CONSTRUCT_BUILDING:var a=Object.assign({},e),c=r.toConstruct.cost,i=w(a.resources,c);return a.resources=i,a;case b.BUILD_WAREHOUSE:var s=Object.assign({},e),u=r.toConstruct.cost,f=w(s.resources,u);s.resources=f;var h=g[r.toConstruct.id];return s.totalCapacity+=h.capacity,s;case m.BUY_GOODS:var E=r.product,P=r.amount,S=r.atPrice,D=j({},e.resources.gold);D.owned-=P*S;var I=j({},e.resources[E]);I.owned+=P;var k=j({},e.resources,Object(d.a)({gold:D},E,I));return j({},e,{resources:k});case m.SELL_GOODS:var C=r.product,T=r.amount,R=r.atPrice,U=j({},e.resources.gold);U.owned+=T*R;var N=j({},e.resources[C]);N.owned-=T;var _=j({},e.resources,Object(d.a)({gold:U},C,N));return j({},e,{resources:_});default:return e}},construction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case b.BUILD_WAREHOUSE:case v.BUILD_HOUSE:case O.CONSTRUCT_BUILDING:var n=r.toConstruct.id,o=e[n],a=Object.assign({},o,{owned:o.owned+1});return Object.assign({},e,Object(d.a)({},n,a));case O.DESTROY_BUILDING:var c=r.toDestroy.buildingId,i=P({},e[c]);return i.owned--,P({},e,Object(d.a)({},c,i));default:return e}},buildings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:if(!e.owned)return e;var n=Object.assign({},e),o=Object.assign({},n.owned);n.owned=o;var a=r.tickIntervalSeconds;return Object.values(e.owned).forEach((function(e){var t=null;t=e.category===f.PRODUCER?N(e,a):e,o[t.id]=t})),n;case b.BUILD_WAREHOUSE:case O.CONSTRUCT_BUILDING:var c=g[r.toConstruct.id],i=Object.assign({},c,{id:D()(),buildingId:r.toConstruct.id});c.category===f.PRODUCER&&U(i=Object.assign(i,T));var s=Object.assign({},e.owned);return s[i.id]=i,Object.assign({},e,{owned:s});case O.DESTROY_BUILDING:var u=r.toDestroy,d=k({},e.owned);return delete d[u.id],k({},e,{owned:d});default:return e}},couriers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},housing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case v.BUILD_HOUSE:var n=Object.assign({},e),o=Object.assign({},n.types),a=n.abodes.slice(0);n.types=o,n.abodes=a;var c=r.toConstruct.id,i=Object.assign({},o[c]);o[c]=i;var s=Object.assign({},g[c],X,{houseId:c});return i.owned+=1,a.push(s),Z(o,i,c),n;case v.ASCEND_HOUSE:var u,l=r.fromHouse,p=g[l].ascendsTo,b=Q({},e.types[l]),O=Q({},e.types[p]),f=Q({},e.types,(u={},Object(d.a)(u,l,b),Object(d.a)(u,p,O),u)),m=Object(_.a)(e.abodes),h=Q({},e,{types:f,abodes:m}),j=g[p],y=m.findIndex((function(e){return e.houseId===l}));return m.splice(y,1),m.push(Q({},j,{},X,{houseId:p})),b.owned-=1,O.owned+=1,Z(f,b,l),Z(f,O,p),h;default:return e}},population:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:for(var n=Object.assign({},e),o=0,a=Object.entries(n);o<a.length;o++){var c=a[o],i=Object(p.a)(c,2),s=i[0],u=i[1],b=Object.assign({},u,re);n[s]=b}return n;case v.BUILD_HOUSE:var O=g[r.toConstruct.id],f=Object.assign({},e),m=Object.assign({},f[O.populationCategory]);return f[m.id]=m,m.maxPopulation+=O.populationCap,f;case l.TICK:for(var h=Object.assign({},e),j=0,y=Object.entries(h);j<y.length;j++){var w=y[j],E=Object(p.a)(w,2),P=E[0],S=E[1];S.happiness>97&&S.owned===S.maxPopulation?h[P]=te({},S,{canAscend:!0}):h[P]=te({},S,{canAscend:!1})}return h;case v.ASCEND_HOUSE:var D,I=g[r.fromHouse],k=g[I.ascendsTo],C=te({},e[I.populationCategory]),T=te({},e[k.populationCategory]);return C.owned-=I.populationCap,T.owned+=I.populationCap,C.maxPopulation-=I.populationCap,T.maxPopulation+=k.populationCap,te({},e,(D={},Object(d.a)(D,I.populationCategory,C),Object(d.a)(D,k.populationCategory,T),D));default:return e}},trader:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:we,t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case m.BUY_GOODS:var n=r.product,o=r.amount,a=je({},e.wares),c=je({},e,{wares:a});return a[n].held-=o,c;case m.SELL_GOODS:var i=r.product,s=r.amount,u=je({},e.wares),d=je({},e,{wares:u});return u[i].held+=s,d;case l.TICK:var p=r.tickIntervalSeconds,b=je({},e);return b.timer+=p,b.timer>b.timeToLeave?(b.timer-=b.timeToLeave,Ee(b)):b;default:return e}}});var Se=function(e,t){if(t.type===l.LOAD_GAME)return t.payload.saveState;if(t.type===l.TICK){var r=e.cheat.timeFactor;r||(r=1),t.payload.tickIntervalSeconds*=r}var n=ge(e,t),o=Pe(n,t),a=M(o,t);if(t.type===l.TICK){var c=ne(a,t),i=ae(c,t),s=ce(i,t),u=ie(s,t);return pe(u,t)}return a},De={island:{level:1,title:"Small Settlement",name:"New Island"},construction:{peasanthouse:{id:"peasanthouse",owned:0,cost:{wood:2},unlocked:!0},marketplace:{id:"marketplace",owned:0,cost:{gold:400,wood:5,tool:3},unlocked:!0},fishinghut:{id:"fishinghut",owned:0,cost:{gold:100,wood:3,tool:2},unlocked:!0},lumberjackhut:{id:"lumberjackhut",owned:0,cost:{gold:50,tool:2},unlocked:!0},smallstockpile:{id:"smallstockpile",owned:0,cost:{gold:200,wood:2,tool:3},unlocked:!0},orchard:{id:"orchard",owned:0,cost:{gold:25},unlocked:!1},ciderfarm:{id:"ciderfarm",owned:0,cost:{gold:100,wood:5,tool:1},unlocked:!1},chapel:{id:"chapel",owned:0,cost:{gold:1500,wood:12,tool:5},unlocked:!1},hempfarm:{id:"hempfarm",owned:0,cost:{gold:400,wood:5,tool:2},unlocked:!1},weavers:{id:"weavers",owned:0,cost:{gold:400,wood:5,tool:3}},quarry:{id:"quarry",owned:0,cost:{gold:400,wood:2,tool:2}},stonemason:{id:"stonemason",owned:0,cost:{gold:400,wood:2,tool:2}}},buildings:{owned:{}},warehouse:{type:"smallwarehouse",totalCapacity:40,resources:{gold:{id:"gold",owned:5e3,unlocked:!0},tool:{id:"tool",owned:40,unlocked:!0},fish:{id:"fish",owned:2,unlocked:!0},wood:{id:"wood",owned:40,unlocked:!0},apple:{id:"apple",owned:0,unlocked:!1},cider:{id:"cider",owned:0,unlocked:!1},hemp:{id:"hemp",owned:0,unlocked:!1},spice:{id:"spice",owned:0,unlocked:!1},linen:{id:"linen",owned:0,unlocked:!1},stone:{id:"stone",owned:0,unlocked:!1},stonebrick:{id:"stonebrick",owned:0,unlocked:!1}}},couriers:{couriers:[],jobQueue:[],jobQueueMap:{}},housing:{types:{peasanthouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!0},citizenhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},patricianhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},noblehouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1}},abodes:[]},population:{peasant:{id:"peasant",unlocked:!0},citizen:{id:"citizen",unlocked:!1}}};r(30);var Ie=r(16),ke=r(17),Ce=function(){function e(t,r){Object(Ie.a)(this,e),this.targetFunction=t,this.targetInterval=r,this.running=!1}return Object(ke.a)(e,[{key:"start",value:function(){var e=this;if(!this.running){var t=Date.now();this.running=!0;setTimeout(function r(){if(e.running){var n=Date.now(),o=n-t;e.targetFunction(o),t=n,setTimeout(r.bind(e),e.targetInterval)}}.bind(this),this.targetInterval)}}},{key:"stop",value:function(){this.running=!1}}]),e}(),Te=function(){var e=Object(i.d)(),t=Object(n.useState)(1),r=Object(p.a)(t,2),a=r[0],c=r[1];return o.a.createElement("div",{className:"time-factor"},o.a.createElement("form",{onSubmit:function(t){e(function(e){return{type:be.SET_TIME_FACTOR,payload:{timeFactor:e}}}(a)),t.preventDefault()}},o.a.createElement("input",{type:"number",name:"timeFactor",onChange:function(e){return c(e.target.value)},required:!0}),o.a.createElement("input",{type:"submit",value:"Set time factor"})))},Re=function(e){return Object.entries(e).reduce((function(e,t){var r=Object(p.a)(t,2),n=r[0],o=r[1];return o.unlocked&&(e[n]=o),e}),{})},Ue=function(e,t){return Object.entries(e).reduce((function(e,r){var n=Object(p.a)(r,2),o=n[0],a=n[1];return e[o]=function(e,t){for(var r=0,n=Object.entries(e.cost);r<n.length;r++){var o=n[r],a=Object(p.a)(o,2),c=a[0],i=a[1];if(t[c].owned<i)return Object.assign({},e,{canAfford:!1})}return Object.assign({},e,{canAfford:!0})}(a,t),e}),{})},Ne=(r(31),Object(i.b)((function(e){return{resources:Re(e.warehouse.resources),max:e.warehouse.totalCapacity}}))((function(e){var t=e.resources,r=e.max;return o.a.createElement("div",{className:"resource-panel"},Object.keys(t).map((function(e,n){var a=me[e].name;return"gold"!==e?o.a.createElement("div",{key:e},a,": ",t[e].owned.toFixed(1)," / ",r):o.a.createElement("div",{key:e},a,": ",t[e].owned.toFixed(1))})))}))),_e=(r(32),function(){var e=Object(i.e)((function(e){return e.couriers}),i.c);Object(i.e)((function(e){return e.buildings}),i.c);var t=e.couriers.map((function(e){return o.a.createElement("div",{className:"courier",key:e.id},o.a.createElement("div",null,e.status),o.a.createElement("div",null,e.progress.toFixed(1)),o.a.createElement("div",null,JSON.stringify(e.payload)))}));return o.a.createElement("div",{className:"courier-monitor"},t)}),Ae=(r(33),function(){var e=Object(i.e)((function(e){return e.warehouse.resources})),t=Object(i.e)((function(t){return Ue(Re(t.construction),e)}),i.c),r=Object(i.d)(),n=Object.entries(t).map((function(e){var t=Object(p.a)(e,2),n=t[0],a=t[1],c=g[n],i=Object.keys(a.cost).map((function(e){return o.a.createElement("div",{className:"construction-ingredient",key:e},me[e].name,": ",a.cost[e])})),s=null;return s=c.category===f.HOUSE?function(){return r((e=a,{type:v.BUILD_HOUSE,payload:{toConstruct:e}}));var e}:c.category===f.WAREHOUSE?function(){return r((e=a,{type:b.BUILD_WAREHOUSE,payload:{toConstruct:e}}));var e}:function(){return r((e=a,{type:O.CONSTRUCT_BUILDING,payload:{toConstruct:e}}));var e},o.a.createElement("div",{className:"construction",key:n},o.a.createElement("div",{className:"construction-header"},o.a.createElement("h4",null,c.name)),o.a.createElement("div",null,"Owned: ",a.owned),o.a.createElement("div",{className:"ingredientList"},i),o.a.createElement("button",{className:"purchase",onClick:s,disabled:!a.canAfford},"Buy"))}));return o.a.createElement("div",{className:"construction-panel"},n)}),Le=(r(34),function(e){var t=e.building;return o.a.createElement("div",{className:"building"},o.a.createElement("div",{className:"building-header"},o.a.createElement("h4",null,t.name)),o.a.createElement("div",{className:"status"},t.status),o.a.createElement("div",null,t.progress.toFixed(1)," / ",t.produceTime),o.a.createElement("div",{className:"inbox"},"Inbox: ",JSON.stringify(t.inbox)),o.a.createElement("div",{className:"outbox"},"Outbox: ",JSON.stringify(t.outbox)),o.a.createElement("button",{onClick:function(){return e.destroyFunc(t)}},"Destroy"))}),xe=function(){var e=Object(i.e)((function(e){return e.buildings}),i.c),t=Object(i.d)(),r=e.owned,n=function(e){t(function(e){return{type:O.DESTROY_BUILDING,payload:{toDestroy:e}}}(e))},a=Object.values(r).map((function(e){return e.category===f.PRODUCER?o.a.createElement(Le,{building:e,key:e.id,destroyFunc:n}):o.a.createElement("div",{className:"building",key:e.id},o.a.createElement("div",{className:"building-header"},o.a.createElement("h4",null,e.name)),o.a.createElement("button",{onClick:function(){return n(e)}},"Destroy"))}));return o.a.createElement("div",{className:"building-panel"},a)},Be=(r(35),function(){var e=Object(i.e)((function(e){return Re(e.population)}),i.c),t=Object.values(e).map((function(e){var t=oe[e.id].name,r=e.happiness?e.happiness.toFixed():0;return o.a.createElement("div",{className:"population",key:e.id},t,": ",e.owned," / ",e.maxPopulation," Happiness: ",r," ",e.consumeInfo)}));return o.a.createElement("div",{className:"population-panel"},t)}),Ge=(r(36),function(){var e=Object(i.d)(),t=Object(i.e)((function(e){return Re(e.housing.types)}),i.c),r=Object(i.e)((function(e){return e.population}),i.c),n=Object.keys(t).map((function(n){var a=r[g[n].populationCategory],c=t[n].remainingAscensionRights>0&&a.canAscend,i=c?t[n].remainingAscensionRights:0;return o.a.createElement("div",{className:"housing",key:n},o.a.createElement("div",{className:"housing-data"},g[n].name,": ",t[n].owned),o.a.createElement("div",null,o.a.createElement("button",{onClick:function(){e(function(e,t){var r=g[t];return{type:v.ASCEND_HOUSE,payload:{toConstruct:r,fromHouse:e}}}(n,g[n].ascendsTo))},disabled:!c},"Ascend"),i))}));return o.a.createElement("div",{className:"housing-panel"},n)}),He=function(){var e=Object(i.e)((function(e){return e})),t=Object(i.d)();return o.a.createElement("div",{className:"save-load"},o.a.createElement("button",{onClick:function(){var t=btoa(JSON.stringify(e));navigator.clipboard.writeText(t).then((function(){alert("Saved to clipboard")}))}},"Save"),o.a.createElement("button",{onClick:function(){var e,r=JSON.parse(atob(prompt("Enter load data")));r?t((e=r,{type:l.LOAD_GAME,payload:{saveState:e}})):alert("Invalid save state")}},"Load"))},Fe=(r(37),function(){var e=Object(i.e)((function(e){return e.trader}),i.c),t=Object(i.e)((function(e){return e.warehouse}),i.c),r=Object(i.d)();if(0===e.traderId)return o.a.createElement("div",{className:"trade-panel"});var n=t.resources,a=n.gold.owned,c=Object.entries(e.wares).map((function(c){var i=Object(p.a)(c,2),s=i[0],u=i[1],l=n[s],d=a>=u.sellPrice&&u.held>0&&l.owned+l.pending-l.reserved<t.totalCapacity,b=u.held<e.maxCapacity&&l.owned>0;return o.a.createElement("div",{className:"trade-good",key:s},me[s].name," available: ",u.held,o.a.createElement("button",{onClick:function(){return r((e=s,t=1,n=u.sellPrice,{type:m.BUY_GOODS,payload:{product:e,amount:t,atPrice:n}}));var e,t,n},disabled:!d},"Buy for ",u.sellPrice," Gold"),o.a.createElement("button",{onClick:function(){return r((e=s,t=1,n=u.buyPrice,{type:m.SELL_GOODS,payload:{product:e,amount:t,atPrice:n}}));var e,t,n},disabled:!b},"Sell for ",u.buyPrice," Gold"))}));return o.a.createElement("div",{className:"trade-panel"},c)}),Me=.001;var We=function(){var e=Object(n.useState)(new Ce((function(e){r((t=e*Me,{type:l.TICK,payload:{tickIntervalSeconds:t}}));var t}),100)),t=Object(p.a)(e,1)[0],r=Object(i.d)();return Object(n.useEffect)((function(){r({type:l.INIT}),t.start()}),[]),o.a.createElement("div",{className:"game"},o.a.createElement(He,null),o.a.createElement(Te,null),o.a.createElement(Ne,null),o.a.createElement(Fe,null),o.a.createElement(Be,null),o.a.createElement(Ge,null),o.a.createElement(_e,null),o.a.createElement(Ae,null),o.a.createElement(xe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(i.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De;return localStorage.getItem("save")&&(e=JSON.parse(atob(prompt("Enter load data")))),e||(e=De),Object(s.d)(Se,e,Object(s.a)(u.a)&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}()},o.a.createElement(We,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[18,1,2]]]);
//# sourceMappingURL=main.e5dc6873.chunk.js.map