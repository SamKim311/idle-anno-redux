(this["webpackJsonpidle-anno-redux"]=this["webpackJsonpidle-anno-redux"]||[]).push([[0],{42:function(e,t,r){e.exports=r(63)},53:function(e,t,r){},55:function(e,t,r){},56:function(e,t,r){},57:function(e,t,r){},59:function(e,t,r){},60:function(e,t,r){},61:function(e,t,r){},62:function(e,t,r){},63:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(8),i=r.n(o),c=r(3),s=r(16),u=r(34),l={INIT:"INIT",TICK:"TICK",LOAD_GAME:"LOAD_GAME",CHANGE_NAME:"CHANGE_NAME"};var d=r(6);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=r(4),f={BUILD_WAREHOUSE:"BUILD_WAREHOUSE",UPDGRADE_WAREHOUSE:"UPGRADE_WAREHOUSE"};var g={CONSTRUCT_BUILDING:"CONSTRUCT_BUILDING",DESTROY_BUILDING:"DESTROY_BUILDING"};function m(e){return{type:g.DESTROY_BUILDING,payload:{toDestroy:e}}}var v={AMENITY:"AMENITY",PRODUCER:"PRODUCER",HOUSE:"HOUSE",WAREHOUSE:"WAREHOUSE"},h={AWAITING_RESOURCES:"AWAITING_RESOURCES",WORKING:"WORKING",OUTBOX_FULL:"OUTBOX_FULL",DISABLED:"DISABLED"},y={marketplace:{name:"Marketplace",abbreviation:"M",description:"Provides a place for villagers to meet",category:v.AMENITY,produces:{community:2.5},upkeep:10},chapel:{name:"Chapel",abbreviation:"Ch",description:"A basic building for villagers to worship",category:v.AMENITY,produces:{faith:2},upkeep:15},fishinghut:{name:"Fisherman's Hut",abbreviation:"F",description:"Gathers fish",category:v.PRODUCER,consumes:{},produces:{fish:1},produceTime:30,upkeep:15,disabledUpkeep:5},lumberjackhut:{name:"Lumberjack's Hut",abbreviation:"L",description:"Gathers wood",category:v.PRODUCER,consumes:{},produces:{wood:1},produceTime:40,upkeep:5,disabledUpkeep:0},orchard:{name:"Orchard",abbreviation:"O",description:"Grows apples to be turned into cider",category:v.PRODUCER,consumes:{},produces:{apple:1},produceTime:100,upkeep:5,disabledUpkeep:0},ciderfarm:{name:"Cidery",abbreviation:"C",description:"Processes apples into cider",category:v.PRODUCER,consumes:{apple:1},produces:{cider:1},produceTime:40,upkeep:15,disabledUpkeep:5},hempfarm:{name:"Hemp Plantation",abbreviation:"H",description:"Grows hemp",category:v.PRODUCER,consumes:{},produces:{hemp:1},produceTime:60,upkeep:20,disabledUpkeep:10},weavers:{name:"Weaver's Hut",abbreviation:"W",description:"Uses hemp to create clothing",category:v.PRODUCER,consumes:{hemp:1},produces:{linen:1},produceTime:30,upkeep:25,disabledUpkeep:12},quarry:{name:"Stone Quarry",abbreviation:"Q",description:"Gathers raw stone",category:v.PRODUCER,consumes:{},produces:{stone:1},produceTime:30,upkeep:20,disabledUpkeep:10},stonemason:{name:"Stonemason",abbreviation:"Sm",description:"Turns raw stone into useable bricks",category:v.PRODUCER,consumes:{stone:1},produces:{stonebrick:1},produceTime:30,upkeep:20,disabledUpkeep:10},peasanthouse:{name:"Peasant Shack",description:"Basic home for villagers. Houses 8",category:v.HOUSE,upkeep:0,populationCategory:"peasant",populationCap:8,ascendsTo:"citizenhouse"},citizenhouse:{name:"Citizen House",description:"Home for citizens",category:v.HOUSE,upkeep:0,populationCategory:"citizen",populationCap:15,ascendsTo:"patricianhouse",cost:{wood:1,tool:1}},smallwarehouse:{name:"Small Warehouse",description:"Basic warehouse for your island",category:v.WAREHOUSE,upkeep:10,couriers:3,capacity:40,upgradesTo:"mediumwarehouse",upgradeCost:{gold:150,wood:2,tool:3,stonebrick:4}},mediumwarehouse:{name:"Medium Warehouse",description:"Expanded warehouse",category:v.WAREHOUSE,upkeep:15,couriers:1,capacity:10},smallstockpile:{name:"Small Stockpile",abbreviation:"SS",description:"Small depot. Provides 1 courier",category:v.WAREHOUSE,upkeep:10,couriers:1,capacity:0}},j={BUILD_HOUSE:"BUILD_HOUSE",ASCEND_HOUSE:"ASCEND_HOUSE"};var w={BUY_GOODS:"BUY_GOODS",SELL_GOODS:"SELL_GOODS",DISMISS_TRADER:"DISMISS_TRADER"};function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D={reserved:0,pending:0};function P(e,t){for(var r=Object.assign({},e),n=0,a=Object.entries(t);n<a.length;n++){var o=a[n],i=Object(O.a)(o,2),c=i[0],s=i[1],u=Object.assign({},r[c]);u.owned-=s,r[c]=u}return r}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=r(23),C=r.n(T),U={DISABLE_BUILDING:"DISABLE_BUILDING",ENABLE_BUILDING:"ENABLE_BUILDING"};function R(e){return{type:U.DISABLE_BUILDING,payload:{id:e}}}function N(e){return{type:U.ENABLE_BUILDING,payload:{id:e}}}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L={status:h.AWAITING_RESOURCES,progress:0,efficiency:1,efficiencyTimer:0,efficiencySupplied:!1,inbox:{},outbox:{}},x=.01,G=2,B=1,H=100,M=5;function F(e){var t=y[e.buildingId];e.inbox={};for(var r=0,n=Object.keys(t.consumes);r<n.length;r++){var a=n[r];e.inbox[a]=0}e.outbox={};for(var o=0,i=Object.keys(t.produces);o<i.length;o++){var c=i[o];e.outbox[c]=0}}function W(e,t){var r=Object.assign({},e),n=y[r.buildingId];if(!e.enabled)return r.status=h.DISABLED,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(!function(e){for(var t=y[e.buildingId],r=0,n=Object.entries(t.consumes);r<n.length;r++){var a=n[r],o=Object(O.a)(a,2),i=o[0],c=o[1];if(e.inbox[i]<c)return!1}return!0}(r))return r.status=h.AWAITING_RESOURCES,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(!function(e){for(var t=y[e.buildingId],r=0,n=Object.entries(t.produces);r<n.length;r++){var a=n[r],o=Object(O.a)(a,2),i=o[0],c=o[1];if(e.outbox[i]+c>M)return!1}return!0}(r))return r.status=h.OUTBOX_FULL,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=K(r,t);if(r.status=h.WORKING,r.efficiencySupplied||(r.efficiencySupplied=!0,r.efficiencyTimer=0),(r=K(r,t)).progress+=t*r.efficiency*x,r.progress>n.produceTime){r.progress-=n.produceTime;for(var a=Object.assign({},r.inbox),o=Object.assign({},r.outbox),i=0,c=Object.entries(n.consumes);i<c.length;i++){var s=c[i],u=Object(O.a)(s,2),l=u[0],d=u[1];a[l]-=d}for(var p=0,b=Object.entries(n.produces);p<b.length;p++){var f=b[p],g=Object(O.a)(f,2),m=g[0],v=g[1];o[m]+=v}r.inbox=a,r.outbox=o}return r}function K(e,t){return e.efficiencyTimer+=t,e.efficiencyTimer>G&&(e.efficiencyTimer-=G,e.efficiencySupplied?e.efficiency=Math.min(H,e.efficiency+1):e.efficiency=Math.max(B,e.efficiency-1)),e}var q=r(26);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q="IDLE",J="PICKING_UP",X="EN_ROUTE",V="DROPPING_OFF",$={status:Q,progress:0,timeThreshold:0,jobDescription:{},payload:{},markedForDeath:!1},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload,n=e.couriers;if(!n)return e;switch(t.type){case l.INIT:var a=y[e.warehouse.type],o=n.couriers.slice(0);ee(o,a.couriers);var i=Object.assign({},n);return i.couriers=o,Object.assign({},e,{couriers:i});case f.UPDGRADE_WAREHOUSE:var c=y[r.toUpgrade].upgradesTo;r.toConstruct={id:c};case f.BUILD_WAREHOUSE:var s=y[r.toConstruct.id],u=s.couriers,d=Object.assign({},e),p=Object.assign({},d.couriers);d.couriers=p;var b=p.couriers.slice(0);return ee(b,u),p.couriers=b,d;case g.DESTROY_BUILDING:var O=r.toDestroy;if(O.category!==v.WAREHOUSE)return e;for(var m=Object(q.a)(e.couriers.couriers),h=Y({},e.couriers,{couriers:m}),j=Y({},e,{couriers:h}),w=0;w<m.length;w++){var E=m[w];if(E.status===Q&&!E.markmarkedForDeath)return m.splice(w,1),j}for(var S=m.length-1;S>=0;S--){var D=m[S];if(!D.markmarkedForDeath)return D.markedForDeath=!0,j}return j;case l.TICK:var P=Object.assign({},e),I=Object.assign({},P.couriers),k=Object.assign({},P.warehouse),T=k.totalCapacity,C=Object.assign({},k.resources);k.resources=C;var U=Object.assign({},P.buildings),R=Object.assign({},U.owned);U.owned=R,P.warehouse=k,P.buildings=U,P.couriers=I;var N=ne(n,k,R),A=n.jobQueue.slice(0).concat(N.jobList),_=Object.assign({},n.jobQueueMap,N.jobRef),L=I.couriers.map((function(e){if(e.status===Q){var t=Object.assign({},e),r=ae(A,R),n=A[r];if(A=A.slice(r+1),!n)return e;var a=n.from,o=n.to,i=n.carrying,c=null,s=null,u=0;if(c="warehouse"!==a?U.owned[a]:k,s="warehouse"!==o?U.owned[o]:k,"warehouse"===a){var l=M-s.inbox[i],d=Math.floor(C[i].owned-C[i].reserved);u=Math.min(l,d);var p=Object.assign({},C[i]);p.reserved+=u,C[i]=p}else{var b=c.outbox[i],O=Math.floor(T-C[i].owned-C[i].pending);u=Math.min(b,O);var f=Object.assign({},C[i]);f.pending+=u,C[i]=f}return n.amount=u,t.status=J,t.timeThreshold=8,t.jobDescription=n,t}return e}));I.jobQueue=A,I.jobQueueMap=_;L.map((function(e){if(e.status===Q)return e;if(e.progress+=r.tickIntervalSeconds,e.progress>=e.timeThreshold){e.progress-=e.timeThreshold;var t=e.jobDescription,n=t.from,a=t.to,o=t.carrying,i=t.amount,c=null,s=null;switch("warehouse"!==n?R.hasOwnProperty(n)&&(c=Object.assign({},R[n]),R[n]=c):c=k,"warehouse"!==a?R.hasOwnProperty(a)&&(s=Object.assign({},R[a]),R[a]=s):s=k,e.status){case J:var u=Object.assign({},e.payload);if(e.payload=u,"warehouse"===n){var l=Object.assign({},C[o]);C[o]=l,l.owned-=i,l.reserved-=i,u[o]=i}else{if(!c){e.payload={},e.status=Q,e.jobDescription={},e.progress=0,e.timeThreshold=0,delete _[e.jobDescription.id];break}var d=Object.assign({},c.outbox);c.outbox=d,d[o]-=i,u[o]=i,delete _[e.jobDescription.id]}e.status=X,e.timeThreshold=20;break;case X:e.status=V,e.timeThreshold=8;break;case V:var p=Object.assign({},e.payload);if("warehouse"===a){var b=Object.assign({},C[o]);C[o]=b,b.owned+=p[o],b.pending-=i}else{if(s){var O=Object.assign({},s.inbox);s.inbox=O,O[o]+=i}else{var f=Object.assign({},C[o]);C[o]=f,f.owned+=p[o]}delete _[e.jobDescription.id]}e.payload={},e.status=Q,e.jobDescription={},e.progress=0,e.timeThreshold=0}}return e}));var x=L.filter((function(e){return e.status!==Q||!e.markedForDeath}));return I.couriers=x,P.couriers=I,P;default:return e}};function ee(e,t){for(var r=0;r<t;r++){var n=Object.assign({},$,{id:C()()});e.push(n)}}var te="_SUPPLY",re="_PICKUP";function ne(e,t,r){for(var n=e.jobQueueMap,a=t.totalCapacity,o=t.resources,i={jobList:[],jobRef:{}},c=0,s=Object.values(r);c<s.length;c++){var u=s[c];if(y[u.buildingId].category===v.PRODUCER)for(var l=0,d=Object.entries(u.inbox);l<d.length;l++){var p=d[l],b=Object(O.a)(p,2),f=b[0],g=b[1],m=u.id+"_"+f+"_"+te;if(g<M&&!n[m]){var h=o[f];if(Math.floor(h.owned-h.reserved)>0){var j={id:m,from:"warehouse",to:u.id,carrying:f};i.jobList.push(j),i.jobRef[m]=j}}}}var w=Object.values(r).reduce((function(e,t){if(y[t.buildingId].category!==v.PRODUCER)return e;for(var r=0,i=Object.entries(t.outbox);r<i.length;r++){var c=i[r],s=Object(O.a)(c,2),u=s[0],l=s[1],d=t.id+re;if(l>0&&!n[d]){var p=o[u];if(Math.floor(a-p.owned-p.pending)>0){var b={id:d,from:t.id,to:"warehouse",carrying:u};e.jobList.push(b),e.jobRef[d]=b}}}return e}),{jobList:[],jobRef:{}});return{jobList:i.jobList.concat(w.jobList),jobRef:Object.assign({},i.jobRef,w.jobRef)}}function ae(e,t){for(var r=0;r<e.length;r++){var n=e[r],a=n.from,o=n.to;if(("warehouse"===a||t.hasOwnProperty(a))&&("warehouse"===o||t.hasOwnProperty(o)))return r}}function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ce={popProgress:0,currentPop:1},se={peasanthouse:.8,citizenhouse:.6},ue={peasanthouse:["peasanthouse","citizenhouse"],citizenhouse:["citizenhouse"],patricianhouse:[]};function le(e,t,r){var n=ue[r].reduce((function(t,r){return t+e[r].owned}),0);t.totalAscensionRights=Math.floor(se[r]*n);var a=y[r].ascendsTo,o=ue[a].reduce((function(t,r){return t+e[r].owned}),0);t.remainingAscensionRights=t.totalAscensionRights-o}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var be={owned:0,maxPopulation:0,happiness:0,canAscend:!1,consumeInfo:""},Oe={owned:0,maxPopulation:0,happiness:0,unhoused:0,beggarTimer:0};function fe(e){return Math.floor(.1*e.citizen.maxPopulation+.2*e.patrician.maxPopulation+.3*e.noble.maxPopulation)}var ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:for(var n=r.tickIntervalSeconds,a=Object.assign({},e),o=e.buildings,i={},c=0,s=Object.values(o.owned);c<s.length;c++){var u=s[c],d=y[u.buildingId];if(d.category===v.AMENITY)for(var p=0,b=Object.entries(d.produces);p<b.length;p++){var f=b[p],g=Object(O.a)(f,2),m=g[0],h=g[1];i[m]||(i[m]=0),i[m]+=h*n*(1/60)}}return a.amenities=i,a;default:return e}},me={beggar:{name:"Beggar",taxRate:0,consumes:{fish:{quantity:.7,weight:0},cider:{quantity:.3,weight:0}}},peasant:{name:"Peasant",taxRate:.8,consumes:{community:{quantity:1,weight:25},fish:{quantity:1,weight:25},cider:{quantity:.44,weight:25},faith:{quantity:1,weight:25}}},citizen:{name:"Citizen",taxRate:.95,consumes:{fish:{quantity:.4,weight:8},spice:{quantity:.4,weight:12},cider:{quantity:.44,weight:20},linen:{quantity:.42,weight:20},community:{quantity:1,weight:20},faith:{quantity:1,weight:20}}},patrician:{name:"Patrician",taxRate:1.05,consumes:{}},noble:{name:"Noble",taxRate:1.15,consumes:{}}},ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,a=Object.assign({},e),o=Object.assign({},a.warehouse),i=Object.assign({},o.resources);o.resources=i;var c=a.amenities,s=Object.assign({},a.population);a.warehouse=o,a.population=s;for(var u=0,d=Object.entries(e.population);u<d.length;u++){var p=d[u],b=Object(O.a)(p,2),f=b[0],g=b[1],m=Object.assign({},g);m.consumeInfo=null;var v=0;if(0!==g.owned)for(var h=0,y=Object.entries(me[f].consumes);h<y.length;h++){var j=y[h],w=Object(O.a)(j,2),E=w[0],S=w[1],D=S.quantity*m.owned*n*(1/60)*.01,P=1;if(c[E])c[E]<D&&(P=c[E]/D,m.consumeInfo||(m.consumeInfo="Need "+E)),c[E]-=D,c[E]<0&&(c[E]=0);else if(i[E]){var I=Object.assign({},i[E]);i[E]=I,I.owned<D&&(P=I.owned/D,m.consumeInfo||(m.consumeInfo="Need "+E)),I.owned-=D,I.owned<0&&(I.owned=0)}else P=0,m.consumeInfo||(m.consumeInfo="Need "+E);v+=S.weight*P}var k=(v-m.happiness)/100;Math.abs(k)<.001&&(k=.001),m.happiness+=k,s[f]=m}return a;default:return e}},he=r(35),ye=r.n(he);function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee=20,Se=200,De=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,a=Object.assign({},e),o=Object.assign({},a.housing),i=Object.assign({},a.population);a.housing=o,a.population=i;var c={},s=o.abodes.map((function(e){var t=Object.assign({},e),r=i[y[t.houseId].populationCategory].happiness,a=0;r>=40&&t.currentPop<t.populationCap&&(a=1),r<=20&&t.currentPop>0&&(a=-1),t.popProgress+=n*a,(t.popProgress>10||t.popProgress<-10)&&(t.popProgress-=10*a,t.currentPop+=a),t.currentPop<1&&(t.currentPop=1);var o=y[t.houseId].populationCategory;return c[o]||(c[o]=0),c[o]+=t.currentPop,t}));o.abodes=s;for(var u=0,d=Object.entries(c);u<d.length;u++){var p=d[u],b=Object(O.a)(p,2),f=b[0],g=b[1],m=Object.assign({},i[f]);m.owned=g,i[f]=m}var v=we({},i.beggar);if(v.owned<v.maxPopulation&&(v.beggarTimer+=n,v.beggarTimer>1200)){v.beggarTimer-=1200;var h=Pe(v.maxPopulation-v.owned);v.owned+=h}return i.beggar=v,a;default:return e}};function Pe(e){var t=Math.max(e,Ee),r=Math.min(t,Se);return ye()({min:t,max:r,integer:!0})}var Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var n=r.tickIntervalSeconds,a=Object.assign({},e),o=Object.assign({},a.warehouse),i=Object.assign({},o.resources),c=Object.assign({},i.gold);a.warehouse=o,o.resources=i,i.gold=c;var s={maintenanceCost:0,taxRevenue:0},u=y[o.type].upkeep*n*(1/60),d=Object.values(e.buildings.owned).reduce((function(e,t){return e+(t.enabled?y[t.buildingId].upkeep:y[t.buildingId].disabledUpkeep)*n*(1/60)}),u),p=Object.values(e.population).reduce((function(e,t){var r=.01*t.happiness;return r<.01&&(r=.01),e+me[t.id].taxRate*t.owned*n*(1/60)*r}),0);return s.maintenanceCost=d,s.taxRevenue=p,a.financeInfo=s,c.owned=c.owned+p-d,a;default:return e}},ke=[["peasant",60],["peasant",90],["citizen",1],["citizen",355],["patrician",510],["patrician",1190],["nobleman",950],["nobleman",2200],["nobleman",3500],["nobleman",7500]],Te=[{title:"Small Settlement",buildings:["marketplace","fishinghut","lumberjackhut"],population:"peasant",resources:["gold","wood","tool","fish"]},{buildings:["orchard","ciderfarm"],resources:["apple","cider"]},{title:"Settlement",buildings:["chapel"]},{population:"citizen",resources:["hemp","linen","stone","stonebrick","spice"],buildings:["hempfarm","weavers","quarry","stonemason"],housing:["citizenhouse"]}];function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.TICK:var r=Object(O.a)(ke[e.island.level-1],2),n=r[0],a=r[1],o=e.population[n].owned;if(o>=a){var i=Object.assign({},e),c=Object.assign({},i.island);i.island=c,c.level++;var s=Te[c.level-1];if(s.title&&(c.title=s.title),s.buildings){var u=Object.assign({},i.construction);i.construction=u,s.buildings.forEach((function(e){var t=Object.assign({},u[e]);t.unlocked=!0,u[e]=t}))}if(s.resources){var d=Object.assign({},i.warehouse),p=Object.assign({},d.resources);i.warehouse=d,d.resources=p,s.resources.forEach((function(e){var t=Object.assign({},p[e]);p[e]=t,t.unlocked=!0}))}if(s.population){var b=Object.assign({},i.population);i.population=b;var f=Object.assign({},b[s.population]);f.unlocked=!0,b[s.population]=f}if(s.housing){var g=Ue({},i.housing.types),m=Ue({},i.housing,{types:g});i.housing=m,s.housing.forEach((function(e){var t=Ue({},g[e],{unlocked:!0});g[e]=t}))}return i}return e;default:return e}},Ne={SET_TIME_FACTOR:"SET_TIME_FACTOR"};function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case Ne.SET_TIME_FACTOR:return _e({},e,{cheat:{timeFactor:r.timeFactor}});default:return e}},xe={lord:{name:"Lord Farquaad",rates:{wood:{buy:.5,sell:1.2},tool:{buy:.5,sell:1.2},stonebrick:{buy:.5,sell:1.2},spice:{buy:1,sell:0}},baseCapacity:30},prince:{name:"Prince Ali",rates:{wood:{buy:1,sell:1},tool:{buy:1,sell:1.2},spice:{buy:0,sell:1.25}},baseCapacity:40}},Ge={gold:{name:"Gold",baseTradePrice:1},tool:{name:"Tool",baseTradePrice:15},fish:{name:"Fish",baseTradePrice:3},wood:{name:"Wood",baseTradePrice:1},apple:{name:"Apple",baseTradePrice:.2},cider:{name:"Cider",baseTradePrice:3},hemp:{name:"Hemp",baseTradePrice:4},linen:{name:"Clothing",baseTradePrice:27},stone:{name:"Stone",baseTradePrice:6},stonebrick:{name:"Stone Brick",baseTradePrice:8},spice:{name:"Spice",baseTradePrice:6}};function Be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Me=360,Fe={traderId:0,timer:0,timeToLeave:Me,wares:{},newGame:!0,dismissCost:100};function We(e){var t=Object.keys(xe),r=t[Math.floor(Math.random()*t.length)];e.newGame&&(e.newGame=!1,r="lord");for(var n=xe[r],a={},o=n.baseCapacity,i=He({},e,{traderId:r,wares:a,maxCapacity:o,timeToLeave:Me}),c=0,s=Object.entries(n.rates);c<s.length;c++){var u=s[c],l=Object(O.a)(u,2),d=l[0],p=l[1],b=Ge[d].baseTradePrice,f=p.buy*b,g=p.sell*b;a[d]={buyPrice:f,sellPrice:g,held:0},g>0&&(a[d].held=Math.floor(.75*o))}return i}var Ke=Object(s.c)({cheat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},island:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.CHANGE_NAME:return b({},e,{name:r.name});default:return e}},warehouse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:var n=Object.assign({},e),a=Object.entries(n.resources).reduce((function(e,t){var r=Object(O.a)(t,2),n=r[0],a=r[1],o=Object.assign({},a,D);return e[n]=o,e}),{});return n.resources=a,n;case j.BUILD_HOUSE:case j.ASCEND_HOUSE:case g.CONSTRUCT_BUILDING:var o=Object.assign({},e),i=r.toConstruct.cost,c=P(o.resources,i);return o.resources=c,o;case f.BUILD_WAREHOUSE:var s=Object.assign({},e),u=r.toConstruct.cost,p=P(s.resources,u);s.resources=p;var b=y[r.toConstruct.id];return s.totalCapacity+=b.capacity,s;case f.UPDGRADE_WAREHOUSE:var m=Object.assign({},e),v=y[e.type],h=y[v.upgradesTo];if(!h)return e;var E=v.upgradeCost,I=P(m.resources,E);return m.resources=I,m.totalCapacity+=h.capacity,m.type=y[e.type].upgradesTo,m;case w.DISMISS_TRADER:var k=r.cost,T=P(e.resources,k);return S({},e,{resources:T});case w.BUY_GOODS:var C=r.product,U=r.amount,R=r.atPrice,N=S({},e.resources.gold);N.owned-=U*R;var A=S({},e.resources[C]);A.owned+=U;var _=S({},e.resources,Object(d.a)({gold:N},C,A));return S({},e,{resources:_});case w.SELL_GOODS:var L=r.product,x=r.amount,G=r.atPrice,B=S({},e.resources.gold);B.owned+=x*G;var H=S({},e.resources[L]);H.owned-=x;var M=S({},e.resources,Object(d.a)({gold:B},L,H));return S({},e,{resources:M});default:return e}},construction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case f.BUILD_WAREHOUSE:case j.BUILD_HOUSE:case g.CONSTRUCT_BUILDING:var n=r.toConstruct.id,a=e[n],o=Object.assign({},a,{owned:a.owned+1});return Object.assign({},e,Object(d.a)({},n,o));case g.DESTROY_BUILDING:var i=r.toDestroy.buildingId,c=k({},e[i]);return c.owned--,k({},e,Object(d.a)({},i,c));default:return e}},buildings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:if(!e.owned)return e;var n=Object.assign({},e),a=Object.assign({},n.owned);n.owned=a;var o=r.tickIntervalSeconds;return Object.values(e.owned).forEach((function(e){var t=null;t=y[e.buildingId].category===v.PRODUCER?W(e,o):e,a[t.id]=t})),n;case f.BUILD_WAREHOUSE:case g.CONSTRUCT_BUILDING:var i=y[r.toConstruct.id],c=Object.assign({},{id:C()(),buildingId:r.toConstruct.id,enabled:!0});i.category===v.PRODUCER&&F(c=Object.assign(c,L));var s=Object.assign({},e.owned);return s[c.id]=c,Object.assign({},e,{owned:s});case g.DESTROY_BUILDING:var u=r.toDestroy,p=_({},e.owned);return delete p[u.id],_({},e,{owned:p});case U.DISABLE_BUILDING:var b=r.id,O=_({},e.owned[b],{enabled:!1}),m=_({},e.owned,Object(d.a)({},b,O));return _({},e,{owned:m});case U.ENABLE_BUILDING:var h=r.id,j=_({},e.owned[h],{enabled:!0}),w=_({},e.owned,Object(d.a)({},h,j));return _({},e,{owned:w});default:return e}},couriers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},housing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case j.BUILD_HOUSE:var n=Object.assign({},e),a=Object.assign({},n.types),o=n.abodes.slice(0);n.types=a,n.abodes=o;var i=r.toConstruct.id,c=Object.assign({},a[i]);a[i]=c;var s=y[i],u=ie({},ce,{houseId:i,populationCap:s.populationCap});return c.owned+=1,o.push(u),le(a,c,i),n;case j.ASCEND_HOUSE:var l,p=r.fromHouse,b=y[p].ascendsTo,O=ie({},e.types[p]),f=ie({},e.types[b]),g=ie({},e.types,(l={},Object(d.a)(l,p,O),Object(d.a)(l,b,f),l)),m=Object(q.a)(e.abodes),v=ie({},e,{types:g,abodes:m}),h=y[b],w=m.findIndex((function(e){return e.houseId===p}));return m.splice(w,1),m.push(ie({},h,{},ce,{houseId:b})),O.owned-=1,f.owned+=1,le(g,O,p),le(g,f,b),v;default:return e}},population:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:for(var n=Object.assign({},e),a=0,o=Object.entries(n);a<o.length;a++){var i=o[a],c=Object(O.a)(i,2),s=c[0],u=c[1];if("beggar"===s)n[s]=pe({},Oe,{},u);else{var p=Object.assign({},u,be);n[s]=p}}return n;case j.BUILD_HOUSE:var b=y[r.toConstruct.id],f=Object.assign({},e),g=Object.assign({},f[b.populationCategory]);return f[g.id]=g,g.maxPopulation+=b.populationCap,f;case l.TICK:for(var m=Object.assign({},e),v=(r.tickIntervalSeconds,0),h=Object.entries(m);v<h.length;v++){var w=h[v],E=Object(O.a)(w,2),S=E[0],D=E[1];D.happiness>97&&D.owned===D.maxPopulation?m[S]=pe({},D,{canAscend:!0}):m[S]=pe({},D,{canAscend:!1})}return m;case j.ASCEND_HOUSE:var P,I=y[r.fromHouse],k=y[I.ascendsTo],T=pe({},e[I.populationCategory]),C=pe({},e[k.populationCategory]);T.owned-=I.populationCap,C.owned+=I.populationCap,T.maxPopulation-=I.populationCap,C.maxPopulation+=k.populationCap;var U=pe({},e,(P={},Object(d.a)(P,I.populationCategory,T),Object(d.a)(P,k.populationCategory,C),P)),R=fe(U);return U.beggar=pe({},U.beggar,{maxPopulation:R}),U;default:return e}},trader:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe,t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case w.BUY_GOODS:var n=r.product,a=r.amount,o=He({},e.wares),i=He({},e,{wares:o});return o[n].held-=a,i;case w.SELL_GOODS:var c=r.product,s=r.amount,u=He({},e.wares),d=He({},e,{wares:u});return u[c].held+=s,d;case l.TICK:var p=r.tickIntervalSeconds,b=He({},e);return b.timer+=p,b.timer>b.timeToLeave?(b.timer-=b.timeToLeave,We(b)):b;case w.DISMISS_TRADER:var O=He({},e);return O.traderId=0,O.wares={},O.time=0,O.timeToLeave=180,O;default:return e}}});var qe=function(e,t){if(t.type===l.LOAD_GAME)return t.payload.saveState;if(t.type===l.TICK){var r=e.cheat.timeFactor;r||(r=1),t.payload.tickIntervalSeconds*=r}var n=Le(e,t),a=Ke(n,t),o=Z(a,t);if(t.type===l.TICK){var i=ge(o,t),c=ve(i,t),s=De(c,t),u=Ie(s,t);return Re(u,t)}return o},ze={island:{level:1,title:"Small Settlement",name:"New Island"},construction:{peasanthouse:{id:"peasanthouse",owned:0,cost:{wood:2},unlocked:!0},marketplace:{id:"marketplace",owned:0,cost:{gold:400,wood:5,tool:3},unlocked:!0},fishinghut:{id:"fishinghut",owned:0,cost:{gold:100,wood:3,tool:2},unlocked:!0},lumberjackhut:{id:"lumberjackhut",owned:0,cost:{gold:50,tool:2},unlocked:!0},smallstockpile:{id:"smallstockpile",owned:0,cost:{gold:200,wood:2,tool:3},unlocked:!0},orchard:{id:"orchard",owned:0,cost:{gold:25},unlocked:!1},ciderfarm:{id:"ciderfarm",owned:0,cost:{gold:100,wood:5,tool:1},unlocked:!1},chapel:{id:"chapel",owned:0,cost:{gold:1500,wood:12,tool:5},unlocked:!1},hempfarm:{id:"hempfarm",owned:0,cost:{gold:400,wood:5,tool:2},unlocked:!1},weavers:{id:"weavers",owned:0,cost:{gold:400,wood:5,tool:3}},quarry:{id:"quarry",owned:0,cost:{gold:400,wood:2,tool:2}},stonemason:{id:"stonemason",owned:0,cost:{gold:400,wood:2,tool:2}}},buildings:{owned:{}},warehouse:{type:"smallwarehouse",totalCapacity:40,resources:{gold:{id:"gold",owned:5e3,unlocked:!0},tool:{id:"tool",owned:40,unlocked:!0},fish:{id:"fish",owned:2,unlocked:!0},wood:{id:"wood",owned:40,unlocked:!0},apple:{id:"apple",owned:0,unlocked:!1},cider:{id:"cider",owned:0,unlocked:!1},hemp:{id:"hemp",owned:0,unlocked:!1},spice:{id:"spice",owned:0,unlocked:!1},linen:{id:"linen",owned:0,unlocked:!1},stone:{id:"stone",owned:0,unlocked:!1},stonebrick:{id:"stonebrick",owned:0,unlocked:!1}}},couriers:{couriers:[],jobQueue:[],jobQueueMap:{}},housing:{types:{peasanthouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!0},citizenhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},patricianhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},noblehouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1}},abodes:[]},population:{beggar:{id:"beggar",unlocked:!0},peasant:{id:"peasant",unlocked:!0},citizen:{id:"citizen",unlocked:!1},patrician:{id:"patrician",unlocked:!1},noble:{id:"noble",unlocked:!1}}};r(53),r(54);var Ye=r(36),Qe=r(37),Je=function(){function e(t,r){Object(Ye.a)(this,e),this.targetFunction=t,this.targetInterval=r,this.running=!1}return Object(Qe.a)(e,[{key:"start",value:function(){var e=this;if(!this.running){var t=Date.now();this.running=!0;setTimeout(function r(){if(e.running){var n=Date.now(),a=n-t;e.targetFunction(a),t=n,setTimeout(r.bind(e),e.targetInterval)}}.bind(this),this.targetInterval)}}},{key:"stop",value:function(){this.running=!1}}]),e}(),Xe=function(){var e=Object(c.d)((function(e){return e.island.name})),t=Object(c.d)((function(e){return e.island.title})),r=Object(c.c)();return a.a.createElement("div",{className:"title"},a.a.createElement("h2",null,e," ",a.a.createElement("button",{onClick:function(){var e=prompt("Enter name");e&&r(function(e){return{type:l.CHANGE_NAME,payload:{name:e}}}(e.substring(0,100)))}},"Change Name")),a.a.createElement("h4",null,t))},Ve=function(){var e=Object(c.c)(),t=Object(n.useState)(1),r=Object(O.a)(t,2),o=r[0],i=r[1];return a.a.createElement("div",{className:"time-factor"},a.a.createElement("form",{onSubmit:function(t){e(function(e){return{type:Ne.SET_TIME_FACTOR,payload:{timeFactor:e}}}(o)),t.preventDefault()}},a.a.createElement("input",{type:"number",name:"timeFactor",onChange:function(e){return i(e.target.value)},required:!0}),a.a.createElement("input",{type:"submit",value:"Set time factor"})))};function $e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var et=function(e){return Object.entries(e).reduce((function(e,t){var r=Object(O.a)(t,2),n=r[0],a=r[1];return a.unlocked&&(e[n]=a),e}),{})},tt=function(e,t){for(var r=0,n=Object.entries(e.cost);r<n.length;r++){var a=n[r],o=Object(O.a)(a,2),i=o[0],c=o[1];if(!t[i])return Ze({},e,{canAfford:!1});if(t[i].owned<c)return Object.assign({},e,{canAfford:!1})}return Object.assign({},e,{canAfford:!0})},rt=(r(55),function(){var e=Object(c.d)((function(e){return e.warehouse.type})),t=Object(c.d)((function(e){return et(e.warehouse.resources)}),c.b),r=Object(c.d)((function(e){return e.warehouse.totalCapacity})),n=y[e],o=Object(c.c)(),i=null;if(n.upgradesTo){var s=tt({cost:n.upgradeCost},t).canAfford;i=a.a.createElement("button",{onClick:function(){var t;o((t=e,{type:f.UPDGRADE_WAREHOUSE,payload:{toUpgrade:t}}))},disabled:!s},"Upgrade")}return a.a.createElement("div",{className:"resource-panel"},a.a.createElement("h4",null,n.name),i,a.a.createElement("div",{className:"resource-list"},Object.keys(t).map((function(e,n){var o=Ge[e].name;return"gold"!==e?a.a.createElement("div",{key:e},o,": ",t[e].owned.toFixed(1)," / ",r):a.a.createElement("div",{key:e},o,": ",t[e].owned.toFixed(1))}))))}),nt=(r(56),function(){var e=Object(c.d)((function(e){return e.couriers}),c.b);Object(c.d)((function(e){return e.buildings}),c.b);var t=e.couriers.map((function(e){return a.a.createElement("div",{className:"courier",key:e.id},a.a.createElement("div",null,e.status),a.a.createElement("div",null,e.progress.toFixed(1)),a.a.createElement("div",null,JSON.stringify(e.payload)))}));return a.a.createElement("div",{className:"courier-monitor"},t)}),at=(r(57),function(){var e=Object(c.d)((function(e){return e.warehouse.resources})),t=Object(c.d)((function(t){return function(e,t){return Object.entries(e).reduce((function(e,r){var n=Object(O.a)(r,2),a=n[0],o=n[1];return e[a]=tt(o,t),e}),{})}(et(t.construction),e)}),c.b),r=Object(c.c)(),n=Object.entries(t).map((function(e){var t=Object(O.a)(e,2),n=t[0],o=t[1],i=y[n],c=Object.keys(o.cost).map((function(e){return a.a.createElement("div",{className:"construction-ingredient",key:e},Ge[e].name,": ",o.cost[e])})),s=null;return s=i.category===v.HOUSE?function(){return r((e=o,{type:j.BUILD_HOUSE,payload:{toConstruct:e}}));var e}:i.category===v.WAREHOUSE?function(){return r((e=o,{type:f.BUILD_WAREHOUSE,payload:{toConstruct:e}}));var e}:function(){return r((e=o,{type:g.CONSTRUCT_BUILDING,payload:{toConstruct:e}}));var e},a.a.createElement("div",{className:"construction",key:n},a.a.createElement("div",{className:"construction-header"},a.a.createElement("h4",null,i.name)),a.a.createElement("div",{className:"description"},a.a.createElement("h5",null,i.description)),a.a.createElement("div",null,"Owned: ",o.owned),a.a.createElement("div",{className:"ingredientList"},c),a.a.createElement("button",{className:"purchase",onClick:s,disabled:!o.canAfford},"Buy"))}));return a.a.createElement("div",{className:"construction-panel"},n)}),ot=r(40),it=r(41),ct=r(39),st=r(19),ut=function(e){var t=Object(c.c)(),r=e.building,n=y[r.buildingId];return a.a.createElement(st.a,{show:e.show,onHide:e.onClose},a.a.createElement(st.a.Header,{closeButton:!0},a.a.createElement(st.a.Title,null,n.name)),a.a.createElement(st.a.Body,null,a.a.createElement("p",null,n.description),n.category===v.PRODUCER&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null,r.status),a.a.createElement("div",null,"Efficiency: ",r.efficiency),a.a.createElement("div",{className:"inbox"},"Inbox: ",JSON.stringify(r.inbox)),a.a.createElement("div",{className:"outbox"},"Outbox: ",JSON.stringify(r.outbox)))),a.a.createElement(st.a.Footer,null,n.category===v.PRODUCER&&a.a.createElement("button",{onClick:function(){return function(e){e.enabled?t(R(e.id)):t(N(e.id))}(r)}},r.enabled?"Disable":"Enable"),a.a.createElement("button",{onClick:function(){t(m(r))}},"Destroy")))},lt=function(e){var t=Object(n.useState)(!1),r=Object(O.a)(t,2),o=r[0],i=r[1],c=e.building,s=y[c.buildingId].name,u=null;if(y[c.buildingId].category!==v.PRODUCER)u="working";else switch(c.status){case h.DISABLED:u="disabled",s+=" (Disabled)";break;case h.AWAITING_RESOURCES:u="awaiting",s+=" - Awaiting resources!";break;case h.OUTBOX_FULL:u="outbox-full",s+=" - Outbox full!";break;case h.WORKING:u="working"}return a.a.createElement(a.a.Fragment,null,a.a.createElement(ut,{show:o,onClose:function(){return i(!1)},building:c}),a.a.createElement(it.a,{placement:"top",delay:{show:250,hide:250},overlay:function(e){return a.a.createElement(ct.a,e,s)}},a.a.createElement("div",{className:"building-icon "+u,onClick:function(){return i(!0)}},y[c.buildingId].abbreviation)))},dt=(r(59),function(){var e=Object(c.d)((function(e){return e.buildings}),c.b),t=(Object(c.c)(),e.owned),r=Object.values(t).map((function(e){return a.a.createElement(lt,{building:e,key:e.id})}));return a.a.createElement(ot.a,null,a.a.createElement("div",{className:"building-panel"},r))}),pt=(r(60),function(){var e=Object(c.d)((function(e){return et(e.population)}),c.b),t=Object.values(e).map((function(e){var t=me[e.id].name,r=e.happiness?e.happiness.toFixed():0,n=null;return"beggar"===e.id&&(n=1200-e.beggarTimer),a.a.createElement("div",{className:"population",key:e.id},t,": ",e.owned," / ",e.maxPopulation," Happiness: ",r," ",e.consumeInfo," --- ",n)}));return a.a.createElement("div",{className:"population-panel"},t)}),bt=(r(61),function(){var e=Object(c.c)(),t=Object(c.d)((function(e){return et(e.housing.types)}),c.b),r=Object(c.d)((function(e){return e.population}),c.b),n=Object.keys(t).map((function(n){var o=r[y[n].populationCategory],i=t[n].remainingAscensionRights>0&&o.canAscend,c=i?t[n].remainingAscensionRights:0;return a.a.createElement("div",{className:"housing",key:n},a.a.createElement("div",{className:"housing-data"},y[n].name,": ",t[n].owned),a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){e(function(e,t){var r=y[t];return{type:j.ASCEND_HOUSE,payload:{toConstruct:r,fromHouse:e}}}(n,y[n].ascendsTo))},disabled:!i},"Ascend"),c))}));return a.a.createElement("div",{className:"housing-panel"},n)}),Ot=function(){var e=Object(c.d)((function(e){return e})),t=Object(c.c)();return a.a.createElement("div",{className:"save-load"},a.a.createElement("button",{onClick:function(){var t=btoa(JSON.stringify(e));navigator.clipboard.writeText(t).then((function(){alert("Saved to clipboard")}))}},"Save"),a.a.createElement("button",{onClick:function(){var e,r=JSON.parse(atob(prompt("Enter load data")));r?t((e=r,{type:l.LOAD_GAME,payload:{saveState:e}})):alert("Invalid save state")}},"Load"))},ft=(r(62),function(){var e=Object(c.d)((function(e){return e.trader}),c.b),t=Object(c.d)((function(e){return e.warehouse}),c.b),r=Object(c.c)();if(0===e.traderId)return a.a.createElement("div",{className:"trade-panel"},a.a.createElement("h4",null,"Your port is empty"),"Timer: ",(e.timeToLeave-e.timer).toFixed());var n=et(t.resources),o=n.gold.owned,i=Object.entries(e.wares).map((function(i){var c=Object(O.a)(i,2),s=c[0],u=c[1],l=n[s];if(!l)return null;var d=o>=u.sellPrice&&u.held>0&&l.owned+l.pending-l.reserved<t.totalCapacity,p=u.held<e.maxCapacity&&l.owned>0;return a.a.createElement("div",{className:"trade-good",key:s},Ge[s].name," available: ",u.held,a.a.createElement("button",{onClick:function(){return r((e=s,t=1,n=u.sellPrice,{type:w.BUY_GOODS,payload:{product:e,amount:t,atPrice:n}}));var e,t,n},disabled:!d},"Buy for ",u.sellPrice," Gold"),a.a.createElement("button",{onClick:function(){return r((e=s,t=1,n=u.buyPrice,{type:w.SELL_GOODS,payload:{product:e,amount:t,atPrice:n}}));var e,t,n},disabled:!p},"Sell for ",u.buyPrice," Gold"))}));return a.a.createElement("div",{className:"trade-panel"},a.a.createElement("h4",null,xe[e.traderId].name," has visited your island!"),"Timer: ",(e.timeToLeave-e.timer).toFixed(),a.a.createElement("button",{onClick:function(){var t;r((t=e.dismissCost,{type:w.DISMISS_TRADER,payload:{cost:{gold:t}}}))}},"Dismiss for ",e.dismissCost," Gold"),i)}),gt=.001;var mt=function(){var e=Object(n.useState)(new Je((function(e){r((t=e*gt,{type:l.TICK,payload:{tickIntervalSeconds:t}}));var t}),100)),t=Object(O.a)(e,1)[0],r=Object(c.c)();return Object(n.useEffect)((function(){r({type:l.INIT}),t.start()}),[]),a.a.createElement("div",{className:"game"},a.a.createElement(Ot,null),a.a.createElement(Ve,null),a.a.createElement(Xe,null),a.a.createElement(rt,null),a.a.createElement(ft,null),a.a.createElement(pt,null),a.a.createElement(bt,null),a.a.createElement(nt,null),a.a.createElement(at,null),a.a.createElement(dt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(c.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ze;return localStorage.getItem("save")&&(e=JSON.parse(atob(prompt("Enter load data")))),e||(e=ze),Object(s.d)(qe,e,Object(s.a)(u.a)&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}()},a.a.createElement(mt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[42,1,2]]]);
//# sourceMappingURL=main.c6d6a565.chunk.js.map