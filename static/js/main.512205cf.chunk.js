(this["webpackJsonpidle-anno-redux"]=this["webpackJsonpidle-anno-redux"]||[]).push([[0],{45:function(e,t,r){e.exports=r(65)},56:function(e,t,r){},58:function(e,t,r){},59:function(e,t,r){},60:function(e,t,r){},61:function(e,t,r){},62:function(e,t,r){},63:function(e,t,r){},64:function(e,t,r){},65:function(e,t,r){"use strict";r.r(t);var o=r(0),a=r.n(o),n=r(9),i=r.n(n),s=r(3),c=r(17),u=r(39),l={INIT:"INIT",TICK:"TICK",SAVE_GAME:"SAVE_GAME",LOAD_GAME:"LOAD_GAME",RESET_SAVE:"RESET_SAVE",CHANGE_NAME:"CHANGE_NAME"};function d(){return{type:l.SAVE_GAME}}var p=r(6);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=r(5),O={BUILD_WAREHOUSE:"BUILD_WAREHOUSE",UPDGRADE_WAREHOUSE:"UPGRADE_WAREHOUSE",UPGRADE_STOREHOUSE:"UPGRADE_STOREHOUSE"};var f={CONSTRUCT_BUILDING:"CONSTRUCT_BUILDING",DESTROY_BUILDING:"DESTROY_BUILDING"};var h={AMENITY:"AMENITY",PRODUCER:"PRODUCER",HOUSE:"HOUSE",WAREHOUSE:"WAREHOUSE"},v={AWAITING_RESOURCES:"AWAITING_RESOURCES",WORKING:"WORKING",OUTBOX_FULL:"OUTBOX_FULL",DISABLED:"DISABLED"},y={marketplace:{name:"Marketplace",abbreviation:"M",description:"Provides a place for villagers to meet",category:h.AMENITY,produces:{community:2.5},upkeep:10},chapel:{name:"Chapel",abbreviation:"Ch",description:"A basic building for villagers to worship",category:h.AMENITY,produces:{faith:3},upkeep:15},tavern:{name:"Tavern",abbreviation:"Tv",description:"Provides citizens a place to drink",category:h.AMENITY,produces:{entertainment:9},upkeep:30},church:{name:"Church",abbreviation:"Ch",description:"Provides a larger location to worship",category:h.AMENITY,produces:{faith:12},upkeep:40},prison:{name:"Prison",abbreviation:"Pr",description:"Jails bad folks. Provides a sense of security",category:h.AMENITY,produces:{security:16}},fishinghut:{name:"Fisherman's Hut",abbreviation:"F",description:"Gathers fish",category:h.PRODUCER,consumes:{},produces:{fish:1},produceTime:30,upkeep:15,disabledUpkeep:5},lumberjackhut:{name:"Lumberjack's Hut",abbreviation:"L",description:"Gathers wood",category:h.PRODUCER,consumes:{},produces:{wood:1},produceTime:40,upkeep:5,disabledUpkeep:0},orchard:{name:"Orchard",abbreviation:"O",description:"Grows apples to be turned into cider",category:h.PRODUCER,consumes:{},produces:{apple:1},produceTime:100,upkeep:5,disabledUpkeep:0},ciderfarm:{name:"Cidery",abbreviation:"C",description:"Processes apples into cider",category:h.PRODUCER,consumes:{apple:1},produces:{cider:1},produceTime:40,upkeep:15,disabledUpkeep:5},hempfarm:{name:"Hemp Plantation",abbreviation:"H",description:"Grows hemp",category:h.PRODUCER,consumes:{},produces:{hemp:1},produceTime:60,upkeep:20,disabledUpkeep:10},weavers:{name:"Weaver's Hut",abbreviation:"W",description:"Uses hemp to create clothing",category:h.PRODUCER,consumes:{hemp:1},produces:{linen:1},produceTime:30,upkeep:25,disabledUpkeep:12},stonemason:{name:"Stonemason",abbreviation:"Sm",description:"Turns raw stone into stone bricks",category:h.PRODUCER,consumes:{},produces:{stone:1},produceTime:30,upkeep:20,disabledUpkeep:10},oremine:{name:"Ore mine",abbreviation:"Om",description:"Mines raw ore from the ground",category:h.PRODUCER,consumes:{},produces:{ore:1},produceTime:30,upkeep:20,disabledUpkeep:10},charcoalhut:{name:"Charcoal Burner's Hut",abbreviation:"Cc",description:"Burns wood down into charcoal",category:h.PRODUCER,consumes:{},produces:{charcoal:1},produceTime:30,upkeep:10,disabledUpkeep:0},smelter:{name:"Iron Smelter",abbreviation:"I",description:"Converts raw ore to iron ingots",category:h.PRODUCER,consumes:{ore:1,charcoal:1},produces:{iron:1},produceTime:30,upkeep:20,disabledUpkeep:10},toolmaker:{name:"Toolmaker's Workshop",abbreviation:"TW",description:"Creates tools out of iron",category:h.PRODUCER,consumes:{iron:.5},produces:{tool:1},produceTime:30,upkeep:30,disabledUpkeep:15},ropeyard:{name:"Ropeyard",abbreviation:"Rp",description:"Creates rope from hemp",category:h.PRODUCER,consumes:{hemp:.5},produces:{rope:1},produceTime:30,upkeep:40,disabledUpkeep:20},wheatfield:{name:"Wheat Field",abbreviation:"W",description:"Grows wheat",category:h.PRODUCER,consumes:{},produces:{wheat:1},produceTime:30,upkeep:5,disabledUpkeep:0},mill:{name:"Flour Mill",abbreviation:"FM",description:"Grinds wheat into flour",category:h.PRODUCER,consumes:{wheat:1},produces:{flour:1},produceTime:15,upkeep:30,disabledUpkeep:15},bakery:{name:"Bakery",abbreviation:"Bk",description:"Bakes flour into bread",category:h.PRODUCER,consumes:{flour:1},produces:{bread:1},produceTime:15,upkeep:30,disabledUpkeep:15},weaponsmith:{name:"Weaponsmith",abbreviation:"Ws",description:"Forges weapons",category:h.PRODUCER,consumes:{iron:1},produces:{weapon:1},produceTime:30,upkeep:30,disabledUpkeep:15},hopsfield:{name:"Hops Farm",abbreviation:"HF",description:"Grows Hops",category:h.PRODUCER,consumes:{},produces:{hop:1},produceTime:30,upkeep:10,disabledUpkeep:5},brewery:{name:"Brewery",abbreviation:"Bw",description:"Brews Ale",category:h.PRODUCER,consumes:{hop:1.333,wheat:1.333},produces:{ale:1},produceTime:40,upkeep:30,disabledUpkeep:15},potashpit:{name:"Potash Pit",abbreviation:"Pp",description:"Produces Potash",category:h.PRODUCER,consumes:{},produces:{potash:1},produceTime:30,upkeep:30,disabledUpkeep:15},glasssmelter:{name:"Glass Smelter",abbreviation:"GS",description:"Melts quartz down into glass",category:h.PRODUCER,consumes:{potash:1,quartz:.5},produces:{glass:1},produceTime:60,upkeep:30,disabledUpkeep:15},saltmine:{name:"Salt Mine",abbreviation:"SM",description:"Extracts brine from underground deposits",category:h.PRODUCER,consumes:{},produces:{brine:1},produceTime:15,upkeep:20,disabledUpkeep:10},saltworks:{name:"Saltworks",abbreviation:"SW",description:"Refines brine into salt",category:h.PRODUCER,consumes:{brine:1,charcoal:.5},produces:{salt:1},produceTime:15,upkeep:25,disabledUpkeep:15},pigfarm:{name:"Pig Farm",abbreviation:"PF",description:"Raises pigs for slaughter. Produces hides",category:h.PRODUCER,consumes:{},produces:{hide:1},produceTime:30,upkeep:15,disabledUpkeep:5},tannery:{name:"Tannery",abbreviation:"Tn",description:"Tans hides into leather",category:h.PRODUCER,consumes:{hide:1,salt:.5},produces:{leather:1},produceTime:15,upkeep:20,disabledUpkeep:10},papermill:{name:"Paper Mill",abbreviation:"PM",description:"Produces Paper",category:h.PRODUCER,consumes:{wood:1},produces:{paper:1},produceTime:20,upkeep:50,disabledUpkeep:25},printingpress:{name:"Printing Press",abbreviation:"PP",description:"Prints books",category:h.PRODUCER,consumes:{paper:.5,ink:1},produces:{book:1},produceTime:20,upkeep:50,disabledUpkeep:25},alms:{name:"Alms House",abbreviation:"Ah",description:"Provides shelter for 500 beggars",category:h.HOUSE,upkeep:0,populationCategory:"beggar",populationCap:500},peasanthouse:{name:"Peasant Shack",description:"Basic home for villagers. Houses 8",category:h.HOUSE,upkeep:0,populationCategory:"peasant",populationCap:8,ascendsTo:"citizenhouse"},citizenhouse:{name:"Citizen House",description:"Home for citizens",category:h.HOUSE,upkeep:0,populationCategory:"citizen",populationCap:15,ascendsTo:"patricianhouse",cost:{wood:1,tool:1}},patricianhouse:{name:"Patrician House",description:"Home for patricians",category:h.HOUSE,upkeep:0,populationCategory:"patrician",populationCap:25,ascendsTo:"noblehouse",cost:{wood:1,tool:1,stone:4}},noblehouse:{name:"Noble House",description:"Home for nobles",category:h.HOUSE,upkeep:0,populationCategory:"noble",populationCap:40,cost:{wood:1,tool:1,stone:3,glass:4}},smallwarehouse:{name:"Small Warehouse",description:"Basic warehouse for your island",category:h.WAREHOUSE,upkeep:10,couriers:3,capacity:40,upgradesTo:"mediumwarehouse",upgradeCost:{gold:150,wood:2,tool:3,stone:4}},mediumwarehouse:{name:"Medium Warehouse",description:"Expanded warehouse",category:h.WAREHOUSE,upkeep:15,couriers:1,capacity:10},smallstockpile:{name:"Small Stockpile",abbreviation:"SS",description:"Small depot. Provides 1 courier",category:h.WAREHOUSE,upkeep:10,couriers:1,capacity:0,upgradesTo:"mediumstockpile",upgradeCost:{gold:200,wood:3,tool:1,stone:3}},mediumstockpile:{name:"Medium Stockpile",abbreviation:"MS",description:"Medium depot. Provides 2 couriers, and 5 storage",category:h.WAREHOUSE,upkeep:20,couriers:2,capacity:5},smallstorehouse:{name:"Small Storehouse",abbreviation:"So",description:"Increases the warehouse capacity",category:h.WAREHOUSE,upkeep:15,couriers:0,capacity:15},smallshipyard:{name:"Small Shipyard",description:"Doesn't do anything yet!"},largeshipyard:{name:"Large Shipyard",description:"Doesn't do anything yet!"},repaircrane:{name:"Repair Crane",description:"Doesn't do anything yet!"}},w={BUILD_HOUSE:"BUILD_HOUSE",ASCEND_HOUSE:"ASCEND_HOUSE"};var j={BUY_GOODS:"BUY_GOODS",SELL_GOODS:"SELL_GOODS",DISMISS_TRADER:"DISMISS_TRADER"};var E={gold:{name:"Gold",baseTradePrice:1},tool:{name:"Tool",baseTradePrice:15},fish:{name:"Fish",baseTradePrice:3},wood:{name:"Wood",baseTradePrice:1},apple:{name:"Apple",baseTradePrice:.2},cider:{name:"Cider",baseTradePrice:3},spice:{name:"Spice",baseTradePrice:6},hemp:{name:"Hemp",baseTradePrice:4},linen:{name:"Clothing",baseTradePrice:27},stone:{name:"Stone Brick",baseTradePrice:8},ore:{name:"Iron Ore",baseTradePrice:4},charcoal:{name:"Charcoal",baseTradePrice:8},iron:{name:"Iron",baseTradePrice:16},rope:{name:"Rope",baseTradePrice:18},wheat:{name:"Wheat",baseTradePrice:1},flour:{name:"Flour",baseTradePrice:24},bread:{name:"Bread",baseTradePrice:34},weapon:{name:"Weapons",baseTradePrice:24},hop:{name:"Hops",baseTradePrice:2},ale:{name:"Ale",baseTradePrice:14},potash:{name:"Potash",baseTradePrice:10},quartz:{name:"Quartz",baseTradePrice:4},glass:{name:"Glass",baseTradePrice:16},brine:{name:"Brine",baseTradePrice:1},salt:{name:"Salt",baseTradePrice:4},hide:{name:"Hide",baseTradePrice:33},leather:{name:"Leather",baseTradePrice:87},paper:{name:"Paper",baseTradePrice:12},book:{name:"Books",baseTradePrice:30},ink:{name:"Ink",baseTradePrice:9}};function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k={reserved:0,pending:0},D={owned:0,unlocked:!1};function T(e,t){for(var r=Object.assign({},e),o=0,a=Object.entries(t);o<a.length;o++){var n=a[o],i=Object(m.a)(n,2),s=i[0],c=i[1],u=Object.assign({},r[s]);u.owned-=c,r[s]=u}return r}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var R=r(25),C=r.n(R),A={DISABLE_BUILDING:"DISABLE_BUILDING",ENABLE_BUILDING:"ENABLE_BUILDING"};function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L={status:v.AWAITING_RESOURCES,progress:0,efficiency:1,efficiencyTimer:0,efficiencySupplied:!1,inbox:{},outbox:{}},G=.01,H=2,B=1,x=100,M=5;function W(e){var t=y[e.buildingId];e.inbox={};for(var r=0,o=Object.keys(t.consumes);r<o.length;r++){var a=o[r];e.inbox[a]=0}e.outbox={};for(var n=0,i=Object.keys(t.produces);n<i.length;n++){var s=i[n];e.outbox[s]=0}}function F(e,t){var r=Object.assign({},e),o=y[r.buildingId];if(!e.enabled)return r.status=v.DISABLED,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=q(r,t);if(!function(e){for(var t=y[e.buildingId],r=0,o=Object.entries(t.consumes);r<o.length;r++){var a=o[r],n=Object(m.a)(a,2),i=n[0],s=n[1];if(e.inbox[i]<s)return!1}return!0}(r))return r.status=v.AWAITING_RESOURCES,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=q(r,t);if(!function(e){for(var t=y[e.buildingId],r=0,o=Object.entries(t.produces);r<o.length;r++){var a=o[r],n=Object(m.a)(a,2),i=n[0],s=n[1];if(e.outbox[i]+s>M)return!1}return!0}(r))return r.status=v.OUTBOX_FULL,r.efficiencySupplied&&(r.efficiencySupplied=!1,r.efficiencyTimer=0),r=q(r,t);if(r.status=v.WORKING,r.efficiencySupplied||(r.efficiencySupplied=!0,r.efficiencyTimer=0),(r=q(r,t)).progress+=t*r.efficiency*G,r.progress>o.produceTime){r.progress-=o.produceTime;for(var a=Object.assign({},r.inbox),n=Object.assign({},r.outbox),i=0,s=Object.entries(o.consumes);i<s.length;i++){var c=s[i],u=Object(m.a)(c,2),l=u[0],d=u[1];a[l]-=d}for(var p=0,b=Object.entries(o.produces);p<b.length;p++){var g=b[p],O=Object(m.a)(g,2),f=O[0],h=O[1];n[f]+=h}r.inbox=a,r.outbox=n}return r}function q(e,t){return e.efficiencyTimer+=t,e.efficiencyTimer>H&&(e.efficiencyTimer-=H,e.efficiencySupplied?e.efficiency=Math.min(x,e.efficiency+1):e.efficiency=Math.max(B,e.efficiency-1)),e}var z=r(20);function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var V="IDLE",J="PICKING_UP",Q="EN_ROUTE",X="DROPPING_OFF",$={status:V,progress:0,timeThreshold:0,jobDescription:{},payload:{},markedForDeath:!1},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload,o=e.couriers;if(!o)return e;switch(t.type){case l.INIT:var a=y[e.warehouse.type],n=o.couriers.slice(0);ee(n,a.couriers);var i=Object.assign({},o);return i.couriers=n,Object.assign({},e,{couriers:i});case O.UPGRADE_STOREHOUSE:var s=y[r.toUpgrade.buildingId],c=y[s.upgradesTo],u=c.couriers-s.couriers,d=Object(z.a)(e.couriers.couriers);ee(d,u);var p=K({},e.couriers,{couriers:d});return K({},e,{couriers:p});case O.UPDGRADE_WAREHOUSE:var b=y[r.toUpgrade].upgradesTo,g=Object(z.a)(e.couriers.couriers);ee(g,b.couriers);var m=K({},e.couriers,{couriers:g});return K({},e,{couriers:m});case O.BUILD_WAREHOUSE:var v=y[r.toConstruct.id],w=v.couriers,j=Object.assign({},e),E=Object.assign({},j.couriers);j.couriers=E;var P=E.couriers.slice(0);return ee(P,w),E.couriers=P,j;case f.DESTROY_BUILDING:var S=y[r.toDestroy.buildingId];if(S.category!==h.WAREHOUSE)return e;for(var k=Object(z.a)(e.couriers.couriers),D=K({},e.couriers,{couriers:k}),T=K({},e,{couriers:D}),I=S.couriers,U=0,R=0;R<k.length;R++){var C=k[R];if(C.status===V&&!C.markmarkedForDeath&&(k.splice(R,1),++U===I))return T}for(var A=k.length-1;A>=0;A--){var _=k[A];if(!_.markmarkedForDeath&&(_.markedForDeath=!0,++U===I))return T}return T;case l.TICK:var N=Object.assign({},e),L=Object.assign({},N.couriers),G=Object.assign({},N.warehouse),H=G.totalCapacity,B=Object.assign({},G.resources);G.resources=B;var x=Object.assign({},N.buildings),W=Object.assign({},x.owned);x.owned=W,N.warehouse=G,N.buildings=x,N.couriers=L;var F=oe(o,G,W),q=o.jobQueue.slice(0).concat(F.jobList),Y=Object.assign({},o.jobQueueMap,F.jobRef),$=L.couriers.map((function(e){if(e.status===V){var t=Object.assign({},e),r=ae(q,W),o=q[r];if(q=q.slice(r+1),!o)return e;var a=o.from,n=o.to,i=o.carrying,s=null,c=null,u=0;if(s="warehouse"!==a?x.owned[a]:G,c="warehouse"!==n?x.owned[n]:G,"warehouse"===a){var l=M-c.inbox[i],d=Math.floor(B[i].owned-B[i].reserved);u=Math.min(l,d);var p=Object.assign({},B[i]);p.reserved+=u,B[i]=p}else{var b=s.outbox[i],g=Math.floor(H-B[i].owned-B[i].pending);u=Math.min(b,g);var m=Object.assign({},B[i]);m.pending+=u,B[i]=m}return o.amount=u,t.status=J,t.timeThreshold=8,t.jobDescription=o,t}return e}));L.jobQueue=q,L.jobQueueMap=Y,$.forEach((function(e){if(e.status!==V&&(e.progress+=r.tickIntervalSeconds,e.progress>=e.timeThreshold)){e.progress-=e.timeThreshold;var t=e.jobDescription,o=t.from,a=t.to,n=t.carrying,i=t.amount,s=null,c=null;switch("warehouse"!==o?W.hasOwnProperty(o)&&(s=Object.assign({},W[o]),W[o]=s):s=G,"warehouse"!==a?W.hasOwnProperty(a)&&(c=Object.assign({},W[a]),W[a]=c):c=G,e.status){case J:var u=Object.assign({},e.payload);if(e.payload=u,"warehouse"===o){var l=Object.assign({},B[n]);B[n]=l,l.owned-=i,l.reserved-=i,u[n]=i}else{if(!s){e.payload={},e.status=V,e.jobDescription={},e.progress=0,e.timeThreshold=0,delete Y[e.jobDescription.id];break}var d=Object.assign({},s.outbox);s.outbox=d,d[n]-=i,u[n]=i,delete Y[e.jobDescription.id]}e.status=Q,e.timeThreshold=20;break;case Q:e.status=X,e.timeThreshold=8;break;case X:var p=Object.assign({},e.payload);if("warehouse"===a){var b=Object.assign({},B[n]);B[n]=b,b.owned+=p[n],b.pending-=i}else{if(c){var g=Object.assign({},c.inbox);c.inbox=g,g[n]+=i}else{var m=Object.assign({},B[n]);B[n]=m,m.owned+=p[n]}delete Y[e.jobDescription.id]}e.payload={},e.status=V,e.jobDescription={},e.progress=0,e.timeThreshold=0}}}));var Z=$.filter((function(e){return e.status!==V||!e.markedForDeath}));return L.couriers=Z,N.couriers=L,N;default:return e}};function ee(e,t){for(var r=0;r<t;r++){var o=Object.assign({},$,{id:C()()});e.push(o)}}var te="_SUPPLY",re="_PICKUP";function oe(e,t,r){for(var o=e.jobQueueMap,a=t.totalCapacity,n=t.resources,i={jobList:[],jobRef:{}},s=0,c=Object.values(r);s<c.length;s++){var u=c[s];if(y[u.buildingId].category===h.PRODUCER)for(var l=0,d=Object.entries(u.inbox);l<d.length;l++){var p=d[l],b=Object(m.a)(p,2),g=b[0],O=b[1],f=u.id+"_"+g+"_"+te;if(O<M&&!o[f]){var v=n[g];if(Math.floor(v.owned-v.reserved)>0){var w={id:f,from:"warehouse",to:u.id,carrying:g};i.jobList.push(w),i.jobRef[f]=w}}}}var j=Object.values(r).reduce((function(e,t){if(y[t.buildingId].category!==h.PRODUCER)return e;for(var r=0,i=Object.entries(t.outbox);r<i.length;r++){var s=i[r],c=Object(m.a)(s,2),u=c[0],l=c[1],d=t.id+re;if(l>0&&!o[d]){var p=n[u];if(Math.floor(a-p.owned-p.pending)>0){var b={id:d,from:t.id,to:"warehouse",carrying:u};e.jobList.push(b),e.jobRef[d]=b}}}return e}),{jobList:[],jobRef:{}});return{jobList:i.jobList.concat(j.jobList),jobRef:Object.assign({},i.jobRef,j.jobRef)}}function ae(e,t){for(var r=0;r<e.length;r++){var o=e[r],a=o.from,n=o.to;if(("warehouse"===a||t.hasOwnProperty(a))&&("warehouse"===n||t.hasOwnProperty(n)))return r}}function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var se={popProgress:0,currentPop:1},ce={peasanthouse:.8,citizenhouse:.6,patrician:.4,noblehouse:0},ue={peasanthouse:["peasanthouse","citizenhouse","patricianhouse","noblehouse"],citizenhouse:["citizenhouse","patricianhouse","noblehouse"],patricianhouse:["patricianhouse","noblehouse"],noblehouse:["noblehouse"]};function le(e,t,r){var o=ue[r].reduce((function(t,r){return t+e[r].owned}),0);t.totalAscensionRights=Math.floor(ce[r]*o);var a=y[r].ascendsTo,n=ue[a].reduce((function(t,r){return t+e[r].owned}),0);t.remainingAscensionRights=t.totalAscensionRights-n}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var be={owned:0,maxPopulation:0,happiness:0,canAscend:!1,consumeInfo:""},ge={owned:0,maxPopulation:0,happiness:0,unhoused:0,beggarTimer:0};function me(e){return Math.floor(.1*e.citizen.maxPopulation+.2*e.patrician.maxPopulation+.3*e.noble.maxPopulation)}var Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:for(var o=r.tickIntervalSeconds,a=Object.assign({},e),n=e.buildings,i={},s=0,c=Object.values(n.owned);s<c.length;s++){var u=c[s],d=y[u.buildingId];if(d.category===h.AMENITY)for(var p=0,b=Object.entries(d.produces);p<b.length;p++){var g=b[p],O=Object(m.a)(g,2),f=O[0],v=O[1];i[f]||(i[f]=0),i[f]+=v*o*(1/60)}}return a.amenities=i,a;default:return e}},fe={beggar:{name:"Beggar",taxRate:0,consumes:{fish:{quantity:.7,weight:0},cider:{quantity:.3,weight:0}}},peasant:{name:"Peasant",taxRate:.8,consumes:{community:{quantity:1,weight:25},fish:{quantity:1,weight:25},cider:{quantity:.44,weight:25},faith:{quantity:1,weight:25}}},citizen:{name:"Citizen",taxRate:.95,consumes:{fish:{quantity:.4,weight:8},spice:{quantity:.4,weight:12},cider:{quantity:.44,weight:16},linen:{quantity:.42,weight:16},community:{quantity:1,weight:16},faith:{quantity:1,weight:16},entertainment:{quantity:1,weight:16}}},patrician:{name:"Patrician",taxRate:1.05,consumes:{fish:{quantity:.22,weight:2.8},spice:{quantity:.22,weight:4.9},bread:{quantity:.55,weight:6.3},cider:{quantity:.23,weight:4},ale:{quantity:.24,weight:9},linen:{quantity:.19,weight:4.5},leather:{quantity:.28,weight:8.5},community:{quantity:1,weight:12},faith:{quantity:1,weight:12},entertainment:{quantity:1,weight:12},book:{quantity:.16,weight:12},security:{quantity:1,weight:12}}},noble:{name:"Noble",taxRate:1.15,consumes:{}}},he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var o=r.tickIntervalSeconds,a=Object.assign({},e),n=Object.assign({},a.warehouse),i=Object.assign({},n.resources);n.resources=i;var s=a.amenities,c=Object.assign({},a.population);a.warehouse=n,a.population=c;for(var u=0,d=Object.entries(e.population);u<d.length;u++){var p=d[u],b=Object(m.a)(p,2),g=b[0],O=b[1],f=Object.assign({},O);f.consumeInfo=null;var h=0;if(0!==O.owned)for(var v=0,y=Object.entries(fe[g].consumes);v<y.length;v++){var w=y[v],j=Object(m.a)(w,2),E=j[0],P=j[1],S=P.quantity*f.owned*o*(1/60)*.01,k=1;if(s[E])s[E]<S&&(k=s[E]/S,f.consumeInfo||(f.consumeInfo="Need "+E)),s[E]-=S,s[E]<0&&(s[E]=0);else if(i[E]){var D=Object.assign({},i[E]);i[E]=D,D.owned<S&&(k=D.owned/S,f.consumeInfo||(f.consumeInfo="Need "+E)),D.owned-=S,D.owned<0&&(D.owned=0)}else k=0,f.consumeInfo||(f.consumeInfo="Need "+E);h+=P.weight*k}var T=(h-f.happiness)/100;Math.abs(T)<.001&&(T=.001),f.happiness+=T,c[g]=f}return a;default:return e}},ve=r(40),ye=r.n(ve);function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee=20,Pe=200,Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var o=r.tickIntervalSeconds,a=Object.assign({},e),n=Object.assign({},a.housing),i=Object.assign({},a.population);a.housing=n,a.population=i;var s={},c=n.abodes.map((function(e){var t=Object.assign({},e),r=i[y[t.houseId].populationCategory].happiness,a=0;r>=40&&t.currentPop<t.populationCap&&(a=1),r<=20&&t.currentPop>0&&(a=-1),t.popProgress+=o*a,(t.popProgress>10||t.popProgress<-10)&&(t.popProgress-=10*a,t.currentPop+=a),t.currentPop<1&&(t.currentPop=1);var n=y[t.houseId].populationCategory;return s[n]||(s[n]=0),s[n]+=t.currentPop,t}));n.abodes=c;for(var u=0,d=Object.entries(s);u<d.length;u++){var p=d[u],b=Object(m.a)(p,2),g=b[0],O=b[1],f=Object.assign({},i[g]);f.owned=O,i[g]=f}var h=je({},i.beggar);if(h.owned<h.maxPopulation&&(h.beggarTimer+=o,h.beggarTimer>1200)){h.beggarTimer-=1200;var v=ke(h.maxPopulation-h.owned);h.owned+=v}return i.beggar=h,a;default:return e}};function ke(e){var t=Math.max(e,Ee),r=Math.min(t,Pe);return ye()({min:t,max:r,integer:!0})}var De=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:var o=r.tickIntervalSeconds,a=Object.assign({},e),n=Object.assign({},a.warehouse),i=Object.assign({},n.resources),s=Object.assign({},i.gold);a.warehouse=n,n.resources=i,i.gold=s;var c={maintenanceCost:0,taxRevenue:0},u=y[n.type].upkeep*o*(1/60),d=Object.values(e.buildings.owned).reduce((function(e,t){return e+(t.enabled?y[t.buildingId].upkeep:y[t.buildingId].disabledUpkeep)*o*(1/60)}),u),p=Object.values(e.population).reduce((function(e,t){var r=.01*t.happiness;return r<.01&&(r=.01),e+fe[t.id].taxRate*t.owned*o*(1/60)*r}),0);return c.maintenanceCost=d,c.taxRevenue=p,a.financeInfo=c,s.owned=s.owned+p-d,a;default:return e}},Te=[["peasant",60],["peasant",90],["citizen",1],["citizen",240],["citizen",355],["patrician",1],["patrician",510],["patrician",690],["patrician",940],["patrician",1190],["noble",950],["noble",2200],["noble",3500],["noble",7500]],Ie=[{title:"Small Settlement",buildings:["marketplace","fishinghut","lumberjackhut"],population:"peasant",resources:["gold","wood","tool","fish"]},{buildings:["orchard","ciderfarm"],resources:["apple","cider"]},{title:"Settlement",buildings:["chapel"]},{population:"citizen",resources:["hemp","linen","stone","spice"],buildings:["hempfarm","weavers","stonemason"],housing:["citizenhouse"]},{resources:["ore","charcoal","iron","rope"],buildings:["oremine","charcoalhut","smelter","toolmaker","ropeyard","smallshipyard"]},{title:"Village",buildings:["smallstorehouse","repaircrane","tavern","alms"]},{population:"patrician",resources:["wheat","flour","bread","weapon"],buildings:["wheatfield","mill","bakery","weaponsmith","largeshipyard"],housing:["patricianhouse"]},{title:"Small Town",resources:["hop","ale","potash","quartz","glass"],buildings:["hopsfield","brewery","potashpit","glasssmelter","church"]},{resources:["brine","salt","hide","leather"],buildings:["saltmine","saltworks","pigfarm","tannery"]},{resources:["paper","book","ink"],buildings:["papermill","printingpress"]},{title:"City",buildings:["prison"]},{title:"Major City"},{title:"Commercial Center"},{title:"Metropolis"},{title:"Cosmopolitan City"}];function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.TICK:var r=Object(m.a)(Te[e.island.level-1],2),o=r[0],a=r[1],n=e.population[o].owned;if(n>=a){var i=Object.assign({},e),s=Object.assign({},i.island);i.island=s,s.level++;var c=Ie[s.level-1];if(c.title&&(s.title=c.title),c.buildings){var u=Object.assign({},i.construction);i.construction=u,c.buildings.forEach((function(e){var t=Object.assign({},u[e]);t.unlocked=!0,u[e]=t}))}if(c.resources){var d=Object.assign({},i.warehouse),p=Object.assign({},d.resources);i.warehouse=d,d.resources=p,c.resources.forEach((function(e){var t=Object.assign({},p[e]);p[e]=t,t.unlocked=!0}))}if(c.population){var b=Object.assign({},i.population);i.population=b;var g=Object.assign({},b[c.population]);g.unlocked=!0,b[c.population]=g}if(c.housing){var O=Re({},i.housing.types),f=Re({},i.housing,{types:O});i.housing=f,c.housing.forEach((function(e){var t=Re({},O[e],{unlocked:!0});O[e]=t}))}return i}return e;default:return e}},Ae={SET_TIME_FACTOR:"SET_TIME_FACTOR"};function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case Ae.SET_TIME_FACTOR:return Ne({},e,{cheat:{timeFactor:r.timeFactor}});default:return e}},Ge={lord:{name:"Lord Farquaad",rates:{wood:{buy:.5,sell:1.2},tool:{buy:.5,sell:1.2},stone:{buy:.5,sell:1.2},spice:{buy:1,sell:0}},baseCapacity:30},prince:{name:"Prince Ali",rates:{wood:{buy:1,sell:1},tool:{buy:1,sell:1.2},spice:{buy:0,sell:1.25}},baseCapacity:40}};function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var xe=360,Me={traderId:0,timer:0,timeToLeave:xe,wares:{},newGame:!0,dismissCost:100};function We(e){var t=Object.keys(Ge),r=t[Math.floor(Math.random()*t.length)];e.newGame&&(e.newGame=!1,r="lord");for(var o=Ge[r],a={},n=o.baseCapacity,i=Be({},e,{traderId:r,wares:a,maxCapacity:n,timeToLeave:xe}),s=0,c=Object.entries(o.rates);s<c.length;s++){var u=c[s],l=Object(m.a)(u,2),d=l[0],p=l[1],b=E[d].baseTradePrice,g=p.buy*b,O=p.sell*b;a[d]={buyPrice:g,sellPrice:O,held:0},O>0&&(a[d].held=Math.floor(.75*n))}return i}var Fe={island:{level:1,title:"Small Settlement",name:"New Island"},construction:{peasanthouse:{id:"peasanthouse",owned:0,cost:{wood:2},unlocked:!0},marketplace:{id:"marketplace",owned:0,cost:{gold:400,wood:5,tool:3},unlocked:!0},fishinghut:{id:"fishinghut",owned:0,cost:{gold:100,wood:3,tool:2},unlocked:!0},lumberjackhut:{id:"lumberjackhut",owned:0,cost:{gold:50,tool:2},unlocked:!0},smallstockpile:{id:"smallstockpile",owned:0,cost:{gold:200,wood:2,tool:3},unlocked:!0},orchard:{id:"orchard",owned:0,cost:{gold:25},unlocked:!1},ciderfarm:{id:"ciderfarm",owned:0,cost:{gold:100,wood:5,tool:1},unlocked:!1},chapel:{id:"chapel",owned:0,cost:{gold:800,wood:12,tool:5},unlocked:!1},hempfarm:{id:"hempfarm",owned:0,cost:{gold:400,wood:5,tool:2},unlocked:!1},weavers:{id:"weavers",owned:0,cost:{gold:400,wood:5,tool:3}},stonemason:{id:"stonemason",owned:0,cost:{gold:400,wood:2,tool:2}},oremine:{id:"oremine",owned:0,cost:{gold:900,wood:12,tool:2,stone:2}},charcoalhut:{id:"charcoalhut",owned:0,cost:{gold:250,wood:3,tool:2,stone:2}},smelter:{id:"smelter",owned:0,cost:{gold:600,wood:10,tool:5,stone:2}},toolmaker:{id:"toolmaker",owned:0,cost:{gold:500,wood:8,tool:5,stone:2}},ropeyard:{id:"ropeyard",owned:0,cost:{gold:700,wood:12,tool:5}},smallshipyard:{id:"smallshipyard",owned:0,cost:{gold:680,wood:10,tool:5,stone:4}},smallstorehouse:{id:"smallstorehouse",owned:0,cost:{gold:1020,wood:4,tool:4,stone:1}},repaircrane:{id:"repaircrane",owned:0,cost:{gold:1020,wood:5,tool:5,stone:9}},tavern:{id:"tavern",owned:0,cost:{gold:1e3,tool:5,stone:10}},alms:{id:"alms",owned:0,cost:{gold:200,wood:5,tool:5}},wheatfield:{id:"wheatfield",owned:0,cost:{gold:200,wood:3,tool:2}},mill:{id:"mill",owned:0,cost:{gold:800,wood:8,tool:4,stone:4}},bakery:{id:"bakery",owned:0,cost:{gold:700,wood:5,tool:5,stone:5}},weaponsmith:{id:"weaponsmith",owned:0,cost:{gold:1500,wood:3,tool:5,stone:10}},largeshipyard:{id:"largeshipyard",owned:0,cost:{gold:2120,wood:20,tool:25,stone:46}},hopsfield:{id:"hopsfield",owned:0,cost:{gold:200,wood:5,tool:2,stone:4}},brewery:{id:"brewery",owned:0,cost:{gold:600,wood:5,tool:4,stone:6}},potashpit:{id:"potashpit",owned:0,cost:{gold:500,wood:6,tool:4,stone:8}},glasssmelter:{id:"glasssmelter",owned:0,cost:{gold:1200,wood:10,tool:5,stone:12}},church:{id:"church",owned:0,cost:{gold:5e3,wood:30,tool:10,stone:40,glass:25}},saltmine:{id:"saltmine",owned:0,cost:{gold:800,wood:11,tool:4,stone:5}},saltworks:{id:"saltworks",owned:0,cost:{gold:900,wood:3,tool:5,stone:6}},pigfarm:{id:"pigfarm",owned:0,cost:{gold:400,wood:4,tool:4,stone:3}},tannery:{id:"tannery",owned:0,cost:{gold:700,wood:7,tool:3,stone:8}},papermill:{id:"papermill",owned:0,cost:{gold:1500,wood:5,tool:5,stone:12}},printingpress:{id:"printingpress",owned:0,cost:{gold:1800,wood:5,tool:5,stone:12,glass:10}},prison:{id:"prison",owned:0,cost:{gold:7e3,wood:20,tool:30,stone:60,glass:24}}},buildings:{owned:{}},warehouse:{type:"smallwarehouse",totalCapacity:40,resources:{gold:{id:"gold",owned:5e3,unlocked:!0},tool:{id:"tool",owned:40,unlocked:!0},fish:{id:"fish",owned:2,unlocked:!0},wood:{id:"wood",owned:40,unlocked:!0}}},couriers:{couriers:[],jobQueue:[],jobQueueMap:{}},housing:{types:{peasanthouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!0},citizenhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},patricianhouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1},noblehouse:{owned:0,totalAscensionRights:0,remainingAscensionRights:0,unlocked:!1}},abodes:[]},population:{beggar:{id:"beggar",unlocked:!0},peasant:{id:"peasant",unlocked:!0},citizen:{id:"citizen",unlocked:!1},patrician:{id:"patrician",unlocked:!1},noble:{id:"noble",unlocked:!1}}},qe=Object(c.c)({cheat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},island:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.CHANGE_NAME:return g({},e,{name:r.name});default:return e}},warehouse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:var o=Object.assign({},e),a=S({},o.resources);Object.keys(E).forEach((function(e){a.hasOwnProperty(e)||(a[e]=S({},D,{id:e}))}));var n=Object.entries(a).reduce((function(e,t){var r=Object(m.a)(t,2),o=r[0],a=r[1],n=Object.assign({},a,k);return e[o]=n,e}),a);return o.resources=n,o;case w.BUILD_HOUSE:case w.ASCEND_HOUSE:case f.CONSTRUCT_BUILDING:var i=Object.assign({},e),s=r.toConstruct.cost,c=T(i.resources,s);return i.resources=c,i;case O.BUILD_WAREHOUSE:var u=Object.assign({},e),d=r.toConstruct.cost,b=T(u.resources,d);u.resources=b;var g=y[r.toConstruct.id];return u.totalCapacity+=g.capacity,u;case O.UPDGRADE_WAREHOUSE:var h=Object.assign({},e),v=y[e.type],P=y[v.upgradesTo];if(!P)return e;var I=v.upgradeCost,U=T(h.resources,I);return h.resources=U,h.totalCapacity+=P.capacity,h.type=y[e.type].upgradesTo,h;case O.UPGRADE_STOREHOUSE:var R=Object.assign({},e),C=y[r.toUpgrade.buildingId],A=y[C.upgradesTo];if(!A)return e;var _=C.upgradeCost,N=T(R.resources,_);return R.resources=N,R.totalCapacity+=A.capacity,R;case j.DISMISS_TRADER:var L=r.cost,G=T(e.resources,L);return S({},e,{resources:G});case j.BUY_GOODS:var H=r.product,B=r.amount,x=r.atPrice,M=S({},e.resources.gold);M.owned-=B*x;var W=S({},e.resources[H]);W.owned+=B;var F=S({},e.resources,Object(p.a)({gold:M},H,W));return S({},e,{resources:F});case j.SELL_GOODS:var q=r.product,z=r.amount,Y=r.atPrice,K=S({},e.resources.gold);K.owned+=z*Y;var V=S({},e.resources[q]);V.owned-=z;var J=S({},e.resources,Object(p.a)({gold:K},q,V));return S({},e,{resources:J});default:return e}},construction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case O.BUILD_WAREHOUSE:case w.BUILD_HOUSE:case f.CONSTRUCT_BUILDING:var o=r.toConstruct.id,a=e[o],n=Object.assign({},a,{owned:a.owned+1});return Object.assign({},e,Object(p.a)({},o,n));case f.DESTROY_BUILDING:var i=r.toDestroy.buildingId,s=U({},e[i]);return s.owned--,U({},e,Object(p.a)({},i,s));default:return e}},buildings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.TICK:if(!e.owned)return e;var o=Object.assign({},e),a=Object.assign({},o.owned);o.owned=a;var n=r.tickIntervalSeconds;return Object.values(e.owned).forEach((function(e){var t=null;t=y[e.buildingId].category===h.PRODUCER?F(e,n):e,a[t.id]=t})),o;case O.BUILD_WAREHOUSE:case f.CONSTRUCT_BUILDING:var i=y[r.toConstruct.id],s=Object.assign({},{id:C()(),buildingId:r.toConstruct.id,enabled:!0});i.category===h.PRODUCER&&W(s=Object.assign(s,L));var c=Object.assign({},e.owned);return c[s.id]=s,Object.assign({},e,{owned:c});case O.UPGRADE_STOREHOUSE:var u=N({},e.owned[r.toUpgrade.id]);u.buildingId=y[r.toUpgrade.buildingId].upgradesTo;var d=N({},e.owned,Object(p.a)({},r.toUpgrade.id,u));return N({},e,{owned:d});case f.DESTROY_BUILDING:var b=r.toDestroy,g=N({},e.owned);return delete g[b.id],N({},e,{owned:g});case A.DISABLE_BUILDING:var m=r.id,v=N({},e.owned[m],{enabled:!1}),w=N({},e.owned,Object(p.a)({},m,v));return N({},e,{owned:w});case A.ENABLE_BUILDING:var j=r.id,E=N({},e.owned[j],{enabled:!0}),P=N({},e.owned,Object(p.a)({},j,E));return N({},e,{owned:P});default:return e}},couriers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},housing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case w.BUILD_HOUSE:var o=Object.assign({},e),a=Object.assign({},o.types),n=o.abodes.slice(0);o.types=a,o.abodes=n;var i=r.toConstruct.id,s=Object.assign({},a[i]);a[i]=s;var c=y[i],u=ie({},se,{houseId:i,populationCap:c.populationCap});return s.owned+=1,n.push(u),le(a,s,i),o;case w.ASCEND_HOUSE:var l,d=r.fromHouse,b=y[d].ascendsTo,g=ie({},e.types[d]),m=ie({},e.types[b]),O=ie({},e.types,(l={},Object(p.a)(l,d,g),Object(p.a)(l,b,m),l)),f=Object(z.a)(e.abodes),h=ie({},e,{types:O,abodes:f}),v=y[b],j=f.findIndex((function(e){return e.houseId===d}));return f.splice(j,1),f.push(ie({},v,{},se,{houseId:b})),g.owned-=1,m.owned+=1,le(O,g,d),le(O,m,b),h;default:return e}},population:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case l.INIT:for(var o=Object.assign({},e),a=0,n=Object.entries(o);a<n.length;a++){var i=n[a],s=Object(m.a)(i,2),c=s[0],u=s[1];if("beggar"===c)o[c]=pe({},ge,{},u);else{var d=Object.assign({},u,be);o[c]=d}}return o;case w.BUILD_HOUSE:var b=y[r.toConstruct.id],g=Object.assign({},e),O=Object.assign({},g[b.populationCategory]);return g[O.id]=O,O.maxPopulation+=b.populationCap,g;case l.TICK:for(var f=Object.assign({},e),h=0,v=Object.entries(f);h<v.length;h++){var j=v[h],E=Object(m.a)(j,2),P=E[0],S=E[1];S.happiness>97&&S.owned===S.maxPopulation?f[P]=pe({},S,{canAscend:!0}):f[P]=pe({},S,{canAscend:!1})}return f;case w.ASCEND_HOUSE:var k,D=y[r.fromHouse],T=y[D.ascendsTo],I=pe({},e[D.populationCategory]),U=pe({},e[T.populationCategory]);I.owned-=D.populationCap,U.owned+=D.populationCap,I.maxPopulation-=D.populationCap,U.maxPopulation+=T.populationCap;var R=pe({},e,(k={},Object(p.a)(k,D.populationCategory,I),Object(p.a)(k,T.populationCategory,U),k)),C=me(R);return R.beggar=pe({},R.beggar,{maxPopulation:C}),R;default:return e}},trader:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me,t=arguments.length>1?arguments[1]:void 0,r=t.payload;switch(t.type){case j.BUY_GOODS:var o=r.product,a=r.amount,n=Be({},e.wares),i=Be({},e,{wares:n});return n[o].held-=a,i;case j.SELL_GOODS:var s=r.product,c=r.amount,u=Be({},e.wares),d=Be({},e,{wares:u});return u[s].held+=c,d;case l.TICK:var p=r.tickIntervalSeconds,b=Be({},e);return b.timer+=p,b.timer>b.timeToLeave?(b.timer-=b.timeToLeave,We(b)):b;case j.DISMISS_TRADER:var g=Be({},e);return g.traderId=0,g.wares={},g.time=0,g.timeToLeave=180,g;default:return e}}});var ze=function e(t,r){if(r.type===l.SAVE_GAME)return localStorage.setItem("save",btoa(JSON.stringify(t))),t;if(r.type===l.RESET_SAVE){var o=Fe;return o=e(o,{type:l.INIT})}if(r.type===l.LOAD_GAME)return r.payload.saveState;if(r.type===l.TICK){var a=t.cheat.timeFactor;a||(a=1),r.payload.tickIntervalSeconds*=a}var n=Le(t,r),i=qe(n,r),s=Z(i,r),c=Oe(s,r),u=he(c,r),d=Se(u,r),p=De(d,r);return Ce(p,r)};r(56),r(57);var Ye=r(41),Ke=r(42),Ve=function(){function e(t,r){Object(Ye.a)(this,e),this.targetFunction=t,this.targetInterval=r,this.running=!1}return Object(Ke.a)(e,[{key:"start",value:function(){var e=this;if(!this.running){var t=Date.now();this.running=!0;setTimeout(function r(){if(e.running){var o=Date.now(),a=o-t;e.targetFunction(a),t=o,setTimeout(r.bind(e),e.targetInterval)}}.bind(this),this.targetInterval)}}},{key:"stop",value:function(){this.running=!1}}]),e}(),Je=function(){var e=Object(s.d)((function(e){return e.island.name})),t=Object(s.d)((function(e){return e.island.title})),r=Object(s.c)();return a.a.createElement("div",{className:"title"},a.a.createElement("h2",null,e," ",a.a.createElement("button",{onClick:function(){var e=prompt("Enter name");e&&r(function(e){return{type:l.CHANGE_NAME,payload:{name:e}}}(e.substring(0,100)))}},"Change Name")),a.a.createElement("h4",null,t))},Qe=function(){var e=Object(s.c)(),t=Object(o.useState)(1),r=Object(m.a)(t,2),n=r[0],i=r[1];return a.a.createElement("div",{className:"time-factor"},a.a.createElement("form",{onSubmit:function(t){e(function(e){return{type:Ae.SET_TIME_FACTOR,payload:{timeFactor:e}}}(n)),t.preventDefault()}},a.a.createElement("input",{type:"number",name:"timeFactor",onChange:function(e){return i(e.target.value)},required:!0}),a.a.createElement("input",{type:"submit",value:"Set time factor"})))};function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach((function(t){Object(p.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ze=function(e){return Object.entries(e).reduce((function(e,t){var r=Object(m.a)(t,2),o=r[0],a=r[1];return a.unlocked&&(e[o]=a),e}),{})},et=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cost",o=0,a=Object.entries(e[r]);o<a.length;o++){var n=a[o],i=Object(m.a)(n,2),s=i[0],c=i[1];if(!t[s])return $e({},e,{canAfford:!1});if(t[s].owned<c)return Object.assign({},e,{canAfford:!1})}return Object.assign({},e,{canAfford:!0})},tt=r(14),rt=r(29),ot=r(30),at=function(e){var t=e.cost,r=Object.entries(t).map((function(e){var t=Object(m.a)(e,2),r=t[0],o=t[1];return a.a.createElement("div",{className:"construction-ingredient",key:r},E[r].name,": ",o)})),o=e.header?e.header:"Cost",n=a.a.createElement(ot.a,{id:"Price"},a.a.createElement(ot.a.Title,{as:"h3"},o),a.a.createElement(ot.a.Content,null,r));return a.a.createElement(rt.a,{placement:"top",delay:{show:500,hide:250},overlay:n},e.children)},nt=(r(58),function(){var e=Object(s.d)((function(e){return e.warehouse.type})),t=Object(s.d)((function(e){return Ze(e.warehouse.resources)}),s.b),r=Object(s.d)((function(e){return e.warehouse.totalCapacity})),o=y[e],n=Object(s.c)(),i=null;if(o.upgradesTo){var c=et({cost:o.upgradeCost},t).canAfford;i=a.a.createElement(at,{cost:o.upgradeCost,header:"Upgrade for"},a.a.createElement("div",null,a.a.createElement(tt.a,{variant:"primary",size:"sm",onClick:function(){var t;n((t=e,{type:O.UPDGRADE_WAREHOUSE,payload:{toUpgrade:t}}))},disabled:!c},"Upgrade")))}return a.a.createElement("div",{className:"resource-panel"},a.a.createElement("h4",null,o.name),i,a.a.createElement("div",{className:"resource-list"},Object.keys(t).map((function(e,o){var n=E[e].name;return"gold"!==e?a.a.createElement("div",{key:e},n,": ",t[e].owned.toFixed(1)," / ",r):a.a.createElement("div",{key:e},n,": ",t[e].owned.toFixed(1))}))))}),it=(r(59),function(){var e=Object(s.d)((function(e){return e.couriers}),s.b);Object(s.d)((function(e){return e.buildings}),s.b);var t=e.couriers.map((function(e){return a.a.createElement("div",{className:"courier",key:e.id},a.a.createElement("div",null,e.status),a.a.createElement("div",null,e.progress.toFixed(1)),a.a.createElement("div",null,JSON.stringify(e.payload)))}));return a.a.createElement("div",{className:"courier-monitor"},t)}),st=r(28),ct=(r(60),function(){var e=Object(s.d)((function(e){return e.warehouse.resources})),t=Object(s.d)((function(t){return function(e,t){return Object.entries(e).reduce((function(e,r){var o=Object(m.a)(r,2),a=o[0],n=o[1];return e[a]=et(n,t),e}),{})}(Ze(t.construction),e)}),s.b),r=Object(s.c)(),o=Object.entries(t).map((function(e){var t=Object(m.a)(e,2),o=t[0],n=t[1],i=y[o],s=null;return s=i.category===h.HOUSE?function(){return r((e=n,{type:w.BUILD_HOUSE,payload:{toConstruct:e}}));var e}:i.category===h.WAREHOUSE?function(){return r((e=n,{type:O.BUILD_WAREHOUSE,payload:{toConstruct:e}}));var e}:function(){return r((e=n,{type:f.CONSTRUCT_BUILDING,payload:{toConstruct:e}}));var e},a.a.createElement("div",{className:"construction",key:o},a.a.createElement("div",{className:"construction-header"},a.a.createElement("p",null,i.name," ",i.abbreviation&&"("+i.abbreviation+")")),a.a.createElement("div",null,"Built: ",n.owned),a.a.createElement(at,{cost:n.cost,header:i.description},a.a.createElement("div",null,a.a.createElement(tt.a,{variant:"primary",size:"sm",className:"purchase",onClick:s,disabled:!n.canAfford},"Buy"))))}));return a.a.createElement(st.a,{className:"construction-panel"},o)}),ut=r(44),lt=r(21),dt=function(e){var t=Object(s.d)((function(e){return e.warehouse.resources}),s.b),r=Object(s.c)(),o=e.building,n=y[o.buildingId];n.upgradesTo&&(n=et(n,t,"upgradeCost"));var i=function(e){r(function(e){return{type:f.DESTROY_BUILDING,payload:{toDestroy:e}}}(e))},c=function(e){var t;e.enabled?r((t=e.id,{type:A.DISABLE_BUILDING,payload:{id:t}})):r(function(e){return{type:A.ENABLE_BUILDING,payload:{id:e}}}(e.id))},u=function(e){var t;r((t=e,{type:O.UPGRADE_STOREHOUSE,payload:{toUpgrade:t}}))};return a.a.createElement(lt.a,{show:e.show,onHide:e.onClose},a.a.createElement(lt.a.Header,{closeButton:!0},a.a.createElement(lt.a.Title,null,n.name)),a.a.createElement(lt.a.Body,null,a.a.createElement("p",null,n.description),n.category===h.PRODUCER&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null,o.status),a.a.createElement("div",null,"Efficiency: ",o.efficiency),a.a.createElement("div",{className:"inbox"},"Inbox: ",JSON.stringify(o.inbox)),a.a.createElement("div",{className:"outbox"},"Outbox: ",JSON.stringify(o.outbox)))),a.a.createElement(lt.a.Footer,null,n.category===h.PRODUCER&&a.a.createElement(tt.a,{variant:"warning",size:"sm",onClick:function(){return c(o)}},o.enabled?"Disable":"Enable"),n.upgradesTo&&a.a.createElement(at,{cost:n.upgradeCost},a.a.createElement("div",null,a.a.createElement(tt.a,{variant:"primary",size:"sm",disabled:!n.canAfford,onClick:function(){return u(o)}},"Upgrade"))),a.a.createElement(tt.a,{variant:"danger",size:"sm",onClick:function(){return i(o)}},"Destroy")))},pt=function(e){var t=Object(o.useState)(!1),r=Object(m.a)(t,2),n=r[0],i=r[1],s=e.building,c=y[s.buildingId].name,u=null;if(y[s.buildingId].category!==h.PRODUCER)u="working";else switch(s.status){case v.DISABLED:u="disabled",c+=" (Disabled)";break;case v.AWAITING_RESOURCES:u="awaiting",c+=" - Awaiting resources!";break;case v.OUTBOX_FULL:u="outbox-full",c+=" - Outbox full!";break;case v.WORKING:u="working"}return a.a.createElement(a.a.Fragment,null,a.a.createElement(dt,{show:n,onClose:function(){return i(!1)},building:s}),a.a.createElement(rt.a,{placement:"top",delay:{show:250,hide:250},overlay:function(e){return a.a.createElement(ut.a,Object.assign({},e,{id:c}),c)}},a.a.createElement("div",{className:"building-icon "+u,onClick:function(){return i(!0)}},y[s.buildingId].abbreviation)))},bt=(r(61),function(){var e=Object(s.d)((function(e){return e.buildings.owned}),s.b),t=Object.values(e).map((function(e){return a.a.createElement(pt,{building:e,key:e.id})}));return a.a.createElement(st.a,null,a.a.createElement("div",{className:"building-panel"},t))}),gt=(r(62),function(){var e=Object(s.d)((function(e){return Ze(e.population)}),s.b),t=Object.values(e).map((function(e){var t=fe[e.id].name,r=e.happiness?e.happiness.toFixed():0,o=null;return"beggar"===e.id&&(o=1200-e.beggarTimer),a.a.createElement("div",{className:"population",key:e.id},t,": ",e.owned," / ",e.maxPopulation," Happiness: ",r," ",e.consumeInfo," --- ",o)}));return a.a.createElement("div",{className:"population-panel"},t)}),mt=(r(63),function(){var e=Object(s.d)((function(e){return e.warehouse.resources}),s.b),t=Object(s.c)(),r=Object(s.d)((function(e){return Ze(e.housing.types)}),s.b),o=Object(s.d)((function(e){return e.population}),s.b),n=Object.keys(r).map((function(n){var i=y[n],s=y[i.ascendsTo];s&&(s=et(s,e));var c=o[i.populationCategory],u=r[n].remainingAscensionRights>0&&c.canAscend&&s.canAfford,l=u?r[n].remainingAscensionRights:0;return a.a.createElement("div",{className:"housing",key:n},a.a.createElement("div",{className:"housing-data"},i.name,": ",r[n].owned),s&&a.a.createElement(at,{cost:s.cost,header:l+" ascensions available"},a.a.createElement("div",null,a.a.createElement(tt.a,{variant:"primary",size:"sm",onClick:function(){t(function(e,t){var r=y[t];return{type:w.ASCEND_HOUSE,payload:{toConstruct:r,fromHouse:e}}}(n,i.ascendsTo))},disabled:!u},"Ascend"))))}));return a.a.createElement("div",{className:"housing-panel"},n)}),Ot=function(){var e=Object(s.c)();return a.a.createElement("div",{className:"save-load"},a.a.createElement("button",{onClick:function(){e(d());var t=localStorage.getItem("save");navigator.clipboard.writeText(t).then((function(){alert("Saved to clipboard")}))}},"Save"),a.a.createElement("button",{onClick:function(){var t,r=JSON.parse(atob(prompt("Enter load data")));r?e((t=r,{type:l.LOAD_GAME,payload:{saveState:t}})):alert("Invalid save state")}},"Load"),a.a.createElement("button",{onClick:function(){window.confirm("Are you sure you want to clear your save?")&&e({type:l.RESET_SAVE})}},"RESET"))},ft=(r(64),function(){var e=Object(s.d)((function(e){return e.trader}),s.b),t=Object(s.d)((function(e){return e.warehouse}),s.b),r=Object(s.c)();if(0===e.traderId)return a.a.createElement("div",{className:"trade-panel"},a.a.createElement("h4",null,"Your port is empty"),"Timer: ",(e.timeToLeave-e.timer).toFixed());var o=Ze(t.resources),n=o.gold.owned,i=Object.entries(e.wares).map((function(i){var s=Object(m.a)(i,2),c=s[0],u=s[1],l=o[c];if(!l)return null;var d=n>=u.sellPrice&&u.held>0&&l.owned+l.pending-l.reserved<t.totalCapacity,p=u.held<e.maxCapacity&&l.owned>0;return a.a.createElement("div",{className:"trade-good",key:c},E[c].name," available: ",u.held,a.a.createElement("button",{onClick:function(){return r((e=c,t=1,o=u.sellPrice,{type:j.BUY_GOODS,payload:{product:e,amount:t,atPrice:o}}));var e,t,o},disabled:!d},"Buy for ",u.sellPrice," Gold"),a.a.createElement("button",{onClick:function(){return r((e=c,t=1,o=u.buyPrice,{type:j.SELL_GOODS,payload:{product:e,amount:t,atPrice:o}}));var e,t,o},disabled:!p},"Sell for ",u.buyPrice," Gold"))}));return a.a.createElement("div",{className:"trade-panel"},a.a.createElement("h4",null,Ge[e.traderId].name," has visited your island!"),"Timer: ",(e.timeToLeave-e.timer).toFixed(),a.a.createElement("button",{onClick:function(){var t;r((t=e.dismissCost,{type:j.DISMISS_TRADER,payload:{cost:{gold:t}}}))}},"Dismiss for ",e.dismissCost," Gold"),i)}),ht=.001;var vt=function(){var e=Object(o.useState)(new Ve((function(e){i((t=e*ht,{type:l.TICK,payload:{tickIntervalSeconds:t}}));var t}),100)),t=Object(m.a)(e,1)[0],r=Object(o.useState)(new Ve((function(){i(d()),console.log("Saved")}),3e4)),n=Object(m.a)(r,1)[0],i=Object(s.c)();return Object(o.useEffect)((function(){t.start(),n.start()}),[]),a.a.createElement("div",{className:"game"},a.a.createElement(Ot,null),a.a.createElement(Qe,null),a.a.createElement(Je,null),a.a.createElement(nt,null),a.a.createElement(ft,null),a.a.createElement(gt,null),a.a.createElement(mt,null),a.a.createElement(it,null),a.a.createElement(ct,null),a.a.createElement(bt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(s.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe,t=localStorage.getItem("save");return t&&(e=JSON.parse(atob(t))),e||(e=ze(null,{type:"RESET_SAVE"})),Object(c.d)(ze,e,Object(c.a)(u.a)&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}()},a.a.createElement(vt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[45,1,2]]]);
//# sourceMappingURL=main.512205cf.chunk.js.map